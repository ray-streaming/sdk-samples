/* ray-streaming v2.19.8 @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).RayStreaming={})}(this,(function(t){"use strict";function e(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},n(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var o=function(){return o=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},o.apply(this,arguments)};function r(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))}function a(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function u(t,e,n){if(n||2===arguments.length)for(var i,o=0,r=e.length;o<r;o++)!i&&o in e||(i||(i=Array.prototype.slice.call(e,0,o)),i[o]=e[o]);return t.concat(i||Array.prototype.slice.call(e))}function d(t){return this instanceof d?(this.v=t,this):new d(t)}function h(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,o=n.apply(t,e||[]),r=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(t){o[t]&&(i[t]=function(e){return new Promise((function(n,i){r.push([t,e,n,i])>1||s(t,e)}))})}function s(t,e){try{(n=o[t](e)).value instanceof d?Promise.resolve(n.value.v).then(c,u):h(r[0][2],n)}catch(t){h(r[0][3],t)}var n}function c(t){s("next",t)}function u(t){s("throw",t)}function h(t,e){t(e),r.shift(),r.length&&s(r[0][0],r[0][1])}}function l(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=s(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,o){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,o,(e=t[n](e)).done,e.value)}))}}}let p=!0,f=!0;function v(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function m(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(t,i){if(t!==e)return o.apply(this,arguments);const r=t=>{const e=n(t);e&&(i.handleEvent?i.handleEvent(e):i(e))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(i,r),o.apply(this,[t,r])};const r=i.removeEventListener;i.removeEventListener=function(t,n){if(t!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(n))return r.apply(this,arguments);const i=this._eventMap[e].get(n);return this._eventMap[e].delete(n),0===this._eventMap[e].size&&delete this._eventMap[e],0===Object.keys(this._eventMap).length&&delete this._eventMap,r.apply(this,[t,i])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(t){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),t&&this.addEventListener(e,this["_on"+e]=t)},enumerable:!0,configurable:!0})}function y(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(p=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function g(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(f=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function E(){if("object"==typeof window){if(p)return;"undefined"!=typeof console&&console.log}}function C(t){return"[object Object]"===Object.prototype.toString.call(t)}function w(t){return C(t)?Object.keys(t).reduce((function(e,n){const i=C(t[n]),o=i?w(t[n]):t[n],r=i&&!Object.keys(o).length;return void 0===o||r?e:Object.assign(e,{[n]:o})}),{}):t}function b(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach((i=>{i.endsWith("Id")?b(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach((e=>{b(t,t.get(e),n)}))})))}function D(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===e)return o;const r=[];return t.forEach((t=>{"track"===t.type&&t.trackIdentifier===e.id&&r.push(t)})),r.forEach((e=>{t.forEach((n=>{n.type===i&&n.trackId===e.id&&b(t,n,o)}))})),o}const T=E;function x(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(t){if("object"!=typeof t||t.mandatory||t.optional)return t;const e={};return Object.keys(t).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof t[n]?t[n]:{ideal:t[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const o=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==i.ideal){e.optional=e.optional||[];let t={};"number"==typeof i.ideal?(t[o("min",n)]=i.ideal,e.optional.push(t),t={},t[o("max",n)]=i.ideal,e.optional.push(t)):(t[o("",n)]=i.ideal,e.optional.push(t))}void 0!==i.exact&&"number"!=typeof i.exact?(e.mandatory=e.mandatory||{},e.mandatory[o("",n)]=i.exact):["min","max"].forEach((t=>{void 0!==i[t]&&(e.mandatory=e.mandatory||{},e.mandatory[o(t,n)]=i[t])}))})),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e},o=function(t,o){if(e.version>=61)return o(t);if((t=JSON.parse(JSON.stringify(t)))&&"object"==typeof t.audio){const e=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])};e((t=JSON.parse(JSON.stringify(t))).audio,"autoGainControl","googAutoGainControl"),e(t.audio,"noiseSuppression","googNoiseSuppression"),t.audio=i(t.audio)}if(t&&"object"==typeof t.video){let r=t.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});const a=e.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let e;if(delete t.video.facingMode,"environment"===r.exact||"environment"===r.ideal?e=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(e=["front"]),e)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((t=>"videoinput"===t.kind))).find((t=>e.some((e=>t.label.toLowerCase().includes(e)))));return!a&&n.length&&e.includes("back")&&(a=n[n.length-1]),a&&(t.video.deviceId=r.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=i(t.video),T("chrome: "+JSON.stringify(t)),o(t)}))}t.video=i(t.video)}return T("chrome: "+JSON.stringify(t)),o(t)},r=function(t){return e.version>=64?t:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(t,e,i){o(t,(t=>{n.webkitGetUserMedia(t,e,(t=>{i&&i(r(t))}))}))}.bind(n),n.mediaDevices.getUserMedia){const t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return o(e,(e=>t(e).then((t=>{if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((t=>{t.stop()})),new DOMException("","NotFoundError");return t}),(t=>Promise.reject(r(t))))))}}}function S(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function O(t){if("object"==typeof t&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",(n=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((t=>t.track&&t.track.id===n.track.id)):{track:n.track};const o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[e.stream],this.dispatchEvent(o)})),e.stream.getTracks().forEach((n=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((t=>t.track&&t.track.id===n.id)):{track:n};const o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[e.stream],this.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else m(t,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function M(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(t,e){return{track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=t.createDTMFSender(e):this._dtmf=null),this._dtmf},_pc:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,i){let o=n.apply(this,arguments);return o||(o=e(this,t),this._senders.push(o)),o};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){i.apply(this,arguments);const e=this._senders.indexOf(t);-1!==e&&this._senders.splice(e,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){this._senders=this._senders||[],n.apply(this,[t]),t.getTracks().forEach((t=>{this._senders.push(e(this,t))}))};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){this._senders=this._senders||[],i.apply(this,[t]),t.getTracks().forEach((t=>{const e=this._senders.find((e=>e.track===t));e&&this._senders.splice(this._senders.indexOf(e),1)}))}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function P(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[t,n,i]=arguments;if(arguments.length>0&&"function"==typeof t)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof t))return e.apply(this,[]);const o=function(t){const e={};return t.result().forEach((t=>{const n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach((e=>{n[e]=t.stat(e)})),e[n.id]=n})),e},r=function(t){return new Map(Object.keys(t).map((e=>[e,t[e]])))};if(arguments.length>=2){const i=function(t){n(r(o(t)))};return e.apply(this,[i,t])}return new Promise(((t,n)=>{e.apply(this,[function(e){t(r(o(e)))},n])})).then(n,i)}}function k(t){if(!("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){const t=this;return this._pc.getStats().then((e=>D(e,t.track,!0)))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t}),m(t,"track",(t=>(t.receiver._pc=t.srcElement,t))),t.RTCRtpReceiver.prototype.getStats=function(){const t=this;return this._pc.getStats().then((e=>D(e,t.track,!1)))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const t=arguments[0];let e,n,i;return this.getSenders().forEach((n=>{n.track===t&&(e?i=!0:e=n)})),this.getReceivers().forEach((e=>(e.track===t&&(n?i=!0:n=e),e.track===t))),i||e&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function R(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((t=>this._shimmedLocalStreams[t][0]))};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,n){if(!n)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=e.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){this._shimmedLocalStreams=this._shimmedLocalStreams||{},t.getTracks().forEach((t=>{if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError")}));const e=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((t=>-1===e.indexOf(t)));this._shimmedLocalStreams[t.id]=[t].concat(i)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[t.id],i.apply(this,arguments)};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},t&&Object.keys(this._shimmedLocalStreams).forEach((e=>{const n=this._shimmedLocalStreams[e].indexOf(t);-1!==n&&this._shimmedLocalStreams[e].splice(n,1),1===this._shimmedLocalStreams[e].length&&delete this._shimmedLocalStreams[e]})),o.apply(this,arguments)}}function _(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return R(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((t=>this._reverseStreams[t.id]))};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(e){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach((t=>{if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[e.id]){const n=new t.MediaStream(e.getTracks());this._streams[e.id]=n,this._reverseStreams[n.id]=e,e=n}i.apply(this,[e])};const o=t.RTCPeerConnection.prototype.removeStream;function r(t,e){let n=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((e=>{const i=t._reverseStreams[e],o=t._streams[i.id];n=n.replace(new RegExp(o.id,"g"),i.id)})),new RTCSessionDescription({type:e.type,sdp:n})}function a(t,e){let n=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((e=>{const i=t._reverseStreams[e],o=t._streams[i.id];n=n.replace(new RegExp(i.id,"g"),o.id)})),new RTCSessionDescription({type:e.type,sdp:n})}t.RTCPeerConnection.prototype.removeStream=function(t){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[t.id]||t]),delete this._reverseStreams[this._streams[t.id]?this._streams[t.id].id:t.id],delete this._streams[t.id]},t.RTCPeerConnection.prototype.addTrack=function(e,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((t=>t===e)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const o=this.getSenders().find((t=>t.track===e));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(e),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new t.MediaStream([e]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((t=>t.track===e))},["createOffer","createAnswer"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){const t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[e=>{const n=r(this,e);t[0].apply(null,[n])},e=>{t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((t=>r(this,t)))}};t.RTCPeerConnection.prototype[e]=i[e]}));const s=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const t=c.get.apply(this);return""===t.type?t:r(this,t)}}),t.RTCPeerConnection.prototype.removeTrack=function(t){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let e;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((e=>t.track===e))&&(e=this._streams[n])})),e&&(1===e.getTracks().length?this.removeStream(this._reverseStreams[e.id]):e.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function L(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=i[e]}))}function A(t,e){m(t,"negotiationneeded",(t=>{const n=t.target;if(!(e.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return t}))}var B=Object.freeze({__proto__:null,shimMediaStream:S,shimOnTrack:O,shimGetSendersWithDtmf:M,shimGetStats:P,shimSenderReceiverGetStats:k,shimAddTrackRemoveTrackWithNative:R,shimAddTrackRemoveTrack:_,shimPeerConnection:L,fixNegotiationNeeded:A,shimGetUserMedia:x,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&"function"==typeof e&&(t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then((e=>{const i=n.video&&n.video.width,o=n.video&&n.video.height,r=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:r||3}},i&&(n.video.mandatory.maxWidth=i),o&&(n.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(n)}))})}});function K(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(t,e,i){n.mediaDevices.getUserMedia(t).then(e,i)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const t=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])},e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),t(n.audio,"autoGainControl","mozAutoGainControl"),t(n.audio,"noiseSuppression","mozNoiseSuppression")),e(n)},i&&i.prototype.getSettings){const e=i.prototype.getSettings;i.prototype.getSettings=function(){const n=e.apply(this,arguments);return t(n,"mozAutoGainControl","autoGainControl"),t(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const e=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),t(n,"autoGainControl","mozAutoGainControl"),t(n,"noiseSuppression","mozNoiseSuppression")),e.apply(this,[n])}}}}function I(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y(t,e){if("object"!=typeof t||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=i[e]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[t,o,r]=arguments;return i.apply(this,[t||null]).then((t=>{if(e.version<53&&!o)try{t.forEach((t=>{t.type=n[t.type]||t.type}))}catch(e){if("TypeError"!==e.name)throw e;t.forEach(((e,i)=>{t.set(i,Object.assign({},e,{type:n[e.type]||e.type}))}))}return t})).then(o,r)}}function U(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender)return;if(t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function N(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender)return;if(t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t}),m(t,"track",(t=>(t.receiver._pc=t.srcElement,t))),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function X(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(t){this.getSenders().forEach((e=>{e.track&&t.getTracks().includes(e.track)&&this.removeTrack(e)}))})}function H(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function F(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;void 0===t&&(t=[]),t=[...t];const n=t.length>0;n&&t.forEach((t=>{if("rid"in t){if(!/^[a-z0-9]{0,16}$/i.test(t.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in t&&!(parseFloat(t.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in t&&!(parseFloat(t.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=e.apply(this,arguments);if(n){const{sender:e}=i,n=e.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=t,e.sendEncodings=t,this.setParametersPromises.push(e.setParameters(n).then((()=>{delete e.sendEncodings})).catch((()=>{delete e.sendEncodings}))))}return i})}function j(t){if("object"!=typeof t||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function z(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}function V(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}var W=Object.freeze({__proto__:null,shimOnTrack:I,shimPeerConnection:Y,shimSenderGetStats:U,shimReceiverGetStats:N,shimRemoveStream:X,shimRTCDataChannel:H,shimAddTransceiver:F,shimGetParameters:j,shimCreateOffer:z,shimCreateAnswer:V,shimGetUserMedia:K,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}return!0===n.video?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})}});function G(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach((n=>e.call(this,n,t))),t.getVideoTracks().forEach((n=>e.call(this,n,t)))},t.RTCPeerConnection.prototype.addTrack=function(t,...n){return n&&n.forEach((t=>{this._localStreams?this._localStreams.includes(t)||this._localStreams.push(t):this._localStreams=[t]})),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(t);if(-1===e)return;this._localStreams.splice(e,1);const n=t.getTracks();this.getSenders().forEach((t=>{n.includes(t.track)&&this.removeTrack(t)}))})}}function Z(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach((t=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(t))return;this._remoteStreams.push(t);const e=new Event("addstream");e.stream=t,this.dispatchEvent(e)}))})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((e=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(e)>=0)return;t._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}))}),e.apply(t,arguments)}}}function Q(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,o=e.setLocalDescription,r=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(t,e){const i=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[i]);return e?(o.then(t,e),Promise.resolve()):o},e.createAnswer=function(t,e){const n=arguments.length>=2?arguments[2]:arguments[0],o=i.apply(this,[n]);return e?(o.then(t,e),Promise.resolve()):o};let s=function(t,e,n){const i=o.apply(this,[t]);return n?(i.then(e,n),Promise.resolve()):i};e.setLocalDescription=s,s=function(t,e,n){const i=r.apply(this,[t]);return n?(i.then(e,n),Promise.resolve()):i},e.setRemoteDescription=s,s=function(t,e,n){const i=a.apply(this,[t]);return n?(i.then(e,n),Promise.resolve()):i},e.addIceCandidate=s}function J(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,n=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=t=>n(q(t))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(t,n,i){e.mediaDevices.getUserMedia(t).then(n,i)}.bind(e))}function q(t){return t&&void 0!==t.video?Object.assign({},t,{video:w(t.video)}):t}function $(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(t,n){if(t&&t.iceServers){const e=[];for(let n=0;n<t.iceServers.length;n++){let i=t.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,e.push(i)):e.push(t.iceServers[n])}t.iceServers=e}return new e(t,n)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function tt(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function et(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(t){if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const e=this.getTransceivers().find((t=>"audio"===t.receiver.track.kind));!1===t.offerToReceiveAudio&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==t.offerToReceiveAudio||e||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const n=this.getTransceivers().find((t=>"video"===t.receiver.track.kind));!1===t.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==t.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function nt(t){"object"!=typeof t||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var it=Object.freeze({__proto__:null,shimLocalStreamsAPI:G,shimRemoteStreamsAPI:Z,shimCallbacksAPI:Q,shimGetUserMedia:J,shimConstraints:q,shimRTCIceServerUrls:$,shimTrackEventTransceiver:tt,shimCreateOfferLegacy:et,shimAudioContext:nt}),ot={exports:{}};!function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split("\n").map((t=>t.trim()))},e.splitSections=function(t){return t.split("\nm=").map(((t,e)=>(e>0?"m="+t:t).trim()+"\r\n"))},e.getDescription=function(t){const n=e.splitSections(t);return n&&n[0]},e.getMediaSections=function(t){const n=e.splitSections(t);return n.shift(),n},e.matchPrefix=function(t,n){return e.splitLines(t).filter((t=>0===t.indexOf(n)))},e.parseCandidate=function(t){let e;e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" ");const n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let t=8;t<e.length;t+=2)switch(e[t]){case"raddr":n.relatedAddress=e[t+1];break;case"rport":n.relatedPort=parseInt(e[t+1],10);break;case"tcptype":n.tcpType=e[t+1];break;case"ufrag":n.ufrag=e[t+1],n.usernameFragment=e[t+1];break;default:void 0===n[e[t]]&&(n[e[t]]=e[t+1])}return n},e.writeCandidate=function(t){const e=[];e.push(t.foundation);const n=t.component;"rtp"===n?e.push(1):"rtcp"===n?e.push(2):e.push(n),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);const i=t.type;return e.push("typ"),e.push(i),"host"!==i&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){let e=t.substr(9).split(" ");const n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=3===e.length?parseInt(e[2],10):1,n.numChannels=n.channels,n},e.writeRtpMap=function(t){let e=t.payloadType;void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType);const n=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==n?"/"+n:"")+"\r\n"},e.parseExtmap=function(t){const e=t.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+"\r\n"},e.parseFmtp=function(t){const e={};let n;const i=t.substr(t.indexOf(" ")+1).split(";");for(let t=0;t<i.length;t++)n=i[t].trim().split("="),e[n[0].trim()]=n[1];return e},e.writeFmtp=function(t){let e="",n=t.payloadType;if(void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const i=[];Object.keys(t.parameters).forEach((e=>{void 0!==t.parameters[e]?i.push(e+"="+t.parameters[e]):i.push(e)})),e+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return e},e.parseRtcpFb=function(t){const e=t.substr(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},e.writeRtcpFb=function(t){let e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach((t=>{e+="a=rtcp-fb:"+n+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"})),e},e.parseSsrcMedia=function(t){const e=t.indexOf(" "),n={ssrc:parseInt(t.substr(7,e-7),10)},i=t.indexOf(":",e);return i>-1?(n.attribute=t.substr(e+1,i-e-1),n.value=t.substr(i+1)):n.attribute=t.substr(e+1),n},e.parseSsrcGroup=function(t){const e=t.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map((t=>parseInt(t,10)))}},e.getMid=function(t){const n=e.matchPrefix(t,"a=mid:")[0];if(n)return n.substr(6)},e.parseFingerprint=function(t){const e=t.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},e.getDtlsParameters=function(t,n){return{role:"auto",fingerprints:e.matchPrefix(t+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,e){let n="a=setup:"+e+"\r\n";return t.fingerprints.forEach((t=>{n+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"})),n},e.parseCryptoLine=function(t){const e=t.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},e.parseCryptoKeyParams=function(t){if(0!==t.indexOf("inline:"))return null;const e=t.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,n){return e.matchPrefix(t+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,n){const i=e.matchPrefix(t+n,"a=ice-ufrag:")[0],o=e.matchPrefix(t+n,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substr(12),password:o.substr(10)}:null},e.writeIceParameters=function(t){let e="a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n";return t.iceLite&&(e+="a=ice-lite\r\n"),e},e.parseRtpParameters=function(t){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");for(let o=3;o<i.length;o++){const r=i[o],a=e.matchPrefix(t,"a=rtpmap:"+r+" ")[0];if(a){const i=e.parseRtpMap(a),o=e.matchPrefix(t,"a=fmtp:"+r+" ");switch(i.parameters=o.length?e.parseFmtp(o[0]):{},i.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+r+" ").map(e.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}return e.matchPrefix(t,"a=extmap:").forEach((t=>{n.headerExtensions.push(e.parseExtmap(t))})),n},e.writeRtpDescription=function(t,n){let i="";i+="m="+t+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map((t=>void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((t=>{i+=e.writeRtpMap(t),i+=e.writeFmtp(t),i+=e.writeRtcpFb(t)}));let o=0;return n.codecs.forEach((t=>{t.maxptime>o&&(o=t.maxptime)})),o>0&&(i+="a=maxptime:"+o+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((t=>{i+=e.writeExtmap(t)})),i},e.parseRtpEncodingParameters=function(t){const n=[],i=e.parseRtpParameters(t),o=-1!==i.fecMechanisms.indexOf("RED"),r=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"cname"===t.attribute)),s=a.length>0&&a[0].ssrc;let c;const u=e.matchPrefix(t,"a=ssrc-group:FID").map((t=>t.substr(17).split(" ").map((t=>parseInt(t,10)))));u.length>0&&u[0].length>1&&u[0][0]===s&&(c=u[0][1]),i.codecs.forEach((t=>{if("RTX"===t.name.toUpperCase()&&t.parameters.apt){let e={ssrc:s,codecPayloadType:parseInt(t.parameters.apt,10)};s&&c&&(e.rtx={ssrc:c}),n.push(e),o&&(e=JSON.parse(JSON.stringify(e)),e.fec={ssrc:s,mechanism:r?"red+ulpfec":"red"},n.push(e))}})),0===n.length&&s&&n.push({ssrc:s});let d=e.matchPrefix(t,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach((t=>{t.maxBitrate=d}))),n},e.parseRtcpParameters=function(t){const n={},i=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"cname"===t.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const o=e.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;const r=e.matchPrefix(t,"a=rtcp-mux");return n.mux=r.length>0,n},e.writeRtcpParameters=function(t){let e="";return t.reducedSize&&(e+="a=rtcp-rsize\r\n"),t.mux&&(e+="a=rtcp-mux\r\n"),void 0!==t.ssrc&&t.cname&&(e+="a=ssrc:"+t.ssrc+" cname:"+t.cname+"\r\n"),e},e.parseMsid=function(t){let n;const i=e.matchPrefix(t,"a=msid:");if(1===i.length)return n=i[0].substr(7).split(" "),{stream:n[0],track:n[1]};const o=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"msid"===t.attribute));return o.length>0?(n=o[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},e.parseSctpDescription=function(t){const n=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let o;i.length>0&&(o=parseInt(i[0].substr(19),10)),isNaN(o)&&(o=65536);const r=e.matchPrefix(t,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substr(12),10),protocol:n.fmt,maxMessageSize:o};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const t=a[0].substr(10).split(" ");return{port:parseInt(t[0],10),protocol:t[1],maxMessageSize:o}}},e.writeSctpDescription=function(t,e){let n=[];return n="DTLS/SCTP"!==t.protocol?["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+e.port+"\r\n"]:["m="+t.kind+" 9 "+t.protocol+" "+e.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+e.port+" "+e.protocol+" 65535\r\n"],void 0!==e.maxMessageSize&&n.push("a=max-message-size:"+e.maxMessageSize+"\r\n"),n.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,n,i){let o;const r=void 0!==n?n:2;o=t||e.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+o+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},e.getDirection=function(t,n){const i=e.splitLines(t);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substr(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substr(2)},e.isRejected=function(t){return"0"===t.split(" ",2)[1]},e.parseMLine=function(t){const n=e.splitLines(t)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){const n=e.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;const n=e.splitLines(t);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},t.exports=e}(ot);var rt=ot.exports,at=Object.freeze(e({__proto__:null,default:rt},[ot.exports]));function st(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(t){if("object"==typeof t&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){const n=new e(t),i=rt.parseCandidate(t.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(t)},t.RTCIceCandidate.prototype=e.prototype,m(t,"icecandidate",(e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e)))}function ct(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||m(t,"icecandidate",(t=>{if(t.candidate){const e=rt.parseCandidate(t.candidate.candidate);"relay"===e.type&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t}))}function ut(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(t){if(!t||!t.sdp)return!1;const e=rt.splitSections(t.sdp);return e.shift(),e.some((t=>{const e=rt.parseMLine(t);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")}))},i=function(t){const e=t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;const n=parseInt(e[1],10);return n!=n?-1:n},o=function(t){let n=65536;return"firefox"===e.browser&&(n=e.version<57?-1===t?16384:2147483637:e.version<60?57===e.version?65535:65536:2147483637),n},r=function(t,n){let i=65536;"firefox"===e.browser&&57===e.version&&(i=65535);const o=rt.matchPrefix(t.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===e.browser&&-1!==n&&(i=2147483637),i},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===e.browser&&e.version>=76){const{sdpSemantics:t}=this.getConfiguration();"plan-b"===t&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const t=i(arguments[0]),e=o(t),n=r(arguments[0],t);let a;a=0===e&&0===n?Number.POSITIVE_INFINITY:0===e||0===n?Math.max(e,n):Math.min(e,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function dt(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(t,e){const n=t.send;t.send=function(){const i=arguments[0],o=i.length||i.size||i.byteLength;if("open"===t.readyState&&e.sctp&&o>e.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)");return n.apply(t,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const t=n.apply(this,arguments);return e(t,this),t},m(t,"datachannel",(t=>(e(t.channel,t.target),t)))}function ht(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((t=>{const n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=t=>{const e=t.target;if(e._lastConnectionState!==e.connectionState){e._lastConnectionState=e.connectionState;const n=new Event("connectionstatechange",t);e.dispatchEvent(n)}return t},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function lt(t,e){if(!t.RTCPeerConnection)return;if("chrome"===e.browser&&e.version>=71)return;if("safari"===e.browser&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(e){if(e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")){const n=e.sdp.split("\n").filter((t=>"a=extmap-allow-mixed"!==t.trim())).join("\n");t.RTCSessionDescription&&e instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:e.type,sdp:n}):e.sdp=n}return n.apply(this,arguments)}}function pt(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===e.browser&&e.version<78||"firefox"===e.browser&&e.version<68||"safari"===e.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ft(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let t=arguments[0]||{};if("object"!=typeof t||t.type&&t.sdp)return n.apply(this,arguments);if(t={type:t.type,sdp:t.sdp},!t.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}if(t.sdp||"offer"!==t.type&&"answer"!==t.type)return n.apply(this,[t]);const e="offer"===t.type?this.createOffer:this.createAnswer;return e.apply(this).then((t=>n.apply(this,[t])))})}var vt=Object.freeze({__proto__:null,shimRTCIceCandidate:st,shimRTCIceCandidateRelayProtocol:ct,shimMaxMessageSize:ut,shimSendThrowTypeError:dt,shimConnectionState:ht,removeExtmapAllowMixed:lt,shimAddIceCandidateNullOrEmpty:pt,shimParameterlessSetLocalDescription:ft});const mt=function({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=E,i=function(t){const e={browser:null,version:null};if(void 0===t||!t.navigator)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.mozGetUserMedia)e.browser="firefox",e.version=v(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=v(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=v(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return e}(t),o={browserDetails:i,commonShim:vt,extractVersion:v,disableLog:y,disableWarnings:g,sdp:at};switch(i.browser){case"chrome":if(!B||!L||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=B,pt(t,i),ft(t),x(t,i),S(t),L(t,i),O(t),_(t,i),M(t),P(t),k(t),A(t,i),st(t),ct(t),ht(t),ut(t,i),dt(t),lt(t,i);break;case"firefox":if(!W||!Y||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=W,pt(t,i),ft(t),K(t,i),Y(t,i),I(t),X(t),U(t),N(t),H(t),F(t),j(t),z(t),V(t),st(t),ht(t),ut(t,i),dt(t);break;case"safari":if(!it||!e.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=it,pt(t,i),ft(t),$(t),et(t),Q(t),G(t),Z(t),tt(t),J(t),nt(t),st(t),ct(t),ut(t,i),dt(t),lt(t,i);break;default:n("Unsupported browser!")}return o}({window:"undefined"==typeof window?void 0:window});function yt(t){return"function"==typeof t}function gt(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Et=gt((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function Ct(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var wt=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,i,o;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var a=s(r),d=a.next();!d.done;d=a.next()){d.value.remove(this)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else r.remove(this);var h=this.initialTeardown;if(yt(h))try{h()}catch(t){o=t instanceof Et?t.errors:[t]}var l=this._teardowns;if(l){this._teardowns=null;try{for(var p=s(l),f=p.next();!f.done;f=p.next()){var v=f.value;try{Tt(v)}catch(t){o=null!=o?o:[],t instanceof Et?o=u(u([],c(o)),c(t.errors)):o.push(t)}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new Et(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Tt(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Ct(e,t)},t.prototype.remove=function(e){var n=this._teardowns;n&&Ct(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),bt=wt.EMPTY;function Dt(t){return t instanceof wt||t&&"closed"in t&&yt(t.remove)&&yt(t.add)&&yt(t.unsubscribe)}function Tt(t){yt(t)?t():t.unsubscribe()}var xt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},St={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=St.delegate;return((null==n?void 0:n.setTimeout)||setTimeout).apply(void 0,u([],c(t)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Ot(t){St.setTimeout((function(){throw t}))}function Mt(){}function Pt(t){t()}var kt=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,Dt(e)&&e.add(n)):n.destination=At,n}return i(e,t),e.create=function(t,e,n){return new Rt(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(wt),Rt=function(t){function e(e,n,i){var o,r=t.call(this)||this;if(yt(e))o=e;else if(e){var a;o=e.next,n=e.error,i=e.complete,r&&xt.useDeprecatedNextContext?(a=Object.create(e)).unsubscribe=function(){return r.unsubscribe()}:a=e,o=null==o?void 0:o.bind(a),n=null==n?void 0:n.bind(a),i=null==i?void 0:i.bind(a)}return r.destination={next:o?_t(o):Mt,error:_t(null!=n?n:Lt),complete:i?_t(i):Mt},r}return i(e,t),e}(kt);function _t(t,e){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{t.apply(void 0,u([],c(e)))}catch(t){Ot(t)}}}function Lt(t){throw t}var At={closed:!0,next:Mt,error:Lt,complete:Mt},Bt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Kt(t){return t}function It(t){return 0===t.length?Kt:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var Yt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var i,o=this,r=(i=t)&&i instanceof kt||function(t){return t&&yt(t.next)&&yt(t.error)&&yt(t.complete)}(i)&&Dt(i)?t:new Rt(t,e,n);return Pt((function(){var t=o,e=t.operator,n=t.source;r.add(e?e.call(r,n):n?o._subscribe(r):o._trySubscribe(r))})),r},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Ut(e))((function(e,i){var o;o=n.subscribe((function(e){try{t(e)}catch(t){i(t),null==o||o.unsubscribe()}}),i,e)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Bt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return It(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Ut(t))((function(t,n){var i;e.subscribe((function(t){return i=t}),(function(t){return n(t)}),(function(){return t(i)}))}))},t.create=function(e){return new t(e)},t}();function Ut(t){var e;return null!==(e=null!=t?t:xt.Promise)&&void 0!==e?e:Promise}function Nt(t){return function(e){if(function(t){return yt(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var Xt=function(t){function e(e,n,i,o,r){var a=t.call(this,e)||this;return a.onFinalize=r,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=o?function(t){try{o(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return i(e,t),e.prototype.unsubscribe=function(){var e,n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},e}(kt),Ht={schedule:function(t){var e=requestAnimationFrame,n=cancelAnimationFrame,i=e((function(e){n=void 0,t(e)}));return new wt((function(){return null==n?void 0:n(i)}))},requestAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ht.delegate;return((null==n?void 0:n.requestAnimationFrame)||requestAnimationFrame).apply(void 0,u([],c(t)))},cancelAnimationFrame:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Ht.delegate;return((null==n?void 0:n.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,u([],c(t)))},delegate:void 0},Ft=gt((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),jt=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return i(e,t),e.prototype.lift=function(t){var e=new zt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ft},e.prototype.next=function(t){var e=this;Pt((function(){var n,i;if(e._throwIfClosed(),!e.isStopped){var o=e.observers.slice();try{for(var r=s(o),a=r.next();!a.done;a=r.next()){a.value.next(t)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}}}))},e.prototype.error=function(t){var e=this;Pt((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var n=e.observers;n.length;)n.shift().error(t)}}))},e.prototype.complete=function(){var t=this;Pt((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,n=e.hasError,i=e.isStopped,o=e.observers;return n||i?bt:(o.push(t),new wt((function(){return Ct(o,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,n=e.hasError,i=e.thrownError,o=e.isStopped;n?t.error(i):o&&t.complete()},e.prototype.asObservable=function(){var t=new Yt;return t.source=this,t},e.create=function(t,e){return new zt(t,e)},e}(Yt),zt=function(t){function e(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return i(e,t),e.prototype.next=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,t)},e.prototype.error=function(t){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==n?n:bt},e}(jt),Vt={now:function(){return(Vt.delegate||Date).now()},delegate:void 0},Wt=function(t){function e(e,n,i){void 0===e&&(e=1/0),void 0===n&&(n=1/0),void 0===i&&(i=Vt);var o=t.call(this)||this;return o._bufferSize=e,o._windowTime=n,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,e),o._windowTime=Math.max(1,n),o}return i(e,t),e.prototype.next=function(e){var n=this,i=n.isStopped,o=n._buffer,r=n._infiniteTimeWindow,a=n._timestampProvider,s=n._windowTime;i||(o.push(e),!r&&o.push(a.now()+s)),this._trimBuffer(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),n=this._infiniteTimeWindow,i=this._buffer.slice(),o=0;o<i.length&&!t.closed;o+=n?1:2)t.next(i[o]);return this._checkFinalizedStatuses(t),e},e.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,n=t._timestampProvider,i=t._buffer,o=t._infiniteTimeWindow,r=(o?1:2)*e;if(e<1/0&&r<i.length&&i.splice(0,i.length-r),!o){for(var a=n.now(),s=0,c=1;c<i.length&&i[c]<=a;c+=2)s=c;s&&i.splice(0,s+1)}},e}(jt),Gt=function(t){function e(e,n){return t.call(this)||this}return i(e,t),e.prototype.schedule=function(t,e){return this},e}(wt),Zt={setInterval:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Zt.delegate;return((null==n?void 0:n.setInterval)||setInterval).apply(void 0,u([],c(t)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},Qt=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return i(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(i,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),Zt.setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;Zt.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n,i=!1;try{this.work(t)}catch(t){i=!0,n=t||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Ct(i,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Gt),Jt=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=Vt.now,t}(),qt=function(t){function e(e,n){void 0===n&&(n=Jt.now);var i=t.call(this,e,n)||this;return i.actions=[],i._active=!1,i._scheduled=void 0,i}return i(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(Jt),$t=new qt(Qt),te=$t,ee=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return i(e,t),e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&i>0?t.prototype.requestAsyncId.call(this,e,n,i):(e.actions.push(this),e._scheduled||(e._scheduled=Ht.requestAnimationFrame((function(){return e.flush(void 0)}))))},e.prototype.recycleAsyncId=function(e,n,i){if(void 0===i&&(i=0),null!=i&&i>0||null==i&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,i);0===e.actions.length&&(Ht.cancelAnimationFrame(n),e._scheduled=void 0)},e}(Qt),ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.flush=function(t){this._active=!0,this._scheduled=void 0;var e,n=this.actions,i=-1;t=t||n.shift();var o=n.length;do{if(e=t.execute(t.state,t.delay))break}while(++i<o&&(t=n.shift()));if(this._active=!1,e){for(;++i<o&&(t=n.shift());)t.unsubscribe();throw e}},e}(qt),ie=new ne(ee),oe=new Yt((function(t){return t.complete()}));function re(t){return t&&yt(t.schedule)}function ae(t){return t[t.length-1]}function se(t){return re(ae(t))?t.pop():void 0}function ce(t,e){return"number"==typeof ae(t)?t.pop():e}var ue=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function de(t){return yt(null==t?void 0:t.then)}function he(t){return yt(t[Bt])}function le(t){return Symbol.asyncIterator&&yt(null==t?void 0:t[Symbol.asyncIterator])}function pe(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var fe="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ve(t){return yt(null==t?void 0:t[fe])}function me(t){return h(this,arguments,(function(){var e,n,i;return a(this,(function(o){switch(o.label){case 0:e=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,d(e.read())];case 3:return n=o.sent(),i=n.value,n.done?[4,d(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,d(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function ye(t){return yt(null==t?void 0:t.getReader)}function ge(t){if(t instanceof Yt)return t;if(null!=t){if(he(t))return o=t,new Yt((function(t){var e=o[Bt]();if(yt(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(ue(t))return i=t,new Yt((function(t){for(var e=0;e<i.length&&!t.closed;e++)t.next(i[e]);t.complete()}));if(de(t))return n=t,new Yt((function(t){n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Ot)}));if(le(t))return Ee(t);if(ve(t))return e=t,new Yt((function(t){var n,i;try{for(var o=s(e),r=o.next();!r.done;r=o.next()){var a=r.value;if(t.next(a),t.closed)return}}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}t.complete()}));if(ye(t))return Ee(me(t))}var e,n,i,o;throw pe(t)}function Ee(t){return new Yt((function(e){(function(t,e){var n,i,o,s;return r(this,void 0,void 0,(function(){var r,c;return a(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),n=l(t),a.label=1;case 1:return[4,n.next()];case 2:if((i=a.sent()).done)return[3,4];if(r=i.value,e.next(r),e.closed)return[2];a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=a.sent(),o={error:c},[3,11];case 6:return a.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function Ce(t,e,n,i,o){void 0===i&&(i=0),void 0===o&&(o=!1);var r=e.schedule((function(){n(),o?t.add(this.schedule(null,i)):this.unsubscribe()}),i);if(t.add(r),!o)return r}function we(t,e){return void 0===e&&(e=0),Nt((function(n,i){n.subscribe(new Xt(i,(function(n){return Ce(i,t,(function(){return i.next(n)}),e)}),(function(){return Ce(i,t,(function(){return i.complete()}),e)}),(function(n){return Ce(i,t,(function(){return i.error(n)}),e)})))}))}function be(t,e){return void 0===e&&(e=0),Nt((function(n,i){i.add(t.schedule((function(){return n.subscribe(i)}),e))}))}function De(t,e){if(!t)throw new Error("Iterable cannot be null");return new Yt((function(n){Ce(n,e,(function(){var i=t[Symbol.asyncIterator]();Ce(n,e,(function(){i.next().then((function(t){t.done?n.complete():n.next(t.value)}))}),0,!0)}))}))}function Te(t,e){if(null!=t){if(he(t))return function(t,e){return ge(t).pipe(be(e),we(e))}(t,e);if(ue(t))return function(t,e){return new Yt((function(n){var i=0;return e.schedule((function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())}))}))}(t,e);if(de(t))return function(t,e){return ge(t).pipe(be(e),we(e))}(t,e);if(le(t))return De(t,e);if(ve(t))return function(t,e){return new Yt((function(n){var i;return Ce(n,e,(function(){i=t[fe](),Ce(n,e,(function(){var t,e,o;try{e=(t=i.next()).value,o=t.done}catch(t){return void n.error(t)}o?n.complete():n.next(e)}),0,!0)})),function(){return yt(null==i?void 0:i.return)&&i.return()}}))}(t,e);if(ye(t))return function(t,e){return De(me(t),e)}(t,e)}throw pe(t)}function xe(t,e){return e?Te(t,e):ge(t)}function Se(t,e){return Nt((function(n,i){var o=0;n.subscribe(new Xt(i,(function(n){i.next(t.call(e,n,o++))})))}))}var Oe=Array.isArray;function Me(t){return Se((function(e){return function(t,e){return Oe(e)?t.apply(void 0,u([],c(e))):t(e)}(t,e)}))}function Pe(t,e,n){return void 0===n&&(n=1/0),yt(e)?Pe((function(n,i){return Se((function(t,o){return e(n,t,i,o)}))(ge(t(n,i)))}),n):("number"==typeof e&&(n=e),Nt((function(e,i){return function(t,e,n,i,o,r,a,s){var c=[],u=0,d=0,h=!1,l=function(){!h||c.length||u||e.complete()},p=function(t){return u<i?f(t):c.push(t)},f=function(t){r&&e.next(t),u++;var s=!1;ge(n(t,d++)).subscribe(new Xt(e,(function(t){null==o||o(t),r?p(t):e.next(t)}),(function(){s=!0}),void 0,(function(){if(s)try{u--;for(var t=function(){var t=c.shift();a?Ce(e,a,(function(){return f(t)})):f(t)};c.length&&u<i;)t();l()}catch(t){e.error(t)}})))};return t.subscribe(new Xt(e,p,(function(){h=!0,l()}))),function(){null==s||s()}}(e,i,t,n)})))}function ke(t){return void 0===t&&(t=1/0),Pe(Kt,t)}function Re(){return ke(1)}function _e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Re()(xe(t,se(t)))}var Le=["addListener","removeListener"],Ae=["addEventListener","removeEventListener"],Be=["on","off"];function Ke(t,e,n,i){if(yt(n)&&(i=n,n=void 0),i)return Ke(t,e,n).pipe(Me(i));var o=c(function(t){return yt(t.addEventListener)&&yt(t.removeEventListener)}(t)?Ae.map((function(i){return function(o){return t[i](e,o,n)}})):function(t){return yt(t.addListener)&&yt(t.removeListener)}(t)?Le.map(Ie(t,e)):function(t){return yt(t.on)&&yt(t.off)}(t)?Be.map(Ie(t,e)):[],2),r=o[0],a=o[1];if(!r&&ue(t))return Pe((function(t){return Ke(t,e,n)}))(ge(t));if(!r)throw new TypeError("Invalid event target");return new Yt((function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return r(e),function(){return a(e)}}))}function Ie(t,e){return function(n){return function(i){return t[n](e,i)}}}function Ye(t,e,n){return i=function(){return t()?e:n},new Yt((function(t){ge(i()).subscribe(t)}));var i}function Ue(t,e,n){void 0===t&&(t=0),void 0===n&&(n=te);var i=-1;return null!=e&&(re(e)?n=e:i=e),new Yt((function(e){var o,r=(o=t)instanceof Date&&!isNaN(o)?+t-n.now():t;r<0&&(r=0);var a=0;return n.schedule((function(){e.closed||(e.next(a++),0<=i?this.schedule(void 0,i):e.complete())}),r)}))}function Ne(t,e){return void 0===t&&(t=0),void 0===e&&(e=$t),t<0&&(t=0),Ue(t,t,e)}function Xe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=se(t),i=ce(t,1/0),o=t;return o.length?1===o.length?ge(o[0]):ke(i)(xe(o,n)):oe}function He(t,e){return Nt((function(n,i){var o=0;n.subscribe(new Xt(i,(function(n){return t.call(e,n,o++)&&i.next(n)})))}))}function Fe(t){return Nt((function(e,n){var i=[];return e.subscribe(new Xt(n,(function(t){return i.push(t)}),(function(){n.next(i),n.complete()}))),t.subscribe(new Xt(n,(function(){var t=i;i=[],n.next(t)}),Mt)),function(){i=null}}))}function je(t){return t<=0?function(){return oe}:Nt((function(e,n){var i=0;e.subscribe(new Xt(n,(function(e){++i<=t&&(n.next(e),t<=i&&n.complete())})))}))}function ze(){return Nt((function(t,e){var n,i=!1;t.subscribe(new Xt(e,(function(t){var o=n;n=t,i&&e.next([o,t]),i=!0})))}))}function Ve(t){return void 0===t&&(t=1/0),t<=0?function(){return oe}:Nt((function(e,n){var i,o=0,r=function(){var a=!1;i=e.subscribe(new Xt(n,void 0,(function(){++o<t?i?(i.unsubscribe(),i=null,r()):a=!0:n.complete()}))),a&&(i.unsubscribe(),i=null,r())};r()}))}function We(t){void 0===t&&(t={});var e=t.connector,n=void 0===e?function(){return new jt}:e,i=t.resetOnError,o=void 0===i||i,r=t.resetOnComplete,a=void 0===r||r,s=t.resetOnRefCountZero,c=void 0===s||s;return function(t){var e=null,i=null,r=null,s=0,u=!1,d=!1,h=function(){null==i||i.unsubscribe(),i=null},l=function(){h(),e=r=null,u=d=!1},p=function(){var t=e;l(),null==t||t.unsubscribe()};return Nt((function(t,f){s++,d||u||h();var v=r=null!=r?r:n();f.add((function(){0!==--s||d||u||(i=Ge(p,c))})),v.subscribe(f),e||(e=new Rt({next:function(t){return v.next(t)},error:function(t){d=!0,h(),i=Ge(l,o,t),v.error(t)},complete:function(){u=!0,h(),i=Ge(l,a),v.complete()}}),xe(t).subscribe(e))}))(t)}}function Ge(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return!0===e?(t(),null):!1===e?null:e.apply(void 0,u([],c(n))).pipe(je(1)).subscribe((function(){return t()}))}function Ze(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=se(t);return Nt((function(e,i){(n?_e(t,e,n):_e(t,e)).subscribe(i)}))}function Qe(t){return Nt((function(e,n){ge(t).subscribe(new Xt(n,(function(){return n.complete()}),Mt)),!n.closed&&e.subscribe(n)}))}function Je(t,e,n){var i=yt(t)||e||n?{next:t,error:e,complete:n}:t;return i?Nt((function(t,e){var n;null===(n=i.subscribe)||void 0===n||n.call(i);var o=!0;t.subscribe(new Xt(e,(function(t){var n;null===(n=i.next)||void 0===n||n.call(i,t),e.next(t)}),(function(){var t;o=!1,null===(t=i.complete)||void 0===t||t.call(i),e.complete()}),(function(t){var n;o=!1,null===(n=i.error)||void 0===n||n.call(i,t),e.error(t)}),(function(){var t,e;o&&(null===(t=i.unsubscribe)||void 0===t||t.call(i)),null===(e=i.finalize)||void 0===e||e.call(i)})))})):Kt}var qe={leading:!0,trailing:!1};function $e(t,e,n){void 0===e&&(e=$t),void 0===n&&(n=qe);var i,o,r,a,s,c=Ue(t,e);return i=function(){return c},a=(r=void 0===(o=n)?qe:o).leading,s=r.trailing,Nt((function(t,e){var n=!1,o=null,r=null,c=!1,u=function(){null==r||r.unsubscribe(),r=null,s&&(l(),c&&e.complete())},d=function(){r=null,c&&e.complete()},h=function(t){return r=ge(i(t)).subscribe(new Xt(e,u,d))},l=function(){if(n){n=!1;var t=o;o=null,e.next(t),!c&&h(t)}};t.subscribe(new Xt(e,(function(t){n=!0,o=t,(!r||r.closed)&&(a?l():h(t))}),(function(){c=!0,(!(s&&n&&r)||r.closed)&&e.complete()})))}))}var tn,en={url:"",deserializer:function(t){return JSON.parse(t.data)},serializer:function(t){return JSON.stringify(t)}},nn=function(t){function e(e,n){var i=t.call(this)||this;if(i._socket=null,e instanceof Yt)i.destination=n,i.source=e;else{var r=i._config=o({},en);if(i._output=new jt,"string"==typeof e)r.url=e;else for(var a in e)e.hasOwnProperty(a)&&(r[a]=e[a]);if(!r.WebSocketCtor&&WebSocket)r.WebSocketCtor=WebSocket;else if(!r.WebSocketCtor)throw new Error("no WebSocket constructor can be found");i.destination=new Wt}return i}return i(e,t),e.prototype.lift=function(t){var n=new e(this._config,this.destination);return n.operator=t,n.source=this,n},e.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Wt),this._output=new jt},e.prototype.multiplex=function(t,e,n){var i=this;return new Yt((function(o){try{i.next(t())}catch(t){o.error(t)}var r=i.subscribe((function(t){try{n(t)&&o.next(t)}catch(t){o.error(t)}}),(function(t){return o.error(t)}),(function(){return o.complete()}));return function(){try{i.next(e())}catch(t){o.error(t)}r.unsubscribe()}}))},e.prototype._connectSocket=function(){var t=this,e=this._config,n=e.WebSocketCtor,i=e.protocol,o=e.url,r=e.binaryType,a=this._output,s=null;try{s=i?new n(o,i):new n(o),this._socket=s,r&&(this._socket.binaryType=r)}catch(t){return void a.error(t)}var c=new wt((function(){t._socket=null,s&&1===s.readyState&&s.close()}));s.onopen=function(e){if(!t._socket)return s.close(),void t._resetState();var n=t._config.openObserver;n&&n.next(e);var i=t.destination;t.destination=kt.create((function(e){if(1===s.readyState)try{var n=t._config.serializer;s.send(n(e))}catch(e){t.destination.error(e)}}),(function(e){var n=t._config.closingObserver;n&&n.next(void 0),e&&e.code?s.close(e.code,e.reason):a.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),t._resetState()}),(function(){var e=t._config.closingObserver;e&&e.next(void 0),s.close(),t._resetState()})),i&&i instanceof Wt&&c.add(i.subscribe(t.destination))},s.onerror=function(e){t._resetState(),a.error(e)},s.onclose=function(e){t._resetState();var n=t._config.closeObserver;n&&n.next(e),e.wasClean?a.complete():a.error(e)},s.onmessage=function(e){try{var n=t._config.deserializer;a.next(n(e))}catch(t){a.error(t)}}},e.prototype._subscribe=function(t){var e=this,n=this.source;return n?n.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add((function(){var t=e._socket;0===e._output.observers.length&&(!t||1!==t.readyState&&0!==t.readyState||t.close(),e._resetState())})),t)},e.prototype.unsubscribe=function(){var e=this._socket;!e||1!==e.readyState&&0!==e.readyState||e.close(),this._resetState(),t.prototype.unsubscribe.call(this)},e}(zt);t.LogLevel=void 0,(tn=t.LogLevel||(t.LogLevel={}))[tn.log=0]="log",tn[tn.info=1]="info",tn[tn.warn=2]="warn",tn[tn.error=3]="error";var on=function(){function e(){}return e.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.defineLogLevel(t.LogLevel.log,e)},e.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.defineLogLevel(t.LogLevel.info,e)},e.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.defineLogLevel(t.LogLevel.warn,e)},e.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.defineLogLevel(t.LogLevel.error,e)},e.setLogLevel=function(t){this.logLevel=t},e.setNotification=function(t){this.notifyCbs.push(t)},e.defineLogLevel=function(e,n){var i=this;if(e>=this.logLevel){switch(e){case t.LogLevel.log:case t.LogLevel.info:case t.LogLevel.warn:case t.LogLevel.error:}var o=new Date;this.notifyCbs.forEach((function(r){return r("[".concat(o.toISOString(),"] [").concat(t.LogLevel[e].toLocaleUpperCase(),"] ").concat(i.stringify(n)))}))}},e.stringify=function(t){var e=function(t){var n="";for(var i in t)"function"!=typeof t[i]&&("object"==typeof t[i]?n+=e(t[i]):n+=JSON.stringify("".concat(i,"=").concat(t[i],",")));return n};return t.reduce((function(t,n,i){if("object"==typeof n){var o=JSON.stringify(n,(function(t,e){return"bigint"==typeof e?"".concat(e,"n"):e}));t+="{}"===o?JSON.stringify("{".concat(e(n),"}")):o}else"function"!=typeof n&&(t+=i>0?","+n:n);return t}),"")},e.logLevel=t.LogLevel.info,e.notifyCbs=[],e}();function rn(t){return Object.keys(Array.from({length:t})).map((function(t){return Number(t)}))}function an(t,e){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n.buffer}var sn=function(t){return new DataView(t).getUint8(0)},cn=function(t,e){return void 0===e&&(e=1),(new TextDecoder).decode(new Uint8Array(t,e))};var un,dn,hn,ln,pn,fn,vn,mn,yn=function(t){return null!==t};function gn(t,e){return!!e&&JSON.stringify({b:t.buttons.map((function(t){return{pressed:t.pressed,value:t.value,touched:t.touched}})),a:t.axes})!==JSON.stringify({b:e.buttons.map((function(t){return{pressed:t.pressed,value:t.value,touched:t.touched}})),a:e.axes})}t.EventType=void 0,(un=t.EventType||(t.EventType={}))[un.MouseMoveStandardization=0]="MouseMoveStandardization",un[un.MouseButton=1]="MouseButton",un[un.WheelScroll=2]="WheelScroll",un[un.Keyboard=3]="Keyboard",un[un.WinTouch=4]="WinTouch",un[un.MobileTouch=5]="MobileTouch",un[un.MobileCustom=6]="MobileCustom",un[un.URLIntercept=7]="URLIntercept",un[un.CaretVisible=8]="CaretVisible",un[un.TextInput=9]="TextInput",un[un.MobileKeys=10]="MobileKeys",un[un.GamepadInput=11]="GamepadInput",un[un.CursorData=12]="CursorData",un[un.MouseMoveNormalization=13]="MouseMoveNormalization",un[un.EventDelay=14]="EventDelay",un[un.EchoData=15]="EchoData",un[un.KickOutController=16]="KickOutController",un[un.ScreenshotParams=17]="ScreenshotParams",un[un.ClipboardData=18]="ClipboardData",un[un.EncodeSettings=19]="EncodeSettings",un[un.MicrophoneData=21]="MicrophoneData",un[un.GamepadUpdate=22]="GamepadUpdate",un[un.MobileTouchNormalization=29]="MobileTouchNormalization",un[un.QueryResolutions=30]="QueryResolutions",un[un.ResolutionSettings=33]="ResolutionSettings",un[un.EncodeResolutionSettings=36]="EncodeResolutionSettings",un[un.FileRequest=41]="FileRequest",un[un.FileResponse=42]="FileResponse",un[un.FileContent=43]="FileContent",un[un.FileFinish=44]="FileFinish",un[un.BandwidthDetect=48]="BandwidthDetect",un[un.MobileScroll=97]="MobileScroll",un[un.WebRTCForwardBinaryRSP=123]="WebRTCForwardBinaryRSP",un[un.WebRTCForwardBinaryREQ=124]="WebRTCForwardBinaryREQ",un[un.WebRTCPluginsMSG=125]="WebRTCPluginsMSG",un[un.WebRTCForwardTextRSP=126]="WebRTCForwardTextRSP",un[un.WebRTCForwardTextREQ=127]="WebRTCForwardTextREQ",un[un.MobileScreenRotate=199]="MobileScreenRotate",un[un.MobileResolutionScale=200]="MobileResolutionScale",un[un.MobileResolutionInfo=201]="MobileResolutionInfo",t.ImageResultValue=void 0,(dn=t.ImageResultValue||(t.ImageResultValue={}))[dn.Failure=0]="Failure",dn[dn.Success=1]="Success",dn[dn.Portion=2]="Portion",t.ImageStoreFormat=void 0,(hn=t.ImageStoreFormat||(t.ImageStoreFormat={}))[hn.Clipboard=0]="Clipboard",hn[hn.FileBMP=1]="FileBMP",hn[hn.FilePNG=2]="FilePNG",hn[hn.BinaryBMP=3]="BinaryBMP",hn[hn.BinaryPNG=4]="BinaryPNG",t.MouseButtonType=void 0,(ln=t.MouseButtonType||(t.MouseButtonType={}))[ln.ButtonLeft=1]="ButtonLeft",ln[ln.ButtonMiddle=2]="ButtonMiddle",ln[ln.ButtonRight=3]="ButtonRight",ln[ln.ButtonX1=4]="ButtonX1",ln[ln.ButtonX2=5]="ButtonX2",t.TouchType=void 0,(pn=t.TouchType||(t.TouchType={}))[pn.TouchDown=0]="TouchDown",pn[pn.TouchUpdate=1]="TouchUpdate",pn[pn.TouchUp=2]="TouchUp",t.MoveType=void 0,(fn=t.MoveType||(t.MoveType={}))[fn.Absolute=0]="Absolute",fn[fn.Relative=1]="Relative",fn[fn.Passive=2]="Passive",fn[fn.Unknow=3]="Unknow",t.GamepadType=void 0,(vn=t.GamepadType||(t.GamepadType={}))[vn.GamepadXbox=0]="GamepadXbox",t.GamepadXboxButton=void 0,(mn=t.GamepadXboxButton||(t.GamepadXboxButton={}))[mn.GamepadXboxButtonDpadUp=1]="GamepadXboxButtonDpadUp",mn[mn.GamepadXboxButtonDpadDown=2]="GamepadXboxButtonDpadDown",mn[mn.GamepadXboxButtonDpadLeft=4]="GamepadXboxButtonDpadLeft",mn[mn.GamepadXboxButtonDpadRight=8]="GamepadXboxButtonDpadRight",mn[mn.GamepadXboxButtonStart=16]="GamepadXboxButtonStart",mn[mn.GamepadXboxButtonBack=32]="GamepadXboxButtonBack",mn[mn.GamepadXboxButtonLeftThumb=64]="GamepadXboxButtonLeftThumb",mn[mn.GamepadXboxButtonRightThumb=128]="GamepadXboxButtonRightThumb",mn[mn.GamepadXboxButtonLeftShoulder=256]="GamepadXboxButtonLeftShoulder",mn[mn.GamepadXboxButtonRightShoulder=512]="GamepadXboxButtonRightShoulder",mn[mn.GamepadXboxButtonA=4096]="GamepadXboxButtonA",mn[mn.GamepadXboxButtonB=8192]="GamepadXboxButtonB",mn[mn.GamepadXboxButtonX=16384]="GamepadXboxButtonX",mn[mn.GamepadXboxButtonY=32768]="GamepadXboxButtonY";var En,Cn,wn=new Map([[0,t.MouseButtonType.ButtonLeft],[1,t.MouseButtonType.ButtonMiddle],[2,t.MouseButtonType.ButtonRight],[3,t.MouseButtonType.ButtonX1],[4,t.MouseButtonType.ButtonX2]]),bn=function(){function e(t,e){void 0===e&&(e=0),this.data=t,this.id=e}return e.prototype.dumps=function(){var e=(new TextEncoder).encode(this.data),n=new DataView(new ArrayBuffer(3+e.length));return n.setUint8(0,t.EventType.WebRTCForwardTextREQ),n.setUint16(1,this.id),e.forEach((function(t,e){return n.setUint8(e+3,t)})),n.buffer},e}(),Dn=function(){function e(t,e){void 0===e&&(e=0),this.data=t,this.id=e}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(3));e.setUint8(0,t.EventType.WebRTCForwardBinaryREQ),e.setUint16(1,this.id);var n=new Uint8Array(3+this.data.byteLength);return n.set(new Uint8Array(e.buffer),0),n.set(new Uint8Array(this.data),3),n.buffer},e}(),Tn=function(){function e(t){this.timestamp=t}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(5));return e.setUint8(0,t.EventType.EchoData),e.setUint32(1,this.timestamp),e.buffer},e.decode=function(t){return new e(new DataView(t).getUint32(1))},e}(),xn=function(){function e(e,n,i,o,r,a){void 0===r&&(r=t.MoveType.Passive),void 0===a&&(a=t.EventType.MouseMoveStandardization),this.x=e,this.y=n,this.dx=i,this.dy=o,this.move=r,this.eventType=a}return e.prototype.dumps=function(){on.log("[Event] mouse move:",this.x,this.y,this.dx,this.dy,this.move,this.eventType);var t=new ArrayBuffer(10),e=new DataView(t);return e.setUint8(0,this.eventType),e.setUint8(1,+this.move),e.setUint16(2,this.x),e.setUint16(4,this.y),e.setInt16(6,this.dx),e.setInt16(8,this.dy),t},e}(),Sn=function(){function e(t,e){this.mouseButtonType=t,this.down=e}return e.prototype.dumps=function(){on.log("[Event] mouse button:",this.mouseButtonType,this.down);var e=new ArrayBuffer(3),n=new DataView(e);return n.setUint8(0,t.EventType.MouseButton),n.setUint8(1,+this.down),n.setUint8(2,this.mouseButtonType),e},e.formMouseEvent=function(t,n){if(!wn.has(t.button))throw new Error("[Event] unsupport button type");return new e(wn.get(t.button),n)},e}(),On=function(){function e(t,e){this.step=t,this.forward=e}return e.prototype.dumps=function(){on.log("[Event] wheel scroll:",this.step,this.forward);var e=new ArrayBuffer(4),n=new DataView(e);return n.setUint8(0,t.EventType.WheelScroll),n.setUint8(1,+this.forward),n.setUint16(2,this.step),e},e.fromPinchZoom=function(t){return new e(Math.abs(t),1===Math.sign(t))},e.fromWheelEvent=function(t){var n=Math.abs(t.deltaX),i=Math.abs(t.deltaY),o=!!i,r=-1===Math.sign(o?t.deltaY:t.deltaX);return new e(o?Math.sign(i):Math.sign(n),r)},e.fromTouchDeltaY=function(t){return new e(1,t<0)},e}(),Mn=function(){function e(t,e,n,i,o,r,a,s){this.keycode=t,this.alt=e,this.shift=n,this.ctrl=i,this.nlock=o,this.clock=r,this.slock=a,this.down=s}return e.prototype.dumps=function(){on.log("[Event] keyboard:","keycode: ".concat(this.keycode,"; alt: ").concat(this.alt,"; shift: ").concat(this.shift,"; ctrl: ").concat(this.ctrl,"; nlock: ").concat(this.nlock,"; clock: ").concat(this.clock,"; slock: ").concat(this.slock,"; down: ").concat(this.down,";"));var e=new ArrayBuffer(9),n=new DataView(e);return n.setUint8(0,t.EventType.Keyboard),n.setUint8(1,+this.down),n.setUint8(2,+this.nlock),n.setUint8(3,+this.clock),n.setUint8(4,+this.slock),n.setUint8(5,+this.shift),n.setUint8(6,+this.ctrl),n.setUint8(7,+this.alt),n.setUint8(8,+this.keycode),e},e.fromKeyboardEvent=function(t,n){return new e(t.keyCode,t.altKey,t.shiftKey,t.ctrlKey,t.getModifierState("NumLock"),t.getModifierState("CapsLock"),t.getModifierState("ScrollLock"),n)},e}(),Pn=function(){function e(t,e){this.touchType=t,this.touchList=e}return e.prototype.dumps=function(){on.log("[Event] touch set:",this.touchType,this.touchList);var e=new ArrayBuffer(4+8*this.touchList.length),n=new DataView(e);n.setUint8(0,t.EventType.WinTouch),n.setUint8(1,this.touchType),n.setUint16(2,this.touchList.length);var i=4;return this.touchList.forEach((function(t){n.setUint16(i,t.x),i+=2,n.setUint16(i,t.y),i+=2,n.setUint32(i,t.id),i+=4})),e},e}(),kn=function(){function t(t,e){this.id=t,this.success=e}return t.fromDataChannel=function(e){var n=new DataView(e);return new t(n.getUint16(1),!!n.getUint8(3))},t}(),Rn=function(){function e(t,e){void 0===e&&(e=!1),this.payload=t,this.reserve=e}return e.prototype.dumps=function(){on.log("[Event] text input:",this.reserve,this.payload);var e=(new TextEncoder).encode(this.payload),n=new DataView(new ArrayBuffer(4+e.length));return n.setUint8(0,t.EventType.TextInput),n.setUint8(1,+this.reserve),n.setUint16(2,e.length),e.forEach((function(t,e){return n.setUint8(e+4,t)})),n.buffer},e}(),_n=function(){function e(e,n,i,o,r,a,s,c,u){void 0===e&&(e=t.GamepadType.GamepadXbox),void 0===n&&(n=0),this.gamepadType=e,this.gamepadUser=n,this.buttons=i,this.leftTrigger=o,this.rightTrigger=r,this.leftThumbX=a,this.leftThumbY=s,this.rightThumbX=c,this.rightThumbY=u}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(16));return e.setUint8(0,t.EventType.GamepadInput),e.setUint8(1,this.gamepadType),e.setUint16(2,this.gamepadUser),e.setUint16(4,this.buttons),e.setUint8(6,this.leftTrigger),e.setUint8(7,this.rightTrigger),e.setInt16(8,this.leftThumbX),e.setInt16(10,this.leftThumbY),e.setInt16(12,this.rightThumbX),e.setInt16(14,this.rightThumbY),e.buffer},e}(),Ln=function(){function e(e,n){void 0===e&&(e=0),void 0===n&&(n=t.GamepadType.GamepadXbox),this.gamepadCount=e,this.gamepadType=n}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(4));return e.setUint8(0,t.EventType.GamepadUpdate),e.setUint8(1,this.gamepadType),e.setUint16(2,this.gamepadCount),e.buffer},e}(),An=function(){function e(e,n,i,o,r,a,s,c,u,d){void 0===e&&(e=BigInt((new Date).getTime())),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=1920),void 0===a&&(a=1080),void 0===s&&(s=0),void 0===c&&(c=t.ImageStoreFormat.BinaryPNG),void 0===u&&(u=t.ImageResultValue.Failure),void 0===d&&(d=new ArrayBuffer(0)),this.timestamp=e,this.index=n,this.left=i,this.top=o,this.width=r,this.height=a,this.size=s,this.format=c,this.result=u,this.payload=d}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(35));return e.setUint8(0,t.EventType.ScreenshotParams),e.setBigUint64(1,this.timestamp),e.setUint32(9,this.index),e.setUint32(13,this.left),e.setUint32(17,this.top),e.setUint32(21,this.width),e.setUint32(25,this.height),e.setUint32(29,0),e.setUint8(33,this.format),e.setUint8(34,this.result),e.buffer},e.parse=function(t){var n=new DataView(t);return new e(n.getBigUint64(1),n.getUint32(9),n.getUint32(13),n.getUint32(17),n.getUint32(21),n.getUint32(25),n.getUint32(29),n.getUint8(33),n.getUint8(34),t.slice(35))},e}();!function(t){t[t.Text=0]="Text",t[t.Image=1]="Image",t[t.QTText=2]="QTText",t[t.QTImage=3]="QTImage",t[t.unsupported=4]="unsupported"}(En||(En={})),function(t){t[t.None=0]="None",t[t.LZ4=1]="LZ4",t[t.ZLIB=2]="ZLIB",t[t.Unknow=3]="Unknow"}(Cn||(Cn={}));var Bn,Kn=function(){function e(t,e){void 0===e&&(e=Cn.None),this.payload=t,this.compressType=e,this.dataType=En.Text,"string"==typeof t&&(this.dataType=En.Text),t instanceof Blob&&(this.dataType=En.Image)}return e.prototype.dumps=function(){return r(this,void 0,void 0,(function(){var e,n,i,o,r;return a(this,(function(a){switch(a.label){case 0:return"string"==typeof this.payload?(e=new TextEncoder,(n=e.encode(this.payload)).byteLength+2>4096?[2,this.splitting(n)]:((i=new DataView(new ArrayBuffer(8+n.byteLength))).setUint8(0,t.EventType.ClipboardData),i.setUint32(1,n.byteLength+2),i.setUint8(5,1),i.setUint8(6,En.Text),i.setUint8(7,Cn.None),n.forEach((function(t,e){return i.setUint8(e+8,t)})),[2,[i.buffer]])):this.payload instanceof Blob?[4,this.payload.arrayBuffer()]:[3,2];case 1:return(o=a.sent()).byteLength+2>4096?[2,this.splitting(o)]:((r=new DataView(new ArrayBuffer(8+o.byteLength))).setUint8(0,t.EventType.ClipboardData),r.setUint32(1,o.byteLength+2),r.setUint8(5,1),r.setUint8(6,En.Image),r.setUint8(7,Cn.None),new Uint8Array(o).forEach((function(t,e){return r.setUint8(e+8,t)})),[2,[r.buffer]]);case 2:return[2,[]]}}))}))},e.parse=function(t){var e=new DataView(t[0]).getUint8(6),n=t.reduce((function(t,e,n){return an(t,e.slice(0===n?8:6))}),new ArrayBuffer(0));return e===En.Image?new Blob([n],{type:"image/png"}):e===En.Text?(new TextDecoder).decode(n):""},e.isLastPacket=function(t){return!!new DataView(t).getUint8(5)},e.prototype.splitting=function(e){var n=this,i=e.byteLength+2,o=Math.floor(i/4096),r=i%4096,a=rn(o).map((function(i){var a,s=0===r&&i+1===o,c=new ArrayBuffer(6),u=new DataView(c);if(u.setUint8(0,t.EventType.ClipboardData),u.setUint32(1,4096),u.setUint8(5,+s),0===i){var d=new DataView(new ArrayBuffer(2));d.setUint8(0,n.dataType),d.setUint8(1,n.compressType),a=an(d.buffer,e.slice(0,4094))}else a=e.slice(4096*(i-1)+4094,4096*i+4094);return an(c,a)}));if(0!==r){var s=new ArrayBuffer(6),c=new DataView(s);c.setUint8(0,t.EventType.ClipboardData),c.setUint32(1,r),c.setUint8(5,1),a.push(an(s,e.slice(-r)))}return a},e}();t.MobileTouchActionType=void 0,(Bn=t.MobileTouchActionType||(t.MobileTouchActionType={}))[Bn.ActionDown=0]="ActionDown",Bn[Bn.ActionUp=1]="ActionUp",Bn[Bn.ActionMove=2]="ActionMove",Bn[Bn.ActionCancel=3]="ActionCancel",Bn[Bn.ActionPointerDown=5]="ActionPointerDown",Bn[Bn.ActionPointerUp=6]="ActionPointerUp";var In,Yn,Un=function(){function e(t,e,n,i){this.action=t,this.pointerId=e,this.x=n,this.y=i}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(17));return e.setUint8(0,t.EventType.MobileTouch),e.setInt32(1,this.action),e.setInt32(5,this.pointerId),e.setInt32(9,this.x),e.setInt32(13,this.y),e.buffer},e}(),Nn=function(){function e(t,e,n,i){this.action=t,this.pointerId=e,this.x=n,this.y=i}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(17));return e.setUint8(0,t.EventType.MobileTouchNormalization),e.setInt32(1,this.action),e.setInt32(5,this.pointerId),e.setFloat32(9,this.x),e.setFloat32(13,this.y),e.buffer},e}();t.MobileKeysActionType=void 0,(In=t.MobileKeysActionType||(t.MobileKeysActionType={}))[In.ActionDown=0]="ActionDown",In[In.ActionUp=1]="ActionUp",t.MobileKeysKeycode=void 0,(Yn=t.MobileKeysKeycode||(t.MobileKeysKeycode={}))[Yn.KeycodeHome=3]="KeycodeHome",Yn[Yn.KeycodeBack=4]="KeycodeBack",Yn[Yn.KeycodeVoiceUp=24]="KeycodeVoiceUp",Yn[Yn.KeycodeVoiceDown=25]="KeycodeVoiceDown",Yn[Yn.KeycodeAppSwitch=187]="KeycodeAppSwitch";var Xn,Hn=function(){function e(t,e,n){void 0===n&&(n=0),this.action=t,this.keycode=e,this.metaState=n}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(7));return e.setUint8(0,t.EventType.MobileKeys),e.setUint8(1,this.action),e.setUint8(2,this.keycode),e.setUint32(3,this.metaState),e.buffer},e}(),Fn=function(){function e(t,e,n,i,o,r){void 0===t&&(t=BigInt(0)),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=!1),this.timestamp=t,this.index=e,this.framerate=n,this.bitrate=i,this.gopLength=o,this.result=r}return e.prototype.dumps=function(){on.log("[Event] encode setting:",this);var e=new DataView(new ArrayBuffer(26));return e.setUint8(0,t.EventType.EncodeSettings),e.setBigUint64(1,this.timestamp),e.setUint32(9,this.index),e.setUint32(13,this.framerate),e.setUint32(17,this.bitrate),e.setUint32(21,this.gopLength),e.setUint8(25,+this.result),e.buffer},e.parse=function(t){var n=new DataView(t);return new e(n.getBigUint64(1),n.getUint32(9),n.getUint32(13),n.getUint32(17),n.getUint32(21),!!n.getUint8(25))},e}(),jn=function(){function e(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.index=t,this.width=e,this.height=n}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(13));return e.setUint8(0,t.EventType.ResolutionSettings),e.setUint32(1,this.index),e.setUint32(5,this.width),e.setUint32(9,this.height),e.buffer},e}(),zn=function(){function e(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=!1),this.width=t,this.height=e,this.result=n}return e.prototype.dumps=function(){on.log("[Event] video encode setting:",this);var e=new DataView(new ArrayBuffer(22));return e.setUint8(0,t.EventType.EncodeResolutionSettings),e.setUint32(13,this.width),e.setUint32(17,this.height),e.setUint8(21,+this.result),e.buffer},e.parse=function(t){var n=new DataView(t);return new e(n.getUint32(13),n.getUint32(17),!!n.getUint8(21))},e}(),Vn=function(){function e(t){void 0===t&&(t=1),this.scale=t}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(5));return e.setUint8(0,t.EventType.MobileResolutionScale),e.setFloat32(1,this.scale),e.buffer},e}(),Wn=function(){function t(t,e,n){void 0===t&&(t=1920),void 0===e&&(e=1080),void 0===n&&(n=1),this.width=t,this.height=e,this.scale=n}return t.parse=function(e){var n=new DataView(e);return new t(n.getUint32(1),n.getUint32(5),n.getFloat32(9,!0))},t}(),Gn=function(){function e(t,e,n,i){void 0===t&&(t=BigInt(0)),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=new ArrayBuffer(0)),this.timestamp=t,this.index=e,this.dataSize=n,this.data=i}return e.fromCodec=function(t){var n=new ArrayBuffer(t.byteLength);return t.copyTo(n),new e(BigInt(t.timestamp),0,t.byteLength,n)},e.prototype.dumps=function(){var e=new ArrayBuffer(17),n=new DataView(e);n.setUint8(0,t.EventType.MicrophoneData),n.setBigUint64(1,BigInt(this.timestamp)),n.setUint32(9,this.index),n.setUint32(13,this.dataSize);var i=new Uint8Array(17+this.dataSize);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(this.data),17),i.buffer},e}(),Zn=function(){function e(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),this.x=t,this.y=e,this.direction=n}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(13));return e.setUint8(0,t.EventType.MobileScroll),e.setFloat32(1,this.x),e.setFloat32(5,this.y),e.setUint32(9,this.direction),e.buffer},e}(),Qn=function(){function e(t){this.resolutionSet=t}return e.prototype.dumps=function(){var e=this,n=new DataView(new ArrayBuffer(1+12*this.resolutionSet.length));return n.setUint8(0,t.EventType.QueryResolutions),rn(this.resolutionSet.length).forEach((function(t){n.setUint32(1+12*t,e.resolutionSet[t][0]),n.setUint32(5+12*t,e.resolutionSet[t][1]),n.setUint32(9+12*t,e.resolutionSet[t][2])})),n.buffer},e.parse=function(t){var n=new DataView(t);return new e(rn((t.byteLength-1)/12).map((function(t){return[n.getUint32(12*t+1),n.getUint32(12*t+5),n.getUint32(12*t+9)]})))},e}(),Jn=function(){function e(t,e,n,i,o,r){void 0===t&&(t=BigInt(0)),void 0===e&&(e=BigInt(0)),void 0===n&&(n=BigInt(0)),void 0===i&&(i=BigInt(0)),void 0===o&&(o=BigInt(0)),this.createTime=t,this.modifyTime=e,this.accessTime=n,this.fileUnique=i,this.fileSize=o,this.fileName=r}return e.prototype.dumps=function(){var e=(new TextEncoder).encode(this.fileName),n=new DataView(new ArrayBuffer(45+e.byteLength));return n.setUint8(0,t.EventType.FileRequest),n.setBigUint64(1,this.createTime),n.setBigUint64(9,this.modifyTime),n.setBigUint64(17,this.accessTime),n.setBigUint64(25,this.fileUnique),n.setBigUint64(33,this.fileSize),n.setUint32(41,e.byteLength),e.forEach((function(t,e){return n.setUint8(e+45,t)})),n.buffer},e.parse=function(t){var n=new DataView(t),i=n.getBigUint64(1),o=n.getBigUint64(9),r=n.getBigUint64(17),a=n.getBigUint64(25),s=n.getBigUint64(33),c=[t].reduce((function(t,e){return an(t,e.slice(45))}),new ArrayBuffer(0));return new e(i,o,r,a,s,(new TextDecoder).decode(c))},e}(),qn=function(){function e(t,e){void 0===t&&(t=BigInt(0)),this.fileUnique=t,this.result=e}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(10));return e.setUint8(0,t.EventType.FileResponse),e.setBigUint64(1,this.fileUnique),e.setUint8(9,+this.result),e.buffer},e.parse=function(t){var n=new DataView(t);return new e(n.getBigUint64(1),!!n.getUint8(9))},e}(),$n=function(){function e(t,e){void 0===t&&(t=BigInt(0)),this.fileUnique=t,this.payload=e}return e.prototype.dumps=function(){return r(this,void 0,void 0,(function(){var e,n;return a(this,(function(i){switch(i.label){case 0:return[4,this.payload.arrayBuffer()];case 1:return(e=i.sent()).byteLength>4096?[2,this.splitting(e)]:((n=new DataView(new ArrayBuffer(14+e.byteLength))).setUint8(0,t.EventType.FileContent),n.setBigUint64(1,this.fileUnique),n.setUint32(9,this.payload.size),n.setUint8(13,1),new Uint8Array(e).forEach((function(t,e){return n.setUint8(e+14,t)})),[2,[n.buffer]])}}))}))},e.parse=function(t){var e=new DataView(t[0]).getBigUint64(1);return{data:t.reduce((function(t,e){return an(t,e.slice(14))}),new ArrayBuffer(0)),fileUnique:e}},e.isLastPart=function(t){return!!new DataView(t).getUint8(13)},e.prototype.splitting=function(e){var n=this,i=e.byteLength,o=Math.floor(i/4096),r=i%4096,a=rn(o).map((function(i){var a=0===r&&i+1===o,s=e.slice(4096*(i-1)+4096,4096*i+4096),c=new DataView(new ArrayBuffer(14+s.byteLength));return c.setUint8(0,t.EventType.FileContent),c.setBigUint64(1,n.fileUnique),c.setUint32(9,4096),c.setUint8(13,+a),new Uint8Array(s).forEach((function(t,e){return c.setUint8(e+14,t)})),c.buffer}));if(0!==r){var s=new ArrayBuffer(14),c=new DataView(s);c.setUint8(0,t.EventType.FileContent),c.setBigUint64(1,this.fileUnique),c.setUint32(9,r),c.setUint8(13,1),a.push(an(s,e.slice(-r)))}return a},e}(),ti=function(){function e(t,e){void 0===t&&(t=BigInt(0)),this.fileUnique=t,this.result=e}return e.prototype.dumps=function(){var e=new DataView(new ArrayBuffer(10));return e.setUint8(0,t.EventType.FileFinish),e.setBigUint64(1,this.fileUnique),e.setUint8(9,+this.result),e.buffer},e.parse=function(t){var e=new DataView(t),n=e.getBigUint64(1),i=!!e.getUint8(9);return new qn(n,i)},e}();t.BandwidthDetectResult=void 0,(Xn=t.BandwidthDetectResult||(t.BandwidthDetectResult={}))[Xn.Failure=0]="Failure",Xn[Xn.Success=1]="Success",Xn[Xn.Portion=2]="Portion";var ei,ni=function(){function e(t,e,n,i,o,r,a){this.timestamp=t,this.frameRate=e,this.bitrate=n,this.dataSize=i,this.duration=o,this.start=r,this.result=a}return e.parse=function(t){var n=new DataView(t);return new e(n.getBigUint64(1),n.getUint32(9),n.getUint32(13),n.getUint32(17),n.getUint16(21),!!n.getUint8(23),n.getUint8(24))},e.prototype.dumps=function(){on.log("[Event] bandwidth detect:",this);var e=new DataView(new ArrayBuffer(25));return e.setUint8(0,t.EventType.BandwidthDetect),e.setBigUint64(1,this.timestamp),e.setUint32(9,this.frameRate),e.setUint32(13,this.bitrate),e.setUint32(17,this.dataSize),e.setUint16(21,this.duration),e.setUint8(23,+this.start),e.setUint8(24,this.result),e.buffer},e}();function ii(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!0);var i=t.target,o=i.getBoundingClientRect(),r=o.left,a=o.top,s=t.clientX,c=t.clientY,u=t.movementY,d=t.movementX,h=i.clientHeight,l=i.clientWidth,p=i.videoHeight,f=i.videoWidth,v=Math.max(s-r,0),m=Math.max(c-a,0),y=(e?f:65535)/l,g=(e?p:65535)/h,E=(e?f:32767)/l,C=(e?p:32767)/h;return{x:Math.min(n?v:m,l)*y,y:Math.min(n?m:h-v,h)*g,dx:(n?d:u)*E,dy:(n?u:-d)*C}}function oi(t,e,n){void 0===n&&(n=!0);var i=t.target,o=i.getBoundingClientRect(),r=o.left,a=o.top,s=i.videoWidth,c=i.videoHeight,u=i.clientHeight,d=s/i.clientWidth,h=c/u,l=e?1===t.touches.length:0===t.touches.length;return Array.from(t.changedTouches).map((function(t){var e=t.clientX,i=t.clientY,o=e-r,s=i-a;return{x:(n?o:s)*d,y:(n?s:u-o)*h,id:t.identifier,force:t.force,isAction:l}}))}!function(t){t[t.TouchDown=0]="TouchDown",t[t.TouchMove=1]="TouchMove",t[t.TouchUp=2]="TouchUp"}(ei||(ei={}));var ri=function(){function t(t,e){this.x=t,this.y=e}return t.fromTouch=function(e){return new t(e.pageX,e.pageY)},t}();function ai(t,e){return Math.hypot(e.x-t.x,e.y-t.y)}function si(t){var e=c(Array.from(t[0].targetTouches),2),n=e[0],i=e[1],o=c(Array.from(t[1].targetTouches),2),r=o[0],a=o[1];return ai(ri.fromTouch(r),ri.fromTouch(a))-ai(ri.fromTouch(n),ri.fromTouch(i))}function ci(t){var e=c(t,2),n=e[0],i=e[1],o=i.targetTouches[0].clientX-n.targetTouches[0].clientX,r=i.targetTouches[0].clientY-n.targetTouches[0].clientY;return{target:n.target,clientX:n.targetTouches[0].clientX,clientY:n.targetTouches[0].clientY,movementX:o,movementY:r}}function ui(t,e,n){return{target:t.target,clientX:t.clientX,clientY:t.clientY,movementX:t.movementX*e,movementY:t.movementY*n}}function di(t){var e=t.target.getBoundingClientRect(),n=e.left,i=e.top,o=e.right,r=e.bottom,a=t.clientY,s=t.clientX,c=Math.abs(i-a),u=Math.abs(r-a),d=Math.abs(n-s),h=Math.abs(o-s);switch(Math.min(c,u,d,h)){case d:return{target:t.target,clientX:0,clientY:a,movementY:0,movementX:0};case c:return{target:t.target,clientX:s,clientY:0,movementY:0,movementX:0};default:return{target:t.target,clientX:s,clientY:a,movementY:0,movementX:0}}}function hi(t,e){void 0===e&&(e=!0);var n=t.target,i=n.getBoundingClientRect(),o=i.left,r=i.top,a=t.clientX,s=t.clientY,c=n.clientHeight,u=n.clientWidth,d=Math.max(a-o,0),h=Math.max(s-r,0);return{x:Math.min(e?d:h,u)/u,y:Math.min(e?h:c-d,c)/c}}function li(t,e,n){void 0===n&&(n=!0);var i=t.target,o=i.getBoundingClientRect(),r=o.left,a=o.top,s=i.clientHeight,c=i.clientWidth,u=e?1===t.touches.length:0===t.touches.length;return Array.from(t.changedTouches).map((function(t){var e=t.clientX,i=t.clientY,o=e-r,d=i-a;return{x:(n?o:d)/c,y:(n?d:s-o)/s,id:t.identifier,force:t.force,isAction:u}}))}function pi(t){return t.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}function fi(t,e){var n="AS";return"firefox"===mt.browserDetails.browser&&(e=1e3*(e>>>0),n="TIAS"),t=-1===t.indexOf("b="+n+":")?t.replace(/c=IN (.*)\r\n/g,"c=IN $1\r\nb="+n+":"+e+"\r\n"):t.replace(new RegExp("b="+n+":.*\r\n"),"b="+n+":"+e+"\r\n")}function vi(){return"getCoalescedEvents"in PointerEvent.prototype}function mi(){return"pointerrawupdate"in document}var yi,gi=new(function(){function t(){this.APINameMap="exitFullscreen"in document?{requestFullscreen:"requestFullscreen",exitFullscreen:"exitFullscreen",fullscreenElement:"fullscreenElement",fullscreenEnabled:"fullscreenEnabled",fullscreenchange:"fullscreenchange"}:"webkitExitFullscreen"in document?{requestFullscreen:"webkitRequestFullscreen",exitFullscreen:"webkitExitFullscreen",fullscreenElement:"webkitFullscreenElement",fullscreenEnabled:"webkitFullscreenEnabled",fullscreenchange:"webkitfullscreenchange"}:{requestFullscreen:"mozRequestFullScreen",exitFullscreen:"mozCancelFullScreen",fullscreenElement:"mozFullScreenElement",fullscreenEnabled:"mozFullScreenEnabled",fullscreenchange:"mozfullscreenchange"}}return Object.defineProperty(t.prototype,"isFullscreen",{get:function(){return Boolean(document[this.APINameMap.fullscreenElement])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return document[this.APINameMap.fullscreenElement]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return Boolean(document[this.APINameMap.fullscreenEnabled])},enumerable:!1,configurable:!0}),t.prototype.request=function(t,e,n){var i=this;return void 0===n&&(n="landscape-primary"),new Promise((function(o,r){var a=function(){screen.orientation.lock(n).catch((function(t){return on.warn(t)})),document.removeEventListener(i.APINameMap.fullscreenchange,a),i.off(a),"keyboard"in navigator&&"lock"in navigator.keyboard&&navigator.keyboard.lock(["KeyW","Escape","KeyN","KeyT","MetaLeft"]),o()};i.on(a);var s=(t||document.documentElement)[i.APINameMap.requestFullscreen](e);s instanceof Promise&&s.then(a).catch(r)}))},t.prototype.exit=function(){var t=this;return new Promise((function(e,n){if(t.isFullscreen){var i=function(){t.off(i),e()};t.on(i);var o=document[t.APINameMap.exitFullscreen]();o instanceof Promise&&o.then(i).catch(n)}else e()}))},t.prototype.toggle=function(t,e,n){return void 0===n&&(n="landscape-primary"),this.isFullscreen?this.exit():this.request(t,e,n)},t.prototype.on=function(t){document.addEventListener(this.APINameMap.fullscreenchange,t)},t.prototype.off=function(t){document.removeEventListener(this.APINameMap.fullscreenchange,t)},t}()),Ei=function(){function t(){this.timer=NaN,this.idleTime=0}return t.prototype.reset=function(){this.idleTime=0},t.prototype.start=function(){var t=this;this.timer=window.setInterval((function(){t.idleTime+=1e3}),1e3)},t.prototype.clear=function(){window.clearInterval(this.timer)},t}(),Ci=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))};!function(t){t[t.CursorRelativeHide=0]="CursorRelativeHide",t[t.CursorAbsoluteShow=1]="CursorAbsoluteShow",t[t.CursorAbsoluteHide=2]="CursorAbsoluteHide"}(yi||(yi={}));var wi=function(){function t(t,e,n,i,o,r){void 0===t&&(t=""),void 0===e&&(e=yi.CursorAbsoluteShow),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),this.base64=t,this.show=e,this.x=n,this.y=i,this.width=o,this.height=r}return t.parse=function(e){var n=new DataView(e),i=n.getUint32(1),o=n.getUint32(5),r=n.getUint32(9),a=n.getUint32(13),s=n.getUint32(21),c=n.getUint32(25),u=n.getUint8(33);if(on.info("[Event] cursor data:",{x:i,y:o,width:r,height:a,pitch:s,length:c,show:u}),0===u)return new t("",u,i,o);if(1===u&&0===r&&0===a)return new t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAW5JREFUWEft1UFLwmAYB/DnfTdJU6JFoQaBp0pUukQ7edpxHfo8fYvoFHToE3TRoMsET9IhgsjEqwQx7LCRI8u5Jx5DqXTWwXe7bB/g+f+e/969Y8BWnkFOHMHAvIEQHkYABvwR5aXjMBAjAHp2hnOlFgZiAqD2w0D8AISBmAIEjZgJCBLhCwgKMRfw/uFCIr4h9OuYC6AWbLsHirIlDPEngBCm2YVsdlsI4l8AQnQ6T5DLlWqIlrbIG3sK4Dh9SCbjowy6mH6HCQVQeCqVdirVy+ShrhHA4Fw+GQ5fKovc+vusSQPjcIglNOb2zz3PKn7VXnxAtEtCAb1XM0ObUzj9ERlTqvX6tV4uHwDna1ecS2eiWmCMrRqInjoOH20aS6vg9i/Qs3ZbrTYUCuo9or0nogXmN5RaaDYbej6/Q2fhFtHaDxQAy+ub8DYwOJManiSdwqB7FyxARNqMmb6vIKB8iABRA1EDUQNRA6E38Am2pNQhmjRmGAAAAABJRU5ErkJggg==",u,i,o);if(r*a*4===c){for(var d=new Uint8ClampedArray(e,34),h=0;h<d.length;h+=4){var l=d[h];d[h]=d[h+2],d[h+2]=l}try{return new t(t.createBitamp(r,a,d),u,i,o,r,a)}catch(e){return new t("",u,i,o,r,a)}}else if(s*a*2===c)try{var p=t.createBitamp(r,a,t.createPixel(new Int8Array(e.slice(34),0,s*a),new Int8Array(e.slice(34),s*a,s*a),r,a,s));return new t(p,u,i,o)}catch(e){return new t("",u,i,o)}return new t("",u,i,o)},t.createBitamp=function(t,e,n){var i=document.createElement("canvas"),o=i.getContext("2d");i.width=t,i.height=e;var r=o.createImageData(t,e);return r.data.set(n),o.putImageData(r,0,0),i.toDataURL()},t.createPixel=function(t,e,n,i,o){for(var r=4278190080,a=0,s=0,c=0,u=0,d=new Uint32Array(o*i*8),h=0;h<i;h++)for(var l=0;l<n;l++)l%8==0&&(a=e[c],s=t[c],c++),d[u]=128&s?128&a?r:4294967295:128&a?r:0,u++,a<<=1,s<<=1;for(var p=new DataView(d.buffer),f=new Uint8ClampedArray(4*d.length),v=0;v<d.length;v++)f[4*v+0]=p.getUint8(4*v+0),f[4*v+1]=p.getUint8(4*v+1),f[4*v+2]=p.getUint8(4*v+2),f[4*v+3]=p.getUint8(4*v+3);return f},t}(),bi=function(){var t=this;this.listeners=[],this.listenersOncer=[],this.on=function(e){return t.listeners.push(e),{dispose:function(){return t.off(e)}}},this.once=function(e){t.listenersOncer.push(e)},this.off=function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)},this.offAll=function(){t.listenersOncer=[],t.listeners=[]},this.emit=function(e){t.listeners.forEach((function(t){return t(e)})),t.listenersOncer.forEach((function(t){return t(e)})),t.listenersOncer=[]},this.pipe=function(e){return t.on((function(t){return e.emit(t)}))}},Di=function(){function t(){this.currentID=0,this.executeMap=new Map}return t.prototype.obtainID=function(){return this.currentID>=65535?this.currentID=0:++this.currentID},t.prototype.trigger=function(t,e){this.executeMap.has(t)&&(this.executeMap.get(t).resolve(e),this.executeMap.delete(t))},t.prototype.order=function(t){var e=this.obtainID();return this.executeMap.set(e,t),e},t}(),Ti=function(){function t(t,e,n){void 0===e&&(e=function(){}),void 0===n&&(n=!1);var i=this;this.target=t,this.onExit=e,this.disablePointerLock=n,this.cursor=new wi,this.handleVisibilityChange=function(){"visible"!==document.visibilityState||i.cursor.show||i.disablePointerLock||i.target.requestPointerLock()},this.handlePointerLockError=function(){document.removeEventListener("click",i.detectClickInteraction),document.removeEventListener("keydown",i.detectKeydownInteraction),document.addEventListener("click",i.detectClickInteraction,{once:!0}),document.addEventListener("keydown",i.detectKeydownInteraction,{once:!0})},this.handlePointerLockChange=function(){i.isPointerLocking||i.cursor.show||gi.isFullscreen||i.onExit()},this.detectClickInteraction=function(){i.cursor.show||i.disablePointerLock||(i.target.requestPointerLock(),document.removeEventListener("keydown",i.detectKeydownInteraction))},this.detectKeydownInteraction=function(){i.cursor.show||i.disablePointerLock||(i.target.requestPointerLock(),document.removeEventListener("click",i.detectClickInteraction))},t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.addEventListener("pointerlockchange",this.handlePointerLockChange),document.addEventListener("pointerlockerror",this.handlePointerLockError),document.addEventListener("visibilitychange",this.handleVisibilityChange)}return t.prototype.destory=function(){this.target.style.cursor="default",document.removeEventListener("pointerlockerror",this.handlePointerLockChange),document.removeEventListener("pointerlockchange",this.handlePointerLockError),document.removeEventListener("visibilitychange",this.handleVisibilityChange)},t.prototype.setCursor=function(t){var e=this;if(this.cursor=t,this.disablePointerLock||(t.show===yi.CursorRelativeHide&&this.target.requestPointerLock(),t.show===yi.CursorAbsoluteShow&&document.exitPointerLock()),t.show===yi.CursorAbsoluteShow){var n=document.createElement("img");n.src=t.base64,n.onload=function(){if(n.width>32||n.height>32){var i=function(t){var e=document.createElement("canvas"),n=t.width>32?32:t.width,i=t.height>32?32:t.height;e.width=n,e.height=i;var o=e.getContext("2d");return null==o||o.drawImage(t,0,0,n,i),e.toDataURL()}(n);e.target.style.cursor="url(".concat(i,") ").concat(t.x," ").concat(t.y,", auto")}else e.target.style.cursor="url(".concat(t.base64,") ").concat(t.x," ").concat(t.y,", auto")}}else this.target.style.cursor="none"},Object.defineProperty(t.prototype,"isPointerLocking",{get:function(){return(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement)===this.target},enumerable:!1,configurable:!0}),t}(),xi=function(){function t(){this.IdentifierMap=new Map(Array.from({length:10},(function(t,e){return[e,""]})))}return t.prototype.trigger=function(t){var e=u([],c(this.IdentifierMap),!1).findIndex((function(t){var e=c(t,2);return e[0],""===e[1]}));this.IdentifierMap.set(e,"".concat(t))},t.prototype.shift=function(t){var e=u([],c(this.IdentifierMap),!1).findIndex((function(e){var n=c(e,2);return n[0],n[1]==="".concat(t)}));this.IdentifierMap.set(e,"")},t.prototype.get=function(t){return u([],c(this.IdentifierMap),!1).findIndex((function(e){var n=c(e,2);return n[0],n[1]==="".concat(t)}))},t}(),Si=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e=!0);var n=this;this.remoteClipboardData="",this.copied=new bi,this.handleFocusSyncData=function(){window.removeEventListener("focus",n.getDataFromClipboard),window.addEventListener("focus",n.getDataFromClipboard,{once:!0})},this.clearLegaluserGestureEvent=function(t){t.removeEventListener("click",n.getDataFromClipboard),t.removeEventListener("keydown",n.getDataFromClipboard)},this.detectionBootstrap=function(){n.clearEventsOnTargets(),n.targets.forEach((function(t){n.detectLegalUserGesture(t)}))},this.getDataFromClipboard=function(){return r(n,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,this.syncFromClipboard()];case 1:return(t=e.sent()).length&&this.copied.emit(t),[2]}}))}))},this.targets=e?u([],c(t),!1):t,window.addEventListener("copy",this.detectionBootstrap),window.addEventListener("blur",this.detectionBootstrap),window.addEventListener("blur",this.handleFocusSyncData)}return t.prototype.destroy=function(){window.removeEventListener("blur",this.detectionBootstrap),window.removeEventListener("copy",this.detectionBootstrap),window.removeEventListener("blur",this.handleFocusSyncData),window.removeEventListener("focus",this.getDataFromClipboard),this.clearEventsOnTargets()},t.prototype.syncToClipboard=function(t){var e=this;return new Promise((function(n){var i;try{"string"==typeof t?navigator.clipboard.writeText(t):navigator.clipboard.write([new ClipboardItem((i={},i[t.type]=t,i))]),n(!0)}catch(i){on.error("[ClipboardSyncManager] No access to clipboard."),e.remoteClipboardData=t,n(!1)}}))},t.prototype.detectLegalUserGesture=function(t){t.addEventListener("click",this.getDataFromClipboard,{once:!0}),t.addEventListener("keydown",this.getDataFromClipboard,{once:!0})},t.prototype.clearEventsOnTargets=function(){var t=this;this.targets.forEach((function(e){return t.clearLegaluserGestureEvent(e)}))},t.prototype.syncFromClipboard=function(){var t=this;return new Promise((function(e){return r(t,void 0,void 0,(function(){var t,n,i,o,r,u,d,h,l,p,f,v;return a(this,(function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return a.trys.push([1,13,,14]),[4,navigator.clipboard.read()];case 2:n=c.apply(void 0,[a.sent(),1]),i=n[0],on.info("[ClipboardSyncManager] Read data from clipboard."),a.label=3;case 3:a.trys.push([3,10,11,12]),o=s(i.types),r=o.next(),a.label=4;case 4:return r.done?[3,9]:(u=r.value,[4,i.getType(u)]);case 5:return"text/plain"!==(d=a.sent()).type&&"text/html"!==d.type?[3,7]:[4,new Response(d).text()];case 6:return h=a.sent(),t.push({type:d.type,data:h}),[3,8];case 7:t.push({type:d.type,data:d}),a.label=8;case 8:return r=o.next(),[3,4];case 9:return[3,12];case 10:return l=a.sent(),f={error:l},[3,12];case 11:try{r&&!r.done&&(v=o.return)&&v.call(o)}finally{if(f)throw f.error}return[7];case 12:return this.clearEventsOnTargets(),[3,14];case 13:return p=a.sent(),this.detectionBootstrap(),on.error("[ClipboardSyncManager]",p),[3,14];case 14:return e(t),[2]}}))}))}))},t}(),Oi=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.receiveFirstTime=t,this.receiveLastTime=e,this.receiveDataSize=n,this.detectDuration=i}return t.prototype.reset=function(){this.receiveFirstTime=0,this.receiveLastTime=0,this.receiveDataSize=0,this.detectDuration=0},t}(),Mi=function(){function e(e,n){var i=this;this.dc=e,this.onFinish=n,this.timerID=NaN,this.bandwidthStatistics=new Oi,this.handler=function(e){if(sn(e.data)===t.EventType.BandwidthDetect){var n=ni.parse(e.data);on.log("[BandwidthDetectHelper] receive data size: ".concat(n.dataSize,", result: ").concat(n.result," timestamp: ").concat(n.timestamp)),i.bandwidthStatistics.receiveDataSize+=n.dataSize,i.bandwidthStatistics.receiveFirstTime||(i.bandwidthStatistics.receiveFirstTime=Date.now()),n.result===t.BandwidthDetectResult.Failure?i.end():n.result===t.BandwidthDetectResult.Success&&(i.bandwidthStatistics.receiveLastTime=Date.now(),i.calculateBandwidth())}}}return e.prototype.calculateBandwidth=function(){this.timerID&&(window.clearTimeout(this.timerID),this.timerID=NaN);var t=this.bandwidthStatistics,e=t.receiveDataSize,n=t.receiveLastTime,i=t.receiveFirstTime,o=Number(n-i),r=8*e,a=r/o;on.info("[BandwidthDetectHelper] success with receivedBytes: ".concat(r,", duration: ").concat(o,", bitrate: ").concat(a)),this.end(a)},e.prototype.end=function(t){this.dc.removeEventListener("message",this.handler),this.onFinish(t)},e.prototype.start=function(){var t=this;this.bandwidthStatistics.reset(),this.dc.addEventListener("message",this.handler),on.info("[BandwidthDetectHelper] detect with fps: ".concat(60," bitrate: ").concat(2e4)),this.dc.send(new ni(BigInt(Date.now()),60,2e4,4096,5,!0,0).dumps()),this.timerID=window.setTimeout((function(){on.info("[BandwidthDetectHelper] time out"),t.bandwidthStatistics.receiveLastTime=Date.now(),t.calculateBandwidth()}),6e3)},e}(),Pi=function(){function e(t,e,n,i,o,r,a,s,c,u){void 0===n&&(n="all"),void 0===i&&(i=2e3),void 0===o&&(o=5e3),void 0===r&&(r=4e3),void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===c&&(c=5e3),void 0===u&&(u=!1);var d=this;this.url=t,this.iceServers=e,this.iceTransportPolicy=n,this.minBitrate=i,this.maxBitrate=o,this.startBitrate=r,this.enableAFK=a,this.isMobile=s,this.answerDelayHint=c,this.enableBandwidthDetect=u,this.candidateCache=[],this.event={connect:new bi,afk:new bi,open:new bi,close:new bi,queue:new bi,ready:new bi,endCandidate:new bi,cursor:new bi,hangUp:new bi,disconnect:new bi,receivedLink:new bi,receivedTrack:new bi,receivedStream:new bi,dataChannelConnected:new bi,peerConnectionConnected:new bi,interaction:new bi,occupy:new bi,kick:new bi,networkChanged:new bi,echo:new bi,screenshot:new bi,screenshotData:new bi,kickOut:new bi,clientInfo:new bi,clipboard:new bi,encodeSettings:new bi,mobileResolutionInfo:new bi,resolutionInfo:new bi,encodeResolutionSettings:new bi,receivedFile:new bi,fileTransferApply:new bi,bandwidthDetect:new bi},this.token="",this.afk=new Ei,this.fileUploadHandlerMap=new Map([]),this.fileReceivedMap=new Map([]),this.tan=new Di,this.ready=!1,this.answerDelayTimer=NaN,this.mediaStream=new MediaStream,this.token=t.split("/").pop(),this.pc=new RTCPeerConnection({iceServers:e,iceTransportPolicy:n}),this.setupPeerConnection(),this.dc=this.pc.createDataChannel("sendChannel"),this.dc.binaryType="arraybuffer",this.setupDataChannel(),this.subject=new nn({url:t,closeObserver:{next:function(t){return d.event.close.emit(t)}},openObserver:{next:function(t){return d.event.open.emit(t)}}}),this.setupSigning()}return e.prototype.setupSigning=function(){var t=this;this.subject.subscribe({next:function(e){switch(on.info("[Socket] [Received] message:",e),e.action){case"connect":t.event.connect.emit(e);break;case"sdpOffer":on.info("[Socket] [Received] offer",e.data),t.pc.setRemoteDescription(e.data),t.pc.createAnswer().then((function(e){t.pc.setLocalDescription(e),on.info("[Socket] [Send] answer",e),t.subject.next({action:"sdpAnswer",data:e})}));break;case"candidate":on.info("[Socket] [Received] candidate",e.data),t.pc.remoteDescription?t.pc.addIceCandidate(e.data).then((function(){return on.info("[PeerConnection] Add ice candidate success: ",e.data)})).catch((function(t){return on.info("[PeerConnection] Failed to add ice candidate: ",t)})):t.candidateCache.push(e.data);break;case"sdpAnswer":window.clearTimeout(t.answerDelayTimer),t.answerDelayTimer=NaN,on.info("[Socket] [Received] answer",e.data),t.pc.setRemoteDescription(e.data).then((function(){on.info("[PeerConnection]","Set remote description success",e.data),t.candidateCache.forEach((function(e){return t.pc.addIceCandidate(e).then((function(){return on.info("[PeerConnection] Add ice candidate success: ",e)})).catch((function(t){return on.info("[PeerConnection] Failed to add ice candidate: ",t)}))})),t.candidateCache.length=0}));break;case"ready":t.ready||(t.ready=!0,t.linkStart(),t.event.ready.emit(e));break;case"queue":t.event.queue.emit(e.data.queueNum);break;case"peerDisconnected":t.event.disconnect.emit(e.message);break;case"operateOverTime":t.event.afk.emit(t.afk.idleTime);break;case"unready":try{on.info("[Socket] [Send] verify",t.token),t.subject.next({action:"verify",data:{token:t.token}})}catch(t){on.error("[Error]",t)}break;case"hangUp":t.event.hangUp.emit(),t.hangUp();break;case"kick":t.event.kick.emit(e.message),t.destory();break;case"clientInfo":t.event.clientInfo.emit(e.data)}},error:function(e){on.warn("[Error]",e),t.event.disconnect.emit(e)},complete:function(){t.event.disconnect.emit("complete"),on.warn("[Warn]","[Complete]")}})},e.prototype.setupPeerConnection=function(){var t=this;this.pc.onicecandidate=function(e){e.candidate?(on.info("[Socket] [Send] candidate",e.candidate),t.subject.next({action:"candidate",data:e.candidate})):(on.info("[Socket] [Received] and got final candidate!"),t.event.endCandidate.emit(e))},this.pc.ontrack=function(e){on.info("[Socket] [Received] track",e.track),t.event.receivedTrack.emit(e.track),t.mediaStream.addTrack(e.track),t.mediaStream.getTracks().length>=2&&t.event.receivedStream.emit(t.mediaStream)},this.pc.onconnectionstatechange=function(e){on.info("[PeerConnection] connection state change",t.pc.connectionState),"connected"===t.pc.connectionState&&t.event.peerConnectionConnected.emit(e),"failed"===t.pc.connectionState&&t.event.networkChanged.emit("PeerConnection state change to failed")}},e.prototype.setupDataChannel=function(){var e=this,n=Ke(this.dc,"close");this.dc.onopen=function(t){on.info("[Socket] [DataChannel] data channel has been open"),Ne(3e4).pipe(Qe(n)).subscribe((function(t){return e.subject.next({action:"heartbeat"})})),e.enableAFK&&(e.afk.start(),Ne(1e4).pipe(Qe(n)).subscribe((function(t){return e.subject.next({action:"afk",data:{idleTime:e.afk.idleTime}})}))),e.event.dataChannelConnected.emit(t),e.enableBandwidthDetect&&(e.event.bandwidthDetect.emit(),new Mi(e.dc,(function(t){if(t){var n=.8*t;e.changeCodecOptions({bitrate:Math.min(e.startBitrate,n)})}})).start())};var i=Ke(this.dc,"message").pipe(Qe(n),Je((function(t){return on.log("[DataChannel] [EventType]: ",sn(t.data))})),Se((function(t){return t.data})),We());i.pipe(He((function(e){return sn(e)===t.EventType.CursorData})),Se((function(t){return wi.parse(t)}))).subscribe((function(t){return e.event.cursor.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.MobileResolutionInfo})),Se((function(t){return Wn.parse(t)}))).subscribe((function(t){return e.event.mobileResolutionInfo.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.KickOutController})),Se((function(t){return cn(t,1)}))).subscribe((function(t){return e.event.kickOut.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.QueryResolutions})),Se((function(t){return Qn.parse(t)}))).subscribe((function(t){return e.event.resolutionInfo.emit(t.resolutionSet)})),i.pipe(He((function(e){return sn(e)===t.EventType.URLIntercept})),Se((function(t){return cn(t,8)}))).subscribe((function(t){return e.event.receivedLink.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.EncodeSettings})),Se((function(t){return Fn.parse(t)})),Je((function(t){return on.info("[DataChannel] Received codec options ",t)})),He((function(t){return t.result}))).subscribe((function(t){return e.event.encodeSettings.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.EncodeResolutionSettings})),Se((function(t){return zn.parse(t)})),Je((function(t){return on.info("[DataChannel] Received video encode resolution ",t)})),He((function(t){return t.result}))).subscribe((function(t){return e.event.encodeResolutionSettings.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.WebRTCForwardTextREQ})),Se((function(t){return cn(t,1)}))).subscribe((function(t){return e.event.interaction.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.WebRTCForwardBinaryREQ})),Se((function(t){return t.slice(1)}))).subscribe((function(t){return e.event.interaction.emit(t)}));var o=i.pipe(He((function(e){return sn(e)===t.EventType.ScreenshotParams})),Se((function(t){return An.parse(t)})),We());o.subscribe((function(t){return e.event.screenshotData.emit(t.payload.byteLength)})),o.pipe(Fe(o.pipe(He((function(e){return e.result===t.ImageResultValue.Success})))),He((function(t){return 0!==t.length})),Se((function(t){return t.map((function(t){return t.payload}))})),Se((function(t){return new Blob(t,{type:"image/png"})}))).subscribe((function(t){return e.event.screenshot.emit(t)})),i.pipe(He((function(e){return[t.EventType.WebRTCForwardTextRSP,t.EventType.WebRTCForwardBinaryRSP].includes(sn(e))})),Se((function(t){return kn.fromDataChannel(t)}))).subscribe((function(t){return e.tan.trigger(t.id,t.success)}));var r=i.pipe(He((function(e){return sn(e)===t.EventType.ClipboardData})),We());r.pipe(Fe(r.pipe(He((function(t){return Kn.isLastPacket(t)})))),He((function(t){return 0!==t.length})),Se((function(t){return Kn.parse(t)}))).subscribe((function(t){return e.event.clipboard.emit(t)})),i.pipe(He((function(e){return[t.EventType.EchoData,t.EventType.EventDelay].includes(sn(e))})),Se((function(t){return Tn.decode(t)}))).subscribe((function(t){var n=t.timestamp;return e.event.echo.emit(~~performance.now()-n)})),i.pipe(He((function(e){return sn(e)===t.EventType.FileRequest})),Se((function(t){return Jn.parse(t)})),Je((function(t){return e.fileReceivedMap.set(t.fileUnique,t)}))).subscribe((function(t){return e.event.fileTransferApply.emit(t)})),i.pipe(He((function(e){return sn(e)===t.EventType.FileResponse})),Se((function(t){return qn.parse(t)}))).subscribe((function(t){var n;return t.result&&(null===(n=e.fileUploadHandlerMap.get(t.fileUnique))||void 0===n?void 0:n(t.result))}));var a=i.pipe(He((function(e){return sn(e)===t.EventType.FileContent})),We());a.pipe(Fe(a.pipe(He((function(t){return $n.isLastPart(t)})))),He((function(t){return 0!==t.length})),Se((function(t){return $n.parse(t)}))).subscribe((function(t){var n,i=t.data,o=t.fileUnique,r=null===(n=e.fileReceivedMap.get(o))||void 0===n?void 0:n.fileName;e.fileReceivedMap.delete(o),e.event.receivedFile.emit({data:i,name:r})})),i.pipe(He((function(e){return sn(e)===t.EventType.FileFinish})),Se((function(t){return ti.parse(t)}))).subscribe((function(t){return t.result&&e.fileUploadHandlerMap.delete(t.fileUnique)})),this.dc.onerror=function(t){on.warn("[DataChannel] Error ",t)},this.dc.onclose=function(t){on.warn("[DataChannel] Close ",t)}},e.prototype.linkStart=function(){var t=this;this.pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(e){t.pc.setLocalDescription(e),t.isMobile?e.sdp=fi(e.sdp,t.maxBitrate):e.sdp=e.sdp.replace(/(a=fmtp:\d+ .*level-asymmetry-allowed=.*)\r\n/gm,"$1;x-google-start-bitrate=".concat(t.startBitrate,";x-google-max-bitrate=").concat(t.maxBitrate,";x-google-min-bitrate=").concat(t.minBitrate,"\r\n")),on.info("[Socket] [Send] offer",e),t.answerDelayTimer&&(window.clearTimeout(t.answerDelayTimer),t.answerDelayTimer=NaN),t.answerDelayTimer=window.setTimeout((function(){return t.reset()}),t.answerDelayHint),t.subject.next({action:"sdpOffer",data:e})}))},e.prototype.hangUp=function(){on.info("[Socket] [Received] the peer has been hung up"),this.ready=!1,this.mediaStream.getTracks().forEach((function(t){return t.stop()})),this.mediaStream=new MediaStream,this.candidateCache.length=0,this.dc.close(),this.pc.close(),this.afk.clear(),this.pc=new RTCPeerConnection({iceServers:this.iceServers,iceTransportPolicy:this.iceTransportPolicy}),this.setupPeerConnection(),this.dc=this.pc.createDataChannel("sendChannel"),this.dc.binaryType="arraybuffer",this.setupDataChannel()},e.prototype.controlAuthority=function(t){return r(this,void 0,void 0,(function(){return a(this,(function(e){return this.subject.next({action:"controlAuthority",data:{token:t}}),[2]}))}))},e.prototype.changeBandwidth=function(t,e,n){n&&e?this.subject.next({action:"setBitrate",data:{min_bitrate:n,max_bitrate:e,cur_bitrate:t}}):this.subject.next({action:"setBitrate",data:{min_bitrate:t,max_bitrate:t,cur_bitrate:t}})},e.prototype.exit=function(){on.info("[Socket] [Send] user sent exit command"),this.subject.closed||this.subject.next({action:"exit"})},e.prototype.emitUIInteraction=function(t,e){void 0===e&&(e=!1);var n=new Ci,i=this.tan.order(n);return this.send("string"==typeof t?new bn(t,i).dumps():new Dn(t,i).dumps(),e),n.promise},e.prototype.echo=function(){this.send(new Tn(~~performance.now()).dumps())},e.prototype.screenshot=function(t){var e=void 0===t?{}:t,n=e.index,i=void 0===n?0:n,o=e.left,r=void 0===o?0:o,a=e.top,s=void 0===a?0:a,c=e.width,u=void 0===c?1920:c,d=e.height,h=void 0===d?1080:d;this.send(new An(void 0,i,r,s,u,h).dumps())},e.prototype.sendClipboardData=function(t){return r(this,void 0,void 0,(function(){var e=this;return a(this,(function(n){return[2,new Kn(t).dumps().then((function(t){return t.forEach((function(t){return e.send(t)}))}))]}))}))},e.prototype.echoCodecOptions=function(){this.changeCodecOptions({framerate:0,bitrate:0,gopLength:0})},e.prototype.echoMobileResolutionInfo=function(){this.send(new Vn(0).dumps())},e.prototype.echoResolutionInfo=function(){this.send(new Qn([[0,0,0]]).dumps())},e.prototype.sendFile=function(t,e){var n=this,i=BigInt((new Date).getTime());this.send(new Jn(BigInt((new Date).getTime()),BigInt(t.lastModified),BigInt((new Date).getTime()),i,BigInt(t.size),t.name).dumps()),this.fileUploadHandlerMap.set(i,(function(o){o&&new $n(i,t).dumps().then((function(t){return t.forEach((function(t){return n.send(t)}))})),null==e||e(o)}))},e.prototype.replyFileTransferApply=function(t,e){this.send(new qn(t,e).dumps()),e||this.fileReceivedMap.delete(t)},e.prototype.notifyFileTransferFinish=function(t,e){this.send(new ti(t,e).dumps())},e.prototype.changeCodecOptions=function(t){var e=void 0===t?{}:t,n=e.framerate,i=void 0===n?60:n,o=e.bitrate,r=void 0===o?this.startBitrate:o,a=e.gopLength,s=void 0===a?250:a;this.send(new Fn(BigInt(0),0,i,r,s).dumps())},e.prototype.changeResolution=function(t){var e=void 0===t?{}:t,n=e.width,i=void 0===n?1920:n,o=e.height,r=void 0===o?1080:o;this.send(new jn(0,i,r).dumps())},e.prototype.changeEncodeResolution=function(t){var e=void 0===t?{}:t,n=e.width,i=void 0===n?1920:n,o=e.height,r=void 0===o?1080:o;this.send(new zn(i,r).dumps())},e.prototype.send=function(t,e){void 0===e&&(e=!1),"open"===this.dc.readyState?(this.enableAFK&&e&&this.afk.reset(),"string"==typeof t||t instanceof Blob||ArrayBuffer,this.dc.send(t)):on.warn("[DataChannel] send message before DataChannel open")},e.prototype.changeMobileResolutionScale=function(t){this.send(new Vn(t).dumps())},e.prototype.changeBandwidthByRenegotiation=function(t,e){var n=this;void 0===e&&(e=!1),this.pc.createOffer({iceRestart:e}).then((function(e){n.pc.setLocalDescription(e);var i={type:e.type,sdp:void 0===t?pi(e.sdp):fi(e.sdp,t)};n.subject.next({action:"sdpOffer",data:i})}))},e.prototype.upgradeAudio=function(t,e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){var n=this;return a(this,(function(i){return this.pc.addTrack(t.getAudioTracks()[0],t),[2,this.pc.createOffer({iceRestart:e}).then((function(t){n.pc.setLocalDescription(t),n.subject.next({action:"sdpOffer",data:t})}))]}))}))},e.prototype.reset=function(){this.answerDelayTimer&&window.clearTimeout(this.answerDelayTimer),this.subject.next({action:"reset"})},e.prototype.destory=function(){on.warn("[Connection] destory"),this.fileUploadHandlerMap.clear(),Object.entries(this.event).forEach((function(t){return c(t,2)[1].offAll()})),this.dc.close(),this.pc.close(),this.afk.clear(),this.subject.complete(),this.subject.unsubscribe()},e}(),ki=function(){this.root=document.createElement("div"),this.root.style.pointerEvents="auto",this.root.style.touchAction="none",this.shadowRoot=this.root.attachShadow({mode:"closed"})},Ri=function(t){function e(e,n){void 0===e&&(e=!0),void 0===n&&(n=function(){});var i=t.call(this)||this;return i.onPlayHandler=[],i.intervalID=NaN,i.resizePlayer=function(){},i.root.id="player",i.onPlayHandler.push(n),i.overlayElement=document.createElement("div"),i.overlayElement.style.cssText="\n      color: white;\n      font-size: 1.8em;\n      width: 100%;\n      height: 100%;\n      display: flex;\n      position: absolute;\n      background-color: rgba(51, 51, 51, 0.7);\n      justify-content: center;\n      align-items: center;\n    ",i.playerElement=document.createElement("div"),i.playerElement.style.cssText="\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      background-color: black;\n      transform-origin: top left;\n    ",i.videoElement=document.createElement("video"),i.videoElement.style.cssText="\n      width: 100%;\n      height: 100%;\n      outline: none;\n      position: absolute;\n      touch-action: none;\n      user-select: none;\n      -webkit-user-select: none;\n    ",i.videoElement.muted=!0,i.videoElement.playsInline=!0,i.videoElement.autoplay=!0,i.videoElement.addEventListener("loadedmetadata",(function(t){i.intervalID=window.setInterval((function(){i.isBlackScreen()||(i.hidePlayOverlay(),window.clearInterval(i.intervalID),i.onPlayHandler.forEach((function(t){return t()})))}),100),on.info("[Player] loadedmetadata:",t,i.videoElement.videoWidth,i.videoElement.videoHeight),i.videoElement.play().catch((function(){return i.showPlayOverlay()}))})),i.playerElement.appendChild(i.videoElement),i.playerElement.appendChild(i.overlayElement),i.shadowRoot.appendChild(i.playerElement),e&&document.body.addEventListener("pointerup",(function(){return i.muted(!1)}),{once:!0}),i}return i(e,t),Object.defineProperty(e.prototype,"videoAspectRatio",{get:function(){return this.videoElement.videoWidth/this.videoElement.videoHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostAspectRatio",{get:function(){return 16/9},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOrientationMatch",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionAndSize",{get:function(){return{top:0,left:0,width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.videoElement.clientWidth/this.videoElement.videoWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this.videoElement},enumerable:!1,configurable:!0}),e.prototype.registerOnPlay=function(t){this.onPlayHandler.push(t)},e.prototype.isBlackScreen=function(){var t,e=document.createElement("canvas"),n=e.getContext("2d");return e.width=this.videoElement.videoWidth/50,e.height=this.videoElement.videoHeight/50,n.drawImage(this.videoElement,0,0,e.width,e.height),!e.width||(null===(t=n.getImageData(0,0,e.width,e.height))||void 0===t?void 0:t.data).every((function(t){return 0===t||1===t||255===t}))},e.prototype.changeOrientationLock=function(t){},e.prototype.destory=function(){var t;on.warn("[Player] destory"),this.intervalID&&window.clearInterval(this.intervalID),this.playerElement.contains(this.videoElement)&&this.playerElement.removeChild(this.videoElement),this.playerElement.contains(this.overlayElement)&&this.playerElement.removeChild(this.overlayElement),null===(t=this.playerElement.parentNode)||void 0===t||t.removeChild(this.playerElement)},e.prototype.setVideoStram=function(t){this.videoElement.srcObject=t},e.prototype.muted=function(t){this.videoElement.muted=t},e.prototype.changeVolume=function(t){this.videoElement.volume=t},e.prototype.showTextOverlay=function(t){var e=document.createElement("div");e.innerHTML=t,this.setOverlay(e)},e.prototype.showPlayOverlay=function(){var t=this,e=document.createElement("img");e.id="play-button",e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPEAAAD5CAYAAAD2mNNkAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMjHxIGmVAAASgklEQVR4Xu2dC7BdVX2HqUCCIRASCPjAFIQREBRBBSRYbFOt8lIrFUWRFqXWsT5wbItUqFWs0KqIMPKoYEWpRS06KDjS1BeVFkVQbCw+wCfiAwGhCKWP9PuZtU24uTe59zz22Y/vm/nGkXtz7jlrr9+sdfZea/03Wb169QtxGW62iYi0D8L7NbwYj8EdcdPyIxFpA4T2P/F/8Ua8CI/GhPnXyq+ISJMhrAlxxX9hRuYL8Sh8SPk1EWkqBHXdEFfcg6vw3fhs3Kb8uog0DQI6XYgr8rOvYsJ8OM4v/0xEmkIJ6ob4P8zIfANegCvQMIs0BQK5sRBXJMy/wIzM5+ByXFBeRkQmBUGcbYjX5S5MmM/AA3CL8nIiUjcEcJAQV9yBX8a/wSeiz5hF6obgDRPikGfMCfOX8DTcu7y0iNQBoRs2xBX/g3diwvwm3Kn8CREZJ4RtVCGuqMKcu9kn4xJ09ZfIuCBgow5xyJ3sTLNzAywrwF6J26NhFhk1BGscIV6XhPluvA6Pxx3KnxaRUUCoxh3iioQ5z5n/BY/FJeUtiMgwEKa6QlyRMN+Hn8Hn4ZblrYjIIBCiukMc8p25Ws6ZMD+zvB0RmSsEaBIhnkrew5V4EHrCiMhcKAFqCv+Nl+J+uBC9my2yMQhKk0Jcke/M78Gsy06YH1TerohMhYA0McQVP8Nz8UDcCl2bLTIVgtHkEFd8D8/E/XFrdGQWqSAQbQhxyKOpm/B03Ac9MkgkEIa2hLgiN78S5lPx0bgIvQEm/YUAtC3EFQnzzfgnuDc6zZZ+Qsdva4jX5Sv4atwXHZmlX9DhuxDikC2Qn8dXYUbmReUjinQbOntXQlyRTRafwldgwrxV+agi3YRO3rUQV/wcV+LL8DHoyZzSTejcXQ1xRc7/uhyzl3kv3Lx8dJFuQKfueohDnjFnZP4o/j7m0ZQH4Es3oDP3IcQV2f6YMF+COZjgUeiZ2dJu6MR9CvG63ILvx4zMCfO80iQi7YLO29cQV3wb34spsr4rumBE2gWdtu8hDln99S1MXeYX4M6leUSaDx3WEK8lRdYT5lR/zPlfnswpzYeOaojXJ4cSfB3Pw+fgtug0W5oJndMQT0/uZGeaXZVyfTZuV5pNpDnQMQ3xxsk0O9Ufz8ZDcdvSfCKThw5piGdP2ioF496JT0c3WcjkKR1T5kYWjCTM78DfQheMyOSgAxriwch35lR/vAbPwOXozS+pHzqeIR6Oal12wvx2fBy6yULqgw5niEdDwpyR+VpMkfXsmHIpp4wfOpohHj234RfwFNwDnWbL+KCDGeLxkJH5p3g1vg53K00uMlroXIZ4vGTBSMJ8FeZkzmWl6UVGA53KENfD/ZiyNCmynvO/FpdLIDIcdCZDXC8ZmfOd+d/wJejZXzIcdCJDXD95xpwjdnP+V74zH4Wu/pLBoPMY4smSMN+FKbJ+BBpmmRt0GkPcDBLmu/FjeAi6lFNmB53FEDeHTLPzaCoj80dwBfqMWTYMncQQN5esAPsw7lcul8j60EEMcfPJDbD3YU7l3KxcOpE10CkMcTvIVDvfmc/E3XELtPqjGOKWkhVgp+GemDD7vbnP0AEMcXtJkfU34GNxAToy9xEuvCFuP6vwJMyOqYXl0kpf4KIb4m5QncyZTRapZGGY+wIX2xB3i3vxOswmi13QaXbX4QIb4m6SY3a/iMdh7mYb5q7ChTXE3aXaaLESq7rMW5ZLL12Bi2qI+8E9eDkmzLuhYe4KXExD3B8yMt+Ol+KL0CLrXYCLaIj7R8J8K16CR6PLOdsMF88Q95fsmPoRXozPxdzNdvVX2+CiGWLJza+EOXWZj8Sd0APw2wIXyxBLqPYy34LnY8K8DA1z0+EiGWKZSgJ9I74LU2R9R3Sa3VS4OIZYZqJaynkWpsj6w0u3kSbBhTHEsjHuwxswpVwPw6Wl+0gT4IIYYpkNmWKnr1yPqf54KG5VupFMknJhRGZLwpzVX6n++DZ8GrpjapJwAQyxDELCnB1TqWTx1/gUdGSeBDS8IZZBSZBjzv76PP4VHoSGuU5ocEMsoyBhTsG4VH98Ix6A80s3k3FCQxtiGSVZMPIT/CwmzPuhz5jHCQ1siGUcZClnwvxpPAX3LF1ORg2Na4hlXGSKnQUjCfNn8PX4CNy0dD8ZBTSoIZZxkzBXI/Pn8ATMumzDPApoSEMsdZEw5zvzDzHT7JdjwuzZX8NAAxpimQSZZifMn8Tj8aGlS8pcofEMsUyKjMw5lTOnjHwcc2TQktI1ZbbQaIZYJk3CnE0WGZmvwOeh+5hnC41liKUpVCNzwvwJPBy9+bUxaCRDLE0jYb4fU/0x0+yD8cGly8pUaBxDLE0kQa7CfCfmML8D0SN2p0KjGGJpOglztWgkh/k9CT1it4LGMMTSFhLmLBrJ3exzcJ/SjfsNDWGIpY0k0D/AM/GRpTv3ExrAEEubqVaAnY5LsX93s/nQhli6QLUF8nWYI3bnYT+Wc/JBDbF0heqO9jfwlfhInI/dDjMf0BBLF0mYr8NsskiNqS2wm2Hmgxli6TJ5zpwjg/4Qd8buLRrhQxli6QM5ZjdHBh2H+c7cnUUjfBhDLH0hU+y7cCU+H7OXeV6JQnvhQxhi6RsJc0bmy/BZ+MsbYCUS7YM3b4ilryTM2QL5QUzBuHxnbt80mzdtiEVWr74NL8KUck2R9faMzLxZQyyyhozMWcp5If4uJszNP5yAN2mIRR5IVn/djOfhEdjsw/x4c4ZYZHryjPkmPBsPwYeV2DQL3pghFpmZTLFzZFDCnLrMz8DtsTkbLXgzhlhk4yTM2cu8CrNjKiNzwjz5OlO8CUMsMjcS5qzLfgumyPr2JU6TgTdgiEUGoyqynrrMv42TOTObP2yIRQYn0+ws5bwaU8r1N3HrEq964A8aYpHhSZjvwBSMS5gPwnrWZfOHDLHI6Mgz5hyxm4Jxf4kH4HjDzB8wxCKjJ2HONPuf8c9xHxzPXmZe2BCLjIdMsWMqWfwTnoiPwdGOzLygIRYZPwlzVWPqtbgXjmbBCC9kiEXqI8+Ys8nicnwN7laiODi8iCEWqZeMylmXnTCnYFxO5tyxRHLu8I8NschkSJizLvv7mJH5pbgY57Zjin9giEUmSzUyfw9TZP1Y3LZEdOPwy4ZYpBkkzKn++B38KB6F25Wozgy/ZIhFmkXCnLO/vosfwpwysqhEdn34oSEWaSYJ8y8w0+wP4GG4/oIR/qMhFmk2VZgzzU6Ys2Nq7T5m/o8hFmkHCXO2PybMF+O++CBDLNIuEuSsy8535lvxZEMs0j6qWszZJbXUEIu0i1vwrZhqFZv5nVikPWTqfA5mF9QDD+fjPxhikeaR777xdrwAn1Aiuz780BCLNIvsdMqBAqkNtRw3XBeKXzDEIpMno27Cezdeik/GBSWmG4ZfNMQikyPhzXrpVGXM6R8rcG7lVfkHhlikfhLe7FzKo6KV+Hu45m7zXOEfGmKReske4oT3k3gMblniOBi8gCEWqYeMvD/GK/F43KHEcDh4IUMsMl5yw+pHmLOoX4aDH8UzHbygIRYZD/nem5H3KjwBd8LRV1HkRQ2xyGjJ3eacNZ1iayfhr+P46hnz4oZYZDRk2pzwph7TX+CuOP76xfwRQywyHNlVVIX3VHx8iVc98AcNscjgZJFGypq+GffHwZ71DgN/1BCLzJ2f47/iWzBlTId71jsM/HFDLDI7crf5HrwG34YHY70FxaeDN2GIRTZMwpvjcK7Fd+BTcfLhreDNGGKRmcnIez2+Ew/FhTi3MivjhjdkiEXWJ0fEfhXPwmfi4hKZ5sGbM8Qia8n65lX4LkzlhYeVqDQX3qQhFlnzrPc/8FzMtsBl2Kxp80zwRg2x9J0cxn4epoBZlkjW/6x3GHjDhlj6SJZI5gTJ9+DzMeHdvMSiXfDGDbH0iWpbYMqgJLy7YLtG3qnwAQyx9IVsC7wEX4C74/h2FtUJH8QQS9fJUTg5QfI43APnle7fDfhAhli6So5//Ri+GBPeya1vHid8MEMsXSMH0X0CX4J74cLS3bsJH9AQS1fITavs6f1VeLEdz3qHgQ9piKXtZHNC1jfnELpfTpux++Gt4MMaYmkrmTZ/GV+LCW+3p80zwQc3xNI2skTyBswhdHtic7YFTgIawBBLm7gRT8HH4dbYn2nzTNAIhljaQCrkvwkT3tywGv8pkm2BxjDE0lRyokbOsjoDUyE/N6wM71RoFEMsTSPhvRPfjY/GBei0eSZoHEMsTeJ2/ADug+3cVVQ3NJQhliaQkfcf8SnoqDsXaDBDLJMij4ruxcvwaejIOwg0nCGWusnyyIT3CjwM+7lIY1TQgIZY6iA3qzLyZmdRSn0eic09QbJN0JCGWMZJwpuR9w78Er4Qu7klcFLQoIZYxkXq9OZuc2oWZXNCv5dHjgsa1hDLqKnCm2qB2Zzw0NLdZBzQwIZYRkWmzT/DhPdE3KV0MxknNLQhlmHJ996ENwXHsjkhq6xcHlkXNLYhlkFJeHPDKhvyszkh4W338a9thEY3xDJX8qgoGxMS3tTpfSzOL11K6obGN8QyWxLeLI/MtDmlPvdHp82ThotgiGU2ZOStwrsCXSLZFLgYhlg2xF2Yc6zOxqejCzWaBhfFEMt0pMj2VzB1eg/BJaXLSNPg4hhiqcjd5izUSIX8lPp8Fi4tXUWaChfJEEtIhfwU2b4QU2R7O3RfbxvgQhnifpOD17+JCW9KfS5F7zi3CS6YIe4nOXj9W/h3eAw+vHQJaRtcPEPcL/Ks92a8CI/FXdFpc5vhAhri/vB9/Hv8A3wUukSyC3AhDXH3+Sn+Ax6PqZDvEskuwQU1xN2kOgonJ0im1Gc2J2xRLrt0CS6sIe4W1c6ij2NG3lROmFcut3QRLrAh7g4J75X4R7g3Gt4+wIU2xO0n0+ZP4aswBcdc39wnuOCGuL3kWe/n8DW4Ly4ql1X6BBfeELeTL+AJ+ATcBn3W21e4+Ia4PeSO89fwT/GJuAhdItl36ASGuPlkZ9G38fWYo3Ay8hpeWQOdwRA3lxwBexO+GVPq07Insj50DEPcTLK++e2Yc6wWo995ZXroHIa4WdyKOQpnOWbavGm5VCLTQycxxM0gp0iej0/G3LAyvDI76CyGeHJUx+G8Hw9Ewytzh05jiCdDDqK7HA/Aheh3XhkMOo8hrpe096fxd9D9vDI8pVPJ+LkXP4vPQafMMjroUIZ4fOQ7b9Y3X4U5x8oi2zJ66FiGePRkeWROkfwiHoee3Szjgw5miEdDRt14D+bw9ZfjDqWZRcYHHc0QD091FE6OgP0z9OB1qQ86myEenKxtTngz8r4BHXmlfuh4hnjuJLwp9Zlqgafh7qU5ReqHDmiIZ0+mzVkeeQO+FR9fmlFkctARDfHsSJ3ef8dqZ5GH0EkzoDMa4pnJ3ea0T07TOAezvnlBaTqRZlA6qTyQhDdrm1fhBXgwGl5pJnROQ7yW6jlvwvtefAZuXppKpJmUTitrp80p9Zn1zQ8uTSTSbOisfQ9xps2pkJ/wPhe3K00j0g7otH0N8f34dXwfHo0W2ZZ2QuftY4izPDKnabwIH4Ee/yrthQ7clxBnldUP8BJ8MSa87uuV9kNH7nqIc4ZVwvshfCkuQ8Mr3YEO3dUQZ4nkD/HDmFKfe5SPLNIt6NxdDHHC+xF8BabsiSOvdBc6eJdCfBtehglvimz7rFe6Dx29CyHOQo0r8NWYOr0W2Zb+QIdva4izRDLPeldi6vSm1OfC8rFE+gMdv40hznu+GlMhfz/cEj0OR/oJnb9NIc57vQZPxCehI69ICUbTydnN1+LJmPAuKW9fRAhEk0OcZ73XYw6hOwg9v1lkKgSjqSHO5oRT8TdwKbq+WWQ6CEeTQpw7zlmocTqmTm/Ob7bomMiGICRNCHGmzT/BszClPjPyuspKZDYQlkmH+Mf4t7gct0enzSJzgdBMKsQJ70X4VHTkFRkUwlN3iFM54YN4KG6LHkQnMgyEqK4Q51nvpZjwZuQ1vCKjgDDVEeIr8XBMeL3bLDJKCNW4QpyR9zo8ArdBb1iJjAPCNeoQJ7ypFngszkc3JoiME0I2qhDnWW8Kjv0xujFBpC4I3DAhzgqrHESXUp/Z0/uQ8rIiUhcEb5AQJ7z34TfwJNy5vJyI1A0BnG2IE9yYsiffwTfizuh3XpFJQghnE+J83014v4upkL8r+qhIpAkQxg2FOOHNzzNtPhf3REdekSZRQjqVTJtzguSNeD4eWH5dRJoGAZ0a4rvxm3ghrkCnzSJNhpBWIc7/plpgwpudRZ7dLNIGCOvtJbwX42G4uPxIRNoAoU2d3iNxUflPItIaNtnk/wEGBoMdpECGHAAAAABJRU5ErkJggg==",e.alt="Start Streaming",this.setOverlay(e,(function(){t.hidePlayOverlay()}))},e.prototype.hidePlayOverlay=function(){this.clearOverlay(),this.overlayElement.style.display="none"},e.prototype.clearOverlay=function(){for(;this.overlayElement.lastChild;)this.overlayElement.removeChild(this.overlayElement.lastChild)},e.prototype.setOverlay=function(t,e){if(this.clearOverlay(),this.overlayElement.appendChild(t),this.overlayElement.style.display="flex",e){var n=this;this.overlayElement.addEventListener("click",(function t(i){e(i),n.overlayElement.removeEventListener("click",t)}))}},e}(ki),_i=function(){function t(e,n){var i=this;this.hostElement=e,this.frontierMap={graphics:{left:0,top:0,width:0,height:0},container:{left:0,top:0,width:0,height:0}},this.panelMap=new Map([]),this._hostAspectRatio=16/9,this._videoAspectRatio=16/9,this.options=o(o({},t.defaultOptions),n),this._orientationLock=this.options.orientationLock;var r=document.createElement("div");this.shadowRoot=r.attachShadow({mode:"closed"}),e.appendChild(r),this.shellElement=document.createElement("div"),this.shellElement.id="player-shell",this.shellElement.style.cssText="\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      transform-origin: top left;\n    ",this.shadowRoot.appendChild(this.shellElement);this.resizeObserverIns=new ResizeObserver((function(){return i.hostAspectRatio=i.hostElement.clientWidth/i.hostElement.clientHeight})),this.resizeObserverIns.observe(this.hostElement)}return t.createPanel=function(t){var e=document.createElement("div");return e.style.cssText="\n      width: ".concat(t.width,"px;\n      height: ").concat(t.height,"px;\n      left: ").concat(t.left,"px;\n      top: ").concat(t.top,"px;\n      position: absolute;\n      pointer-events: none;\n    "),e},Object.defineProperty(t.prototype,"hostAspectRatio",{get:function(){return this._hostAspectRatio},set:function(t){this._hostAspectRatio=t,on.info("[PlayerShell] host aspect ratio change",t),this.resize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoAspectRatio",{get:function(){return this._videoAspectRatio},set:function(t){this._videoAspectRatio=t,on.info("[PlayerShell] video aspect ratio change",t),this.resize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"orientationLock",{get:function(){return this._orientationLock},set:function(t){this._orientationLock=t,on.info("[PlayerShell] orientation lock change",t),this.resize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shell",{get:function(){return this.shellElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOrientationMatch",{get:function(){return this.videoAspectRatio>1==this.hostAspectRatio>1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"containerDimensions",{get:function(){return this.frontierMap.container},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphicsDimensions",{get:function(){return this.frontierMap.graphics},enumerable:!1,configurable:!0}),t.prototype.resize=function(){var t=this,e=this.hostElement.clientWidth,n=this.hostElement.clientHeight;this.isOrientationMatch||this.orientationLock?(this.shellElement.style.transform="rotate(0)",this.shellElement.style.left="0px",this.shellElement.style.width="".concat(e,"px"),this.shellElement.style.height="".concat(n,"px")):(this.shellElement.style.transform="rotate(90deg)",this.shellElement.style.left="".concat(e,"px"),this.shellElement.style.width="".concat(n,"px"),this.shellElement.style.height="".concat(e,"px"));var i,o,r,a,s=this.shellElement.clientWidth,c=this.shellElement.clientHeight;this.frontierMap.container={width:s,height:c,top:0,left:0},this.videoAspectRatio<s/c?(i=c,o=Math.floor(i*this.videoAspectRatio),a=Math.floor(.5*(s-o)),r=0):(o=s,i=Math.floor(o/this.videoAspectRatio),r=Math.floor(.5*(c-i)),a=0),this.frontierMap.graphics={width:o,height:i,left:a,top:r},this.panelMap.forEach((function(e){var n=e.panel,i=e.type,o=t.frontierMap[i],r=o.width,a=o.height,s=o.top,c=o.left;n.style.top="".concat(s,"px"),n.style.left="".concat(c,"px"),n.style.width="".concat(r,"px"),n.style.height="".concat(a,"px")})),this.options.onRotate(!!this.orientationLock||this.isOrientationMatch)},t.prototype.addWidget=function(e,n){void 0===n&&(n="graphics");var i,o,r,a=(o=(new Date).getTime(),r="undefined"!=typeof performance&&1e3*(null===(i=performance.now)||void 0===i?void 0:i.call(performance))||0,"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random();return o>0?(e=(o+e)%16|0,o=Math.floor(o/16)):(e=(r+e)%16|0,r=Math.floor(r/16)),("x"===t?e:3&e|8).toString(16)}))),s=t.createPanel(this.frontierMap[n]);return s.appendChild(e.root),s.id=a,this.shellElement.appendChild(s),this.panelMap.set(a,{panel:s,type:n}),a},t.prototype.stickToTop=function(t){var e=this.panelMap.get(t);e?(this.panelMap.forEach((function(t){return t.panel.style.zIndex=""})),e.panel.style.zIndex="1"):on.error("[PlayerShell] stick panel id ".concat(t," not exist"))},t.prototype.destory=function(){this.resizeObserverIns.disconnect(),this.shadowRoot.innerHTML=""},t.defaultOptions={orientationLock:!0,onRotate:function(){}},t}(),Li=function(){function t(){}return t.KEYCODE_UNKNOWN=0,t.KEYCODE_SOFT_LEFT=1,t.KEYCODE_SOFT_RIGHT=2,t.KEYCODE_HOME=3,t.KEYCODE_BACK=4,t.KEYCODE_CALL=5,t.KEYCODE_ENDCALL=6,t.KEYCODE_0=7,t.KEYCODE_1=8,t.KEYCODE_2=9,t.KEYCODE_3=10,t.KEYCODE_4=11,t.KEYCODE_5=12,t.KEYCODE_6=13,t.KEYCODE_7=14,t.KEYCODE_8=15,t.KEYCODE_9=16,t.KEYCODE_STAR=17,t.KEYCODE_POUND=18,t.KEYCODE_DPAD_UP=19,t.KEYCODE_DPAD_DOWN=20,t.KEYCODE_DPAD_LEFT=21,t.KEYCODE_DPAD_RIGHT=22,t.KEYCODE_DPAD_CENTER=23,t.KEYCODE_VOLUME_UP=24,t.KEYCODE_VOLUME_DOWN=25,t.KEYCODE_POWER=26,t.KEYCODE_CAMERA=27,t.KEYCODE_CLEAR=28,t.KEYCODE_A=29,t.KEYCODE_B=30,t.KEYCODE_C=31,t.KEYCODE_D=32,t.KEYCODE_E=33,t.KEYCODE_F=34,t.KEYCODE_G=35,t.KEYCODE_H=36,t.KEYCODE_I=37,t.KEYCODE_J=38,t.KEYCODE_K=39,t.KEYCODE_L=40,t.KEYCODE_M=41,t.KEYCODE_N=42,t.KEYCODE_O=43,t.KEYCODE_P=44,t.KEYCODE_Q=45,t.KEYCODE_R=46,t.KEYCODE_S=47,t.KEYCODE_T=48,t.KEYCODE_U=49,t.KEYCODE_V=50,t.KEYCODE_W=51,t.KEYCODE_X=52,t.KEYCODE_Y=53,t.KEYCODE_Z=54,t.KEYCODE_COMMA=55,t.KEYCODE_PERIOD=56,t.KEYCODE_ALT_LEFT=57,t.KEYCODE_ALT_RIGHT=58,t.KEYCODE_SHIFT_LEFT=59,t.KEYCODE_SHIFT_RIGHT=60,t.KEYCODE_TAB=61,t.KEYCODE_SPACE=62,t.KEYCODE_SYM=63,t.KEYCODE_EXPLORER=64,t.KEYCODE_ENVELOPE=65,t.KEYCODE_ENTER=66,t.KEYCODE_DEL=67,t.KEYCODE_GRAVE=68,t.KEYCODE_MINUS=69,t.KEYCODE_EQUALS=70,t.KEYCODE_LEFT_BRACKET=71,t.KEYCODE_RIGHT_BRACKET=72,t.KEYCODE_BACKSLASH=73,t.KEYCODE_SEMICOLON=74,t.KEYCODE_APOSTROPHE=75,t.KEYCODE_SLASH=76,t.KEYCODE_AT=77,t.KEYCODE_NUM=78,t.KEYCODE_HEADSETHOOK=79,t.KEYCODE_FOCUS=80,t.KEYCODE_PLUS=81,t.KEYCODE_MENU=82,t.KEYCODE_NOTIFICATION=83,t.KEYCODE_SEARCH=84,t.KEYCODE_MEDIA_PLAY_PAUSE=85,t.KEYCODE_MEDIA_STOP=86,t.KEYCODE_MEDIA_NEXT=87,t.KEYCODE_MEDIA_PREVIOUS=88,t.KEYCODE_MEDIA_REWIND=89,t.KEYCODE_MEDIA_FAST_FORWARD=90,t.KEYCODE_MUTE=91,t.KEYCODE_PAGE_UP=92,t.KEYCODE_PAGE_DOWN=93,t.KEYCODE_PICTSYMBOLS=94,t.KEYCODE_SWITCH_CHARSET=95,t.KEYCODE_BUTTON_A=96,t.KEYCODE_BUTTON_B=97,t.KEYCODE_BUTTON_C=98,t.KEYCODE_BUTTON_X=99,t.KEYCODE_BUTTON_Y=100,t.KEYCODE_BUTTON_Z=101,t.KEYCODE_BUTTON_L1=102,t.KEYCODE_BUTTON_R1=103,t.KEYCODE_BUTTON_L2=104,t.KEYCODE_BUTTON_R2=105,t.KEYCODE_BUTTON_THUMBL=106,t.KEYCODE_BUTTON_THUMBR=107,t.KEYCODE_BUTTON_START=108,t.KEYCODE_BUTTON_SELECT=109,t.KEYCODE_BUTTON_MODE=110,t.KEYCODE_ESCAPE=111,t.KEYCODE_FORWARD_DEL=112,t.KEYCODE_CTRL_LEFT=113,t.KEYCODE_CTRL_RIGHT=114,t.KEYCODE_CAPS_LOCK=115,t.KEYCODE_SCROLL_LOCK=116,t.KEYCODE_META_LEFT=117,t.KEYCODE_META_RIGHT=118,t.KEYCODE_FUNCTION=119,t.KEYCODE_SYSRQ=120,t.KEYCODE_BREAK=121,t.KEYCODE_MOVE_HOME=122,t.KEYCODE_MOVE_END=123,t.KEYCODE_INSERT=124,t.KEYCODE_FORWARD=125,t.KEYCODE_MEDIA_PLAY=126,t.KEYCODE_MEDIA_PAUSE=127,t.KEYCODE_MEDIA_CLOSE=128,t.KEYCODE_MEDIA_EJECT=129,t.KEYCODE_MEDIA_RECORD=130,t.KEYCODE_F1=131,t.KEYCODE_F2=132,t.KEYCODE_F3=133,t.KEYCODE_F4=134,t.KEYCODE_F5=135,t.KEYCODE_F6=136,t.KEYCODE_F7=137,t.KEYCODE_F8=138,t.KEYCODE_F9=139,t.KEYCODE_F10=140,t.KEYCODE_F11=141,t.KEYCODE_F12=142,t.KEYCODE_NUM_LOCK=143,t.KEYCODE_NUMPAD_0=144,t.KEYCODE_NUMPAD_1=145,t.KEYCODE_NUMPAD_2=146,t.KEYCODE_NUMPAD_3=147,t.KEYCODE_NUMPAD_4=148,t.KEYCODE_NUMPAD_5=149,t.KEYCODE_NUMPAD_6=150,t.KEYCODE_NUMPAD_7=151,t.KEYCODE_NUMPAD_8=152,t.KEYCODE_NUMPAD_9=153,t.KEYCODE_NUMPAD_DIVIDE=154,t.KEYCODE_NUMPAD_MULTIPLY=155,t.KEYCODE_NUMPAD_SUBTRACT=156,t.KEYCODE_NUMPAD_ADD=157,t.KEYCODE_NUMPAD_DOT=158,t.KEYCODE_NUMPAD_COMMA=159,t.KEYCODE_NUMPAD_ENTER=160,t.KEYCODE_NUMPAD_EQUALS=161,t.KEYCODE_NUMPAD_LEFT_PAREN=162,t.KEYCODE_NUMPAD_RIGHT_PAREN=163,t.KEYCODE_VOLUME_MUTE=164,t.KEYCODE_INFO=165,t.KEYCODE_CHANNEL_UP=166,t.KEYCODE_CHANNEL_DOWN=167,t.KEYCODE_ZOOM_IN=168,t.KEYCODE_ZOOM_OUT=169,t.KEYCODE_TV=170,t.KEYCODE_WINDOW=171,t.KEYCODE_GUIDE=172,t.KEYCODE_DVR=173,t.KEYCODE_BOOKMARK=174,t.KEYCODE_CAPTIONS=175,t.KEYCODE_SETTINGS=176,t.KEYCODE_TV_POWER=177,t.KEYCODE_TV_INPUT=178,t.KEYCODE_STB_POWER=179,t.KEYCODE_STB_INPUT=180,t.KEYCODE_AVR_POWER=181,t.KEYCODE_AVR_INPUT=182,t.KEYCODE_PROG_RED=183,t.KEYCODE_PROG_GREEN=184,t.KEYCODE_PROG_YELLOW=185,t.KEYCODE_PROG_BLUE=186,t.KEYCODE_APP_SWITCH=187,t.KEYCODE_BUTTON_1=188,t.KEYCODE_BUTTON_2=189,t.KEYCODE_BUTTON_3=190,t.KEYCODE_BUTTON_4=191,t.KEYCODE_BUTTON_5=192,t.KEYCODE_BUTTON_6=193,t.KEYCODE_BUTTON_7=194,t.KEYCODE_BUTTON_8=195,t.KEYCODE_BUTTON_9=196,t.KEYCODE_BUTTON_10=197,t.KEYCODE_BUTTON_11=198,t.KEYCODE_BUTTON_12=199,t.KEYCODE_BUTTON_13=200,t.KEYCODE_BUTTON_14=201,t.KEYCODE_BUTTON_15=202,t.KEYCODE_BUTTON_16=203,t.KEYCODE_LANGUAGE_SWITCH=204,t.KEYCODE_MANNER_MODE=205,t.KEYCODE_3D_MODE=206,t.KEYCODE_CONTACTS=207,t.KEYCODE_CALENDAR=208,t.KEYCODE_MUSIC=209,t.KEYCODE_CALCULATOR=210,t.KEYCODE_ZENKAKU_HANKAKU=211,t.KEYCODE_EISU=212,t.KEYCODE_MUHENKAN=213,t.KEYCODE_HENKAN=214,t.KEYCODE_KATAKANA_HIRAGANA=215,t.KEYCODE_YEN=216,t.KEYCODE_RO=217,t.KEYCODE_KANA=218,t.KEYCODE_ASSIST=219,t.KEYCODE_BRIGHTNESS_DOWN=220,t.KEYCODE_BRIGHTNESS_UP=221,t.KEYCODE_MEDIA_AUDIO_TRACK=222,t.KEYCODE_SLEEP=223,t.KEYCODE_WAKEUP=224,t.KEYCODE_PAIRING=225,t.KEYCODE_MEDIA_TOP_MENU=226,t.KEYCODE_11=227,t.KEYCODE_12=228,t.KEYCODE_LAST_CHANNEL=229,t.KEYCODE_TV_DATA_SERVICE=230,t.KEYCODE_VOICE_ASSIST=231,t.KEYCODE_TV_RADIO_SERVICE=232,t.KEYCODE_TV_TELETEXT=233,t.KEYCODE_TV_NUMBER_ENTRY=234,t.KEYCODE_TV_TERRESTRIAL_ANALOG=235,t.KEYCODE_TV_TERRESTRIAL_DIGITAL=236,t.KEYCODE_TV_SATELLITE=237,t.KEYCODE_TV_SATELLITE_BS=238,t.KEYCODE_TV_SATELLITE_CS=239,t.KEYCODE_TV_SATELLITE_SERVICE=240,t.KEYCODE_TV_NETWORK=241,t.KEYCODE_TV_ANTENNA_CABLE=242,t.KEYCODE_TV_INPUT_HDMI_1=243,t.KEYCODE_TV_INPUT_HDMI_2=244,t.KEYCODE_TV_INPUT_HDMI_3=245,t.KEYCODE_TV_INPUT_HDMI_4=246,t.KEYCODE_TV_INPUT_COMPOSITE_1=247,t.KEYCODE_TV_INPUT_COMPOSITE_2=248,t.KEYCODE_TV_INPUT_COMPONENT_1=249,t.KEYCODE_TV_INPUT_COMPONENT_2=250,t.KEYCODE_TV_INPUT_VGA_1=251,t.KEYCODE_TV_AUDIO_DESCRIPTION=252,t.KEYCODE_TV_AUDIO_DESCRIPTION_MIX_UP=253,t.KEYCODE_TV_AUDIO_DESCRIPTION_MIX_DOWN=254,t.KEYCODE_TV_ZOOM_MODE=255,t.KEYCODE_TV_CONTENTS_MENU=256,t.KEYCODE_TV_MEDIA_CONTEXT_MENU=257,t.KEYCODE_TV_TIMER_PROGRAMMING=258,t.KEYCODE_HELP=259,t.KEYCODE_NAVIGATE_PREVIOUS=260,t.KEYCODE_NAVIGATE_NEXT=261,t.KEYCODE_NAVIGATE_IN=262,t.KEYCODE_NAVIGATE_OUT=263,t.KEYCODE_STEM_PRIMARY=264,t.KEYCODE_STEM_1=265,t.KEYCODE_STEM_2=266,t.KEYCODE_STEM_3=267,t.KEYCODE_DPAD_UP_LEFT=268,t.KEYCODE_DPAD_DOWN_LEFT=269,t.KEYCODE_DPAD_UP_RIGHT=270,t.KEYCODE_DPAD_DOWN_RIGHT=271,t.KEYCODE_MEDIA_SKIP_FORWARD=272,t.KEYCODE_MEDIA_SKIP_BACKWARD=273,t.KEYCODE_MEDIA_STEP_FORWARD=274,t.KEYCODE_MEDIA_STEP_BACKWARD=275,t.KEYCODE_SOFT_SLEEP=276,t.KEYCODE_CUT=277,t.KEYCODE_COPY=278,t.KEYCODE_PASTE=279,t.KEYCODE_SYSTEM_NAVIGATION_UP=280,t.KEYCODE_SYSTEM_NAVIGATION_DOWN=281,t.KEYCODE_SYSTEM_NAVIGATION_LEFT=282,t.KEYCODE_SYSTEM_NAVIGATION_RIGHT=283,t.KEYCODE_ALL_APPS=284,t.KEYCODE_REFRESH=285,t}(),Ai=new Map([["Escape",Li.KEYCODE_ESCAPE],["F1",Li.KEYCODE_F1],["F2",Li.KEYCODE_F2],["F3",Li.KEYCODE_F3],["F4",Li.KEYCODE_F4],["F5",Li.KEYCODE_F5],["F6",Li.KEYCODE_F6],["F7",Li.KEYCODE_F7],["F8",Li.KEYCODE_F8],["F9",Li.KEYCODE_F9],["F10",Li.KEYCODE_F10],["F11",Li.KEYCODE_F11],["F12",Li.KEYCODE_F12],["Backquote",Li.KEYCODE_GRAVE],["Digit1",Li.KEYCODE_1],["Digit2",Li.KEYCODE_2],["Digit3",Li.KEYCODE_3],["Digit4",Li.KEYCODE_4],["Digit5",Li.KEYCODE_5],["Digit6",Li.KEYCODE_6],["Digit7",Li.KEYCODE_7],["Digit8",Li.KEYCODE_8],["Digit9",Li.KEYCODE_9],["Digit0",Li.KEYCODE_0],["Minus",Li.KEYCODE_MINUS],["Equal",Li.KEYCODE_EQUALS],["Backspace",Li.KEYCODE_DEL],["Tab",Li.KEYCODE_TAB],["KeyQ",Li.KEYCODE_Q],["KeyW",Li.KEYCODE_W],["KeyE",Li.KEYCODE_E],["KeyR",Li.KEYCODE_R],["KeyT",Li.KEYCODE_T],["KeyY",Li.KEYCODE_Y],["KeyU",Li.KEYCODE_U],["KeyI",Li.KEYCODE_I],["KeyO",Li.KEYCODE_O],["KeyP",Li.KEYCODE_P],["BracketLeft",Li.KEYCODE_LEFT_BRACKET],["BracketRight",Li.KEYCODE_RIGHT_BRACKET],["Backslash",Li.KEYCODE_BACKSLASH],["CapsLock",Li.KEYCODE_CAPS_LOCK],["KeyA",Li.KEYCODE_A],["KeyS",Li.KEYCODE_S],["KeyD",Li.KEYCODE_D],["KeyF",Li.KEYCODE_F],["KeyG",Li.KEYCODE_G],["KeyH",Li.KEYCODE_H],["KeyJ",Li.KEYCODE_J],["KeyK",Li.KEYCODE_K],["KeyL",Li.KEYCODE_L],["Semicolon",Li.KEYCODE_SEMICOLON],["Quote",Li.KEYCODE_APOSTROPHE],["Enter",Li.KEYCODE_ENTER],["ShiftLeft",Li.KEYCODE_SHIFT_LEFT],["KeyZ",Li.KEYCODE_Z],["KeyX",Li.KEYCODE_X],["KeyC",Li.KEYCODE_C],["KeyV",Li.KEYCODE_V],["KeyB",Li.KEYCODE_B],["KeyN",Li.KEYCODE_N],["KeyM",Li.KEYCODE_M],["Comma",Li.KEYCODE_COMMA],["Period",Li.KEYCODE_PERIOD],["Slash",Li.KEYCODE_SLASH],["ShiftRight",Li.KEYCODE_SHIFT_RIGHT],["ControlLeft",Li.KEYCODE_CTRL_LEFT],["OSLeft",Li.KEYCODE_META_LEFT],["MetaLeft",Li.KEYCODE_META_LEFT],["AltLeft",Li.KEYCODE_ALT_LEFT],["Space",Li.KEYCODE_SPACE],["AltRight",Li.KEYCODE_ALT_RIGHT],["OSRight",Li.KEYCODE_META_RIGHT],["MetaRight",Li.KEYCODE_META_RIGHT],["ContextMenu",Li.KEYCODE_MENU],["ControlRight",Li.KEYCODE_CTRL_RIGHT],["Insert",Li.KEYCODE_INSERT],["Home",Li.KEYCODE_HOME],["PageUp",Li.KEYCODE_PAGE_UP],["Delete",Li.KEYCODE_FORWARD_DEL],["End",Li.KEYCODE_ENDCALL],["PageDown",Li.KEYCODE_PAGE_DOWN],["ArrowUp",Li.KEYCODE_DPAD_UP],["ArrowLeft",Li.KEYCODE_DPAD_LEFT],["ArrowRight",Li.KEYCODE_DPAD_RIGHT],["ArrowDown",Li.KEYCODE_DPAD_DOWN],["PrintScreen",Li.KEYCODE_SYSRQ],["ScrollLock",Li.KEYCODE_SCROLL_LOCK],["Pause",Li.KEYCODE_BREAK],["NumLock",Li.KEYCODE_NUM_LOCK],["NumpadDivide",Li.KEYCODE_NUMPAD_DIVIDE],["NumpadMultiply",Li.KEYCODE_NUMPAD_MULTIPLY],["NumpadSubtract",Li.KEYCODE_NUMPAD_SUBTRACT],["Numpad0",Li.KEYCODE_NUMPAD_0],["Numpad1",Li.KEYCODE_NUMPAD_1],["Numpad2",Li.KEYCODE_NUMPAD_2],["Numpad3",Li.KEYCODE_NUMPAD_3],["Numpad4",Li.KEYCODE_NUMPAD_4],["Numpad5",Li.KEYCODE_NUMPAD_5],["Numpad6",Li.KEYCODE_NUMPAD_6],["Numpad7",Li.KEYCODE_NUMPAD_7],["Numpad8",Li.KEYCODE_NUMPAD_8],["Numpad9",Li.KEYCODE_NUMPAD_9],["NumpadAdd",Li.KEYCODE_NUMPAD_ADD],["NumpadEnter",Li.KEYCODE_NUMPAD_ENTER],["NumpadDecimal",Li.KEYCODE_NUMPAD_DOT]]);function Bi(e,n,i){var o=e.code,r=Ai.get(o);if(!r)throw new Error("undefined keycode");return i.numLock=e.getModifierState("NumLock"),i.capsLock=e.getModifierState("CapsLock"),i.scrollLock=e.getModifierState("ScrollLock"),"AltLeft"===o&&(i.altLeft=n),"AltRight"===o&&(i.altRight=n),"ControlLeft"===o&&(i.ctrlLeft=n),"ControlRight"===o&&(i.ctrlRight=n),"MetaLeft"===o&&(i.metaLeft=n),"MetaRight"===o&&(i.metaRight=n),"ShiftLeft"===o&&(i.shiftLeft=n),"ShiftRight"===o&&(i.shiftRight=n),new Hn(n?t.MobileKeysActionType.ActionDown:t.MobileKeysActionType.ActionUp,r,i.metaState)}var Ki,Ii=function(){function e(){}return e.enhanceKeyboardInput=function(t){t.tabIndex=-1;var e=function(){return t.focus()};t.addEventListener("touchstart",e,{passive:!0}),t.addEventListener("mouseenter",e),t.addEventListener("click",e)},e.createDefaultEventStream=function(e,n){e.addEventListener("contextmenu",(function(t){return t.preventDefault()}));var i=Ke(e,"mousedown").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return Sn.formMouseEvent(t,!0).dumps()}))),o=Ke(e,"mouseup").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return Sn.formMouseEvent(t,!1).dumps()}))),r=Ke(e,"mousemove").pipe(Je((function(t){return t.preventDefault()})),Se((function(e){return ii(e,n.mouseNormalizeType===t.EventType.MouseMoveStandardization,n.isOrientationMatch)})),Se((function(t){var e=t.x,i=t.y,o=t.dx,r=t.dy;return new xn(e,i,o*n.pointerSpeed,r*n.pointerSpeed,n.mouseMoveType,n.mouseNormalizeType).dumps()}))),a=Ke(e,"mouseleave").pipe(Je((function(t){return t.preventDefault()})),Se(di),Se((function(e){return ii(e,n.mouseNormalizeType===t.EventType.MouseMoveStandardization,n.isOrientationMatch)})),Se((function(t){var e=t.x,i=t.y,o=t.dx,r=t.dy;return new xn(e,i,o,r,n.mouseMoveType,n.mouseNormalizeType).dumps()}))),s=Ke(e,"wheel",{passive:!1}).pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return On.fromWheelEvent(t).dumps()})));function c(e,n){var i=n===t.TouchType.TouchUpdate?"touches":"changedTouches";return new Pn(n,function(t,e){var n=t.target,i=n.videoWidth,o=n.videoHeight,r=n.clientHeight,a=n.clientWidth,s=n.getBoundingClientRect(),c=s.left,u=s.top;return e.map((function(t){var e=t.clientX,n=t.clientY;return{x:i/a*(e-c),y:o/r*(n-u),id:t.identifier}}))}(e,Array.from(e[i]))).dumps()}var u,d,h=Ke(e,"touchend"),l=Ke(e,"touchmove",{passive:!1}),p=Ke(e,"touchstart",{passive:!1}),f=Ke(e,"touchcancel"),v=l.pipe(Je((function(t){return t.preventDefault()})),Qe(Xe(h,f)),$e(100),He((function(t){return 2===t.targetTouches.length})),ze(),Se(si),Se((function(t){return On.fromPinchZoom(t/10).dumps()})),Ve()),m=Ye((function(){return n.fakeMouseWithTouch}),p.pipe(Je((function(t){return t.preventDefault()})),(u=function(e){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=se(t);return xe(t,n)}((i=ii({target:e.target,clientX:e.targetTouches[0].clientX,clientY:e.targetTouches[0].clientY,movementX:0,movementY:0},n.mouseNormalizeType===t.EventType.MouseMoveStandardization,n.isOrientationMatch),o=i.x,r=i.y,a=i.dx,s=i.dy,new xn(o,r,a,s,n.mouseMoveType,n.mouseNormalizeType).dumps()),new Sn(3===e.targetTouches.length?t.MouseButtonType.ButtonMiddle:n.fakeTouchType,!0).dumps());var i,o,r,a,s},yt(d)?Pe(u,d,1):Pe(u,1))),p.pipe(Je((function(t){return t.preventDefault()})),Se((function(e){return c(e,t.TouchType.TouchDown)}))));return{wheelStream:s,mouseupStream:o,mousedownStream:i,mousemoveStream:r,zoomStream:v,startBufferStream:m,moveBufferStream:Ye((function(){return n.fakeMouseWithTouch}),l.pipe(Je((function(t){return t.preventDefault()})),Qe(Xe(h,f)),He((function(t){return 1===t.targetTouches.length||3===t.targetTouches.length})),ze(),Se(ci),Se((function(t){return ui(t,n.touchDeltaXSensitivity,n.touchDeltaYSensitivity)})),Se((function(e){return ii(e,n.mouseNormalizeType===t.EventType.MouseMoveStandardization,n.isOrientationMatch)})),Se((function(t){var e=t.x,i=t.y,o=t.dx,r=t.dy;return new xn(e,i,o,r,n.mouseMoveType,n.mouseNormalizeType).dumps()})),Ve()),l.pipe(Je((function(t){return t.preventDefault()})),Se((function(e){return c(e,t.TouchType.TouchUpdate)})))),endBufferStream:Ye((function(){return n.fakeMouseWithTouch}),Xe(h,f).pipe(Je((function(t){return t.preventDefault()})),Se((function(){return new Sn(n.fakeTouchType,!1).dumps()}))),Xe(h,f).pipe(Je((function(t){return t.preventDefault()})),Se((function(e){return c(e,t.TouchType.TouchUp)})))),leaveStream:a}},e.createPointerStream=function(e,n){e.addEventListener("contextmenu",(function(t){return t.preventDefault()}));var i=function(e){return ii(e,n.mouseNormalizeType===t.EventType.MouseMoveStandardization,n.isOrientationMatch)},o=function(t){var e=t.x,i=t.y,o=t.dx,r=t.dy;return new xn(e,i,o*n.pointerSpeed,r*n.pointerSpeed,n.mouseMoveType,n.mouseNormalizeType).dumps()},r=Ke(e,"pointerdown").pipe(Je((function(t){return t.preventDefault()})),Pe((function(e){if("touch"===e.pointerType){var i=ii(e,n.mouseNormalizeType===t.EventType.MouseMoveStandardization,n.isOrientationMatch),o=i.x,r=i.y,a=i.dx,s=i.dy;return[new xn(o,r,a,s,n.mouseMoveType,n.mouseNormalizeType).dumps(),Sn.formMouseEvent(e,!0).dumps()]}return[Sn.formMouseEvent(e,!0).dumps()]}))),a=Ke(e,"pointerup").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return Sn.formMouseEvent(t,!1).dumps()}))),c=Ke(e,"pointerleave").pipe(Je((function(t){return t.preventDefault()})),He((function(t){return"mouse"===t.pointerType})),Se(di),Se(i),Se(o)),u=Ke(e,"contextmenu").pipe(He((function(t){return"touch"===t.pointerType})),Pe((function(){return[new Sn(t.MouseButtonType.ButtonRight,!0),new Sn(t.MouseButtonType.ButtonRight,!1)]})),Se((function(t){return t.dumps()}))),d=Ke(e,"pointerrawupdate").pipe(Je((function(t){return t.preventDefault()}))),h=Ke(e,"pointermove").pipe(Je((function(t){return t.preventDefault()})));return{downStream:r,upStream:a,moveStream:Ye(mi,d,Ye(vi,h.pipe(Je((function(t){var n,i,o=t.getCoalescedEvents(),r=o[0],a=function(t){setTimeout((function(){e.dispatchEvent(new PointerEvent("pointermove",t))}),t.timeStamp-r.timeStamp)};try{for(var c=s(o),u=c.next();!u.done;u=c.next()){a(u.value)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}})),He((function(t){return!t.isTrusted}))),h)).pipe(Se((function(t){return ui(t,n.touchDeltaXSensitivity,n.touchDeltaYSensitivity)})),Se(i),Se(o)),stickEdgeStream:c,compatibilityStream:u,wheelStream:Ke(e,"wheel",{passive:!1}).pipe(Je((function(t){return t.preventDefault()})),$e(50),Se((function(t){return On.fromWheelEvent(t).dumps()})))}},e.createGamepadStream=function(){var e=Xe(Ke(window,"gamepadconnected"),Ke(window,"gamepaddisconnected")).pipe(Se((function(){return navigator.getGamepads()})),Se((function(t){return t.filter((function(t){return!!t})).length})),Se((function(t){return new Ln(t).dumps()}))),n=function(e){var n=[t.GamepadXboxButton.GamepadXboxButtonA,t.GamepadXboxButton.GamepadXboxButtonB,t.GamepadXboxButton.GamepadXboxButtonX,t.GamepadXboxButton.GamepadXboxButtonY,t.GamepadXboxButton.GamepadXboxButtonLeftShoulder,t.GamepadXboxButton.GamepadXboxButtonRightShoulder,void 0,void 0,t.GamepadXboxButton.GamepadXboxButtonBack,t.GamepadXboxButton.GamepadXboxButtonStart,t.GamepadXboxButton.GamepadXboxButtonLeftThumb,t.GamepadXboxButton.GamepadXboxButtonRightThumb,t.GamepadXboxButton.GamepadXboxButtonDpadUp,t.GamepadXboxButton.GamepadXboxButtonDpadDown,t.GamepadXboxButton.GamepadXboxButtonDpadLeft,t.GamepadXboxButton.GamepadXboxButtonDpadRight],i=0;e.buttons.forEach((function(t,e){var o,r=n[e];r&&((o=t).value>0||1==o.pressed)&&(i|=r)}));var o=c(e.axes.map((function(t){return 32767*t})),4),r=o[0],a=o[1],s=o[2],u=o[3],d=255*e.buttons[6].value,h=255*e.buttons[7].value;return new _n(t.GamepadType.GamepadXbox,e.index,i,d,h,r,-a,s,-u).dumps()},i=Ne(0,ie).pipe(Se((function(){return navigator.getGamepads()})),We());return Xe(e,i.pipe(Se((function(t){return t[0]})),He(yn),Ze({buttons:[],axes:[]}),ze(),He((function(t){var e=c(t,2);return gn(e[0],e[1])})),Se((function(t){var e=c(t,2);e[0];var i=e[1];return n(i)}))),i.pipe(Se((function(t){return t[1]})),He(yn),Ze({buttons:[],axes:[]}),ze(),He((function(t){var e=c(t,2);return gn(e[0],e[1])})),Se((function(t){var e=c(t,2);e[0];var i=e[1];return n(i)}))),i.pipe(Se((function(t){return t[2]})),He(yn),Ze({buttons:[],axes:[]}),ze(),He((function(t){var e=c(t,2);return gn(e[0],e[1])})),Se((function(t){var e=c(t,2);e[0];var i=e[1];return n(i)}))),i.pipe(Se((function(t){return t[3]})),He(yn),Ze({buttons:[],axes:[]}),ze(),He((function(t){var e=c(t,2);return gn(e[0],e[1])})),Se((function(t){var e=c(t,2);e[0];var i=e[1];return n(i)}))))},e.createClipboardStream=function(t){var e=this;return Ke(t,"focus").pipe(Pe((function(){return new Promise((function(t){try{navigator.permissions.query({name:"clipboard-read"}).then((function(n){return r(e,void 0,void 0,(function(){var e,i,o,r,c,u,d,h,l,p,f,v,m,y,g;return a(this,(function(a){switch(a.label){case 0:return e="","granted"!==n.state?[3,17]:[4,navigator.clipboard.read()];case 1:i=a.sent(),a.label=2;case 2:a.trys.push([2,15,16,17]),o=s(i),r=o.next(),a.label=3;case 3:if(r.done)return[3,14];c=r.value,a.label=4;case 4:a.trys.push([4,11,12,13]),y=void 0,u=s(c.types),d=u.next(),a.label=5;case 5:return d.done?[3,10]:(h=d.value,[4,c.getType(h)]);case 6:return"text/plain"!==(l=a.sent()).type?[3,8]:[4,new Response(l).text()];case 7:e=a.sent(),a.label=8;case 8:"image/png"===l.type&&(e=l),a.label=9;case 9:return d=u.next(),[3,5];case 10:return[3,13];case 11:return p=a.sent(),y={error:p},[3,13];case 12:try{d&&!d.done&&(g=u.return)&&g.call(u)}finally{if(y)throw y.error}return[7];case 13:return r=o.next(),[3,3];case 14:return[3,17];case 15:return f=a.sent(),v={error:f},[3,17];case 16:try{r&&!r.done&&(m=o.return)&&m.call(o)}finally{if(v)throw v.error}return[7];case 17:return[2,t(e)]}}))}))}))}catch(e){on.warn("browser not support clipboard API",e),t("")}}))})),Pe((function(t){return new Kn(t).dumps()})))},e.createKeyboardStream=function(t,e){return void 0===e&&(e=[]),this.enhanceKeyboardInput(t),{keydownStream:Ke(t,"keydown").pipe(Je((function(t){return t.preventDefault()})),He((function(t){return!e.includes(t.key)})),Se((function(t){return Mn.fromKeyboardEvent(t,!0).dumps()}))),keyupStream:Ke(t,"keyup").pipe(Je((function(t){return t.preventDefault()})),He((function(t){return!e.includes(t.key)})),Se((function(t){return Mn.fromKeyboardEvent(t,!1).dumps()})))}},e.createMobileTouchStream=function(e,n){var i=Ke(e,"mouseup").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return hi(t,n.isOrientationMatch)})),Se((function(e){var n=e.x,i=e.y;return new Nn(t.MobileTouchActionType.ActionUp,0,n,i).dumps()}))),o=Ke(e,"mousemove").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return hi(t,n.isOrientationMatch)})),Se((function(e){var n=e.x,i=e.y;return new Nn(t.MobileTouchActionType.ActionMove,0,n,i).dumps()}))),r=Ke(e,"mousedown").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return hi(t,n.isOrientationMatch)})),Se((function(e){var n=e.x,i=e.y;return new Nn(t.MobileTouchActionType.ActionDown,0,n,i).dumps()}))),a=Ke(e,"mouseleave").pipe(Je((function(t){return t.preventDefault()})),Se(di),Se((function(t){return hi(t,n.isOrientationMatch)})),Se((function(e){var n=e.x,i=e.y;return new Nn(t.MobileTouchActionType.ActionUp,0,n,i).dumps()}))),s=Ke(e,"touchend"),c=Ke(e,"touchcancel"),u=Ke(e,"touchmove",{passive:!1}),d=Ke(e,"touchstart",{passive:!1}).pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return li(t,!0,n.isOrientationMatch)})),ke(),Se((function(e){return new Nn(e.isAction?t.MobileTouchActionType.ActionDown:t.MobileTouchActionType.ActionPointerDown,e.id,e.x,e.y).dumps()}))),h=Xe(s,c).pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return li(t,!1,n.isOrientationMatch)})),ke(),Se((function(e){return new Nn(e.isAction?t.MobileTouchActionType.ActionUp:t.MobileTouchActionType.ActionPointerUp,e.id,e.x,e.y).dumps()}))),l=u.pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return li(t,!0,n.isOrientationMatch)})),ke(),Se((function(e){return new Nn(t.MobileTouchActionType.ActionMove,e.id,e.x,e.y).dumps()})));return Xe(l,d,h,i,o,r,a,this.createMobileKeyboardStream(e,n))},e.createMobileKeyboardStream=function(t,e){return this.enhanceKeyboardInput(t),Xe(Ke(t,"keydown").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return Bi(t,!0,e.metaState)})),Se((function(t){return t.dumps()}))),Ke(t,"keyup").pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return Bi(t,!1,e.metaState)})),Se((function(t){return t.dumps()}))))},e.createUeMultiTouchStream=function(e,n){var i=new xi,r=Ke(e,"touchend",{passive:!1}),a=Ke(e,"touchcancel",{passive:!1}),s=Ke(e,"touchmove",{passive:!1}),c=Ke(e,"touchstart",{passive:!1}).pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return oi(t,!0,n.isOrientationMatch)})),ke(),Se((function(e){return o(o({},e),{isAction:e.isAction?t.MobileTouchActionType.ActionDown:t.MobileTouchActionType.ActionPointerDown})}))),u=Xe(r,a).pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return oi(t,!1,n.isOrientationMatch)})),ke(),Se((function(e){return o(o({},e),{isAction:e.isAction?t.MobileTouchActionType.ActionUp:t.MobileTouchActionType.ActionPointerUp})}))),d=s.pipe(Je((function(t){return t.preventDefault()})),Se((function(t){return oi(t,!0,n.isOrientationMatch)})),ke(),Se((function(e){return o(o({},e),{isAction:t.MobileTouchActionType.ActionMove})})));return Xe(d,c,u).pipe(Se((function(e){return function(e,n){var i=e.x,o=e.y,r=e.id,a=e.isAction,s=e.force,c=a===t.MobileTouchActionType.ActionMove?ei.TouchMove:a===t.MobileTouchActionType.ActionDown||a===t.MobileTouchActionType.ActionPointerDown?ei.TouchDown:ei.TouchUp;c===ei.TouchDown&&n.trigger(r);var u={TouchType:c,TouchIndex:n.get(r),PosX:i,PosY:o,Force:(s||.5)/1*255};return c===ei.TouchUp&&n.shift(r),"RayInput_Touch:"+JSON.stringify(u)}(e,i)})))},e.attachMobileListener=function(t,e,n,i){var o=(void 0===i?{}:i).enableClipboard,r=void 0!==o&&o,a=this.createMobileTouchStream(t,e);return r&&on.warn("clipboard sync by creating event stream was deprecated, please use ClipboardSyncManager instead"),a=Xe(a,Ke(t,"wheel",{passive:!1}).pipe(Je((function(t){return t.preventDefault()})),Se((function(t){var n=hi(t,e.isOrientationMatch),i=n.x,o=n.y;return new Zn(i,o,Math.sign(t.deltaY)).dumps()})))),a.pipe(Qe(Ke(n.dc,"close"))).subscribe((function(t){return n.send(t,!0)}))},e.attachListener=function(t,e,n,i){var o,r=void 0===i?{}:i,a=r.enableClipboard,s=void 0!==a&&a,c=r.enableGamepad,u=void 0!==c&&c,d=r.filterKeys,h=void 0===d?[]:d,l=r.enableKeyBoard,p=void 0===l||l,f=r.usePointerEvent;if(void 0!==f&&f){var v=this.createPointerStream(t,e),m=v.downStream,y=v.upStream,g=v.moveStream,E=v.stickEdgeStream,C=v.compatibilityStream;o=Xe(v.wheelStream,m,y,g,E,C)}else{var w=this.createDefaultEventStream(t,e);o=Xe(w.wheelStream,w.mouseupStream,w.mousedownStream,w.mousemoveStream,w.zoomStream,w.startBufferStream,w.moveBufferStream,w.endBufferStream,w.leaveStream)}if(s&&on.warn("clipboard sync by creating event stream was deprecated, please use ClipboardSyncManager instead"),u&&(o=Xe(o,this.createGamepadStream())),p){var b=this.createKeyboardStream(t,h);o=Xe(o,b.keyupStream,b.keydownStream)}return o.pipe(Qe(Ke(n.dc,"close"))).subscribe((function(t){return n.send(t,!0)}))},e.attachUEListener=function(t,e,n,i){var o=void 0===i?{}:i,r=o.enableTouchInteraction,a=void 0!==r&&r,s=o.enableZoomInteraction,c=void 0!==s&&s,u=this.createDefaultEventStream(t,e),d=u.zoomStream,h=u.startBufferStream,l=u.moveBufferStream,p=u.endBufferStream,f=this.createUeMultiTouchStream(t,e);return a&&(f=Xe(f,h,l,p)),c&&(f=Xe(f,d)),f.pipe(Qe(Ke(n.dc,"close"))).subscribe((function(t){"string"==typeof t?n.emitUIInteraction(t,!0):n.send(t,!0)}))},e}(),Yi=function(){function t(){this.altLeft=!1,this.altRight=!1,this.ctrlLeft=!1,this.ctrlRight=!1,this.metaLeft=!1,this.metaRight=!1,this.shiftLeft=!1,this.shiftRight=!1,this.numLock=!1,this.capsLock=!1,this.scrollLock=!1}return Object.defineProperty(t.prototype,"altOn",{get:function(){return this.altLeft||this.altRight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ctrlOn",{get:function(){return this.ctrlLeft||this.ctrlRight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metaOn",{get:function(){return this.metaLeft||this.metaRight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shiftOn",{get:function(){return this.shiftLeft||this.shiftRight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metaState",{get:function(){var t=0;return this.altOn&&(t|=2),this.altLeft&&(t|=16),this.altRight&&(t|=32),this.ctrlOn&&(t|=4096),this.ctrlLeft&&(t|=8192),this.ctrlRight&&(t|=16384),this.metaOn&&(t|=65536),this.metaLeft&&(t|=131072),this.metaRight&&(t|=262144),this.shiftOn&&(t|=1),this.shiftLeft&&(t|=64),this.shiftRight&&(t|=128),this.numLock&&(t|=2097152),this.capsLock&&(t|=1048576),this.scrollLock&&(t|=4194304),t},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.altLeft=!1,this.altRight=!1,this.ctrlLeft=!1,this.ctrlRight=!1,this.metaLeft=!1,this.metaRight=!1,this.shiftLeft=!1,this.shiftRight=!1},t}(),Ui=function(e,n,i,o,r,a,s,c,u,d,h,l,p,f,v,m){void 0===e&&(e=t.EventType.MouseMoveStandardization),void 0===n&&(n=t.MoveType.Passive),void 0===i&&(i=t.MouseButtonType.ButtonLeft),void 0===o&&(o=!0),void 0===r&&(r=1),void 0===a&&(a=1),void 0===s&&(s=1),void 0===c&&(c=0),void 0===u&&(u=0),void 0===d&&(d=0),void 0===h&&(h=!0),void 0===l&&(l=1920),void 0===p&&(p=1080),void 0===f&&(f=1),void 0===v&&(v=new Yi),void 0===m&&(m=!1),this.mouseNormalizeType=e,this.mouseMoveType=n,this.fakeTouchType=i,this.fakeMouseWithTouch=o,this.touchDeltaXSensitivity=r,this.touchDeltaYSensitivity=a,this.pointerSpeed=s,this.framerate=c,this.bitrate=u,this.gopLength=d,this.isOrientationMatch=h,this.mobileScreenWidth=l,this.mobileScreenHeight=p,this.mobileResolutionScale=f,this.metaState=v,this.allowReceivedRemoteFile=m},Ni=function(){function t(e,n,i,o){void 0===i&&(i=1),void 0===o&&(o=!0),this.position=e,this.dimension=n,this.opacity=i,this.match=o,this.canvas=t.createCanvas(e[0],e[1],n[0],n[1]),this.canvas.width=n[0]*this.dpr,this.canvas.height=n[1]*this.dpr,this.context=this.canvas.getContext("2d"),this.context.globalAlpha=i}return t.createCanvas=function(t,e,n,i){var o=document.createElement("canvas");return o.style.touchAction="none",o.style.position="absolute",o.style.left=t+"%",o.style.top=e+"%",o.style.pointerEvents="auto",o.style.width=n+"px",o.style.height=i+"px",o},Object.defineProperty(t.prototype,"dpr",{get:function(){return window.devicePixelRatio||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centerX",{get:function(){return this.canvas.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centerY",{get:function(){return this.canvas.height/2},enumerable:!1,configurable:!0}),t.prototype.setOrientationMatch=function(t){this.match=t},t.prototype.setPosition=function(t){this.position=t,this.canvas.style.left=t[0]+"%",this.canvas.style.top=t[1]+"%"},t.prototype.setDimension=function(t){this.dimension=t,this.canvas.width=t[0]*this.dpr,this.canvas.height=t[1]*this.dpr,this.canvas.style.width=t[0]+"px",this.canvas.style.height=t[1]+"px",this.context.globalAlpha=this.opacity,this.draw()},t.prototype.mount=function(t){this.mountEl=t,t.appendChild(this.canvas)},t.prototype.provideHandler=function(t){this.onInteract=t},t.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.destory=function(){this.mountEl=void 0,this.canvas.remove()},t}(),Xi=function(t){function e(e,n,i,o,r,a,s,c,u,d){void 0===e&&(e=[0,0]),void 0===n&&(n=[50,50]),void 0===i&&(i=1),void 0===o&&(o=!0),void 0===s&&(s=""),void 0===c&&(c=""),void 0===u&&(u=0),void 0===d&&(d="");var h=t.call(this,e,n,i,o)||this;return h.downEvent=r,h.upEvent=a,h.displayText=s,h.keyCodeText=c,h.keyRepeat=u,d&&(h.img=new Image,h.img.onerror=function(){return h.img=void 0},h.img.src=d),h.canvas.addEventListener("touchstart",(function(t){var e;t.preventDefault(),null===(e=h.onInteract)||void 0===e||e.call(h,r)}),{passive:!1}),h.canvas.addEventListener("touchend",(function(t){var e;t.preventDefault(),a&&(null===(e=h.onInteract)||void 0===e||e.call(h,a))})),h}return i(e,t),e.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):this.drawTray(),this.writeText(this.context,this.keyCodeText,this.displayText?.45:.5,.3),this.displayText&&this.writeText(this.context,this.displayText,.7)},e.prototype.writeText=function(t,e,n,i){void 0===i&&(i=.2),t.font="".concat(this.canvas.width*i+"px"," Arial"),t.fillStyle="rgb(255, 255, 255)",t.textBaseline="middle";var o=t.measureText(e).width;t.fillText(e,(this.canvas.width-o)/2,this.canvas.height*n)},e.prototype.drawTray=function(){this.context.beginPath(),this.context.strokeStyle="rgba(255, 255, 255, 0.4)",this.context.fillStyle="rgba(9, 21, 40, 0.6)",this.context.lineWidth=2,this.context.arc(this.canvas.width/2,this.canvas.width/2,this.canvas.width/2-1,0,2*Math.PI),this.context.fill(),this.context.stroke()},e}(Ni),Hi=function(t){function e(e,n,i,o,r,a,s,c){void 0===e&&(e=[0,0]),void 0===n&&(n=[50,50]),void 0===i&&(i=1),void 0===o&&(o=!0),void 0===s&&(s=0),void 0===c&&(c="");var u=t.call(this,e,n,i,o)||this;return u.forwardEvent=r,u.backwardEvent=a,u.keyRepeat=s,u.intervalID=NaN,u.state="default",u.pressed=!1,u.handleTouchStart=function(t){u.pressed=!0,u.keyRepeat&&(u.intervalID&&window.clearInterval(u.intervalID),u.intervalID=window.setInterval((function(){var t,e;switch(u.state){case"forward":null===(t=u.onInteract)||void 0===t||t.call(u,u.forwardEvent);break;case"backward":null===(e=u.onInteract)||void 0===e||e.call(u,u.backwardEvent)}}),u.keyRepeat))},u.handleTouchEnd=function(t){u.state="default",u.pressed=!1,window.clearInterval(u.intervalID),u.intervalID=NaN},u.handleTouchMove=function(t){if(t.preventDefault(),u.pressed&&t.target===u.canvas){var e=u.canvas.getBoundingClientRect(),n=e.top,i=e.right,o=t.clientX,r=t.clientY,a=u.match?r-n:i-o;u.state=a*u.dpr>u.centerX?"backward":"forward"}},c&&(u.img=new Image,u.img.onerror=function(){return u.img=void 0},u.img.src=c),u.canvas.addEventListener("contextmenu",(function(t){return t.preventDefault()})),u.canvas.addEventListener("pointermove",u.handleTouchMove),u.canvas.addEventListener("pointerdown",u.handleTouchStart),u.canvas.addEventListener("pointerup",u.handleTouchEnd),u.canvas.addEventListener("pointercancel",u.handleTouchEnd),u}return i(e,t),e.prototype.drawTray=function(){this.context.beginPath(),this.context.strokeStyle="rgba(255, 255, 255, 0.4)",this.context.fillStyle="rgba(9, 21, 40, 0.6)",this.context.lineWidth=2,this.context.arc(this.canvas.width/2,this.canvas.width/2,this.canvas.width/2-1,0,2*Math.PI),this.context.fill(),this.context.stroke()},e.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):this.drawTray()},e}(Ni),Fi=2*Math.PI;!function(t){t[t.WASD=0]="WASD",t[t.Direction=1]="Direction",t[t.Look=2]="Look"}(Ki||(Ki={}));var ji=function(e){function n(n,i,o,r,a,s,c){void 0===n&&(n=[0,0]),void 0===i&&(i=[254,254]),void 0===o&&(o=1),void 0===r&&(r=!0),void 0===a&&(a=Ki.WASD),void 0===s&&(s=""),void 0===c&&(c="");var u=e.call(this,n,i,o,r)||this;return u.mappingType=a,u.timerID=NaN,u.pressed=!1,u.axis={x:0,y:0},u.keyState=0,u.handleStart=function(e){var n;e.preventDefault(),u.pressed=!0,u.mappingType===Ki.Look&&(null===(n=u.onInteract)||void 0===n||n.call(u,new Sn(t.MouseButtonType.ButtonRight,!0).dumps())),u.move(e.clientX,e.clientY),u.handleChange(),u.draw()},u.handleEnd=function(e){var n;e.preventDefault(),u.pressed=!1,u.movedX=u.centerX,u.movedY=u.centerY,u.axis.x=u.axis.y=0,u.handleChange(),u.mappingType===Ki.Look&&(null===(n=u.onInteract)||void 0===n||n.call(u,new Sn(t.MouseButtonType.ButtonRight,!1).dumps())),u.draw()},u.handleTouchMove=function(t){t.preventDefault(),u.pressed&&t.target===u.canvas&&(u.move(t.clientX,t.clientY),u.handleChange(),u.draw())},s&&(u.trayImg=new Image,u.trayImg.onerror=function(){return u.trayImg=void 0},u.trayImg.src=s),c&&(u.handleImg=new Image,u.handleImg.onerror=function(){return u.handleImg=void 0},u.handleImg.src=c),u.radius=u.dimension[0]*u.dpr/2,u.ratio=u.radius/127,u.trayRadius=90*u.ratio,u.handleRadius=37*u.ratio,u.movedX=u.movedY=u.centerX,u.canvas.addEventListener("pointerdown",u.handleStart),u.canvas.addEventListener("pointermove",u.handleTouchMove),u.canvas.addEventListener("pointerup",u.handleEnd),u.canvas.addEventListener("pointercancel",u.handleEnd),u.canvas.addEventListener("contextmenu",(function(t){return t.preventDefault()})),u.mappingType===Ki.Look&&(u.timerID=window.setInterval((function(){var e;u.axis.x&&u.axis.y&&u.pressed&&(null===(e=u.onInteract)||void 0===e||e.call(u,new xn(0,0,50*u.axis.x,50*u.axis.y,t.MoveType.Relative,t.EventType.MouseMoveStandardization).dumps()))}),33)),u}return i(n,e),Object.defineProperty(n.prototype,"keyMaping",{get:function(){var t;return(t={},t[Ki.Look]=[0,0,0,0],t[Ki.WASD]=[68,65,83,87],t[Ki.Direction]=[39,37,40,38],t)[this.mappingType]},enumerable:!1,configurable:!0}),n.prototype.setDimension=function(t){e.prototype.setDimension.call(this,t),this.radius=t[0]*this.dpr/2,this.ratio=this.radius/127,this.trayRadius=90*this.ratio,this.handleRadius=37*this.ratio,this.movedX=this.movedY=this.centerX,this.draw()},n.prototype.move=function(t,e){var n=this.canvas.getBoundingClientRect(),i=n.left,o=n.top,r=n.right;this.movedX=(this.match?t-i:e-o)*this.dpr,this.movedY=(this.match?e-o:r-t)*this.dpr;var a=this.movedX-this.centerX,s=this.movedY-this.centerY,c=Math.atan2(s,a),u=Math.min(this.trayRadius,Math.hypot(a,s));this.movedX=u*Math.cos(c)+this.radius,this.movedY=u*Math.sin(c)+this.radius;var d=u<this.handleRadius?0:this.radius/(this.radius-this.handleRadius)*(u-this.handleRadius);this.axis.x=parseFloat((d*Math.cos(c)/this.radius).toFixed(4)),this.axis.y=parseFloat((d*Math.sin(c)/this.radius).toFixed(4))},n.prototype.handleChange=function(){var t=this;if(this.mappingType!==Ki.Look){if(this.axis.x+this.axis.y===0)return rn(4).forEach((function(e){return t.keyState>>e&1&&t.fireEvent(t.keyMaping[e],!1)})),void(this.keyState=0);var e=180*Math.atan2(this.axis.y,this.axis.x)/Math.PI,i=0;(e=e<=0?360+e:e)>=0&&e<23||e>=338&&e<=360?i=n.Right:e>23&&e<=68?i=n.DownRight:e>68&&e<=113?i=n.Down:e>113&&e<=158?i=n.DownLeft:e>158&&e<=203?i=n.Left:e>203&&e<=248?i=n.UpLeft:e>248&&e<=293?i=n.Up:e>293&&e<=338&&(i=n.UpRight);var o=i^this.keyState;o>0&&rn(4).forEach((function(e){return o>>e&1&&t.fireEvent(t.keyMaping[e],!(t.keyState>>e&1))})),this.keyState=i}},n.prototype.fireEvent=function(t,e){var n;null===(n=this.onInteract)||void 0===n||n.call(this,new Mn(t,!1,!1,!1,!1,!1,!1,e).dumps())},n.prototype.draw=function(){if(this.clear(),this.context.strokeStyle="rgba(255, 255, 255, 0.4)",this.context.fillStyle="rgba(9, 21, 40, 0.6)",this.context.lineWidth=2,this.context.beginPath(),this.trayImg)this.context.drawImage(this.trayImg,0,0,this.canvas.width,this.canvas.height);else switch(this.context.arc(this.centerX,this.centerY,this.trayRadius-1,0,Fi),this.context.fill(),this.context.stroke(),this.mappingType){case Ki.Direction:this.drawArrow();break;case Ki.WASD:this.drawLetters();case Ki.Look:}this.handleImg?this.context.drawImage(this.handleImg,this.movedX-this.handleRadius,this.movedY-this.handleRadius,2*this.handleRadius,2*this.handleRadius):(this.context.beginPath(),this.context.arc(this.movedX,this.movedY,this.handleRadius-1,0,Fi),this.context.fill(),this.context.stroke())},n.prototype.drawArrow=function(){var t=-21,e=-74,n=new Path2D("M0 21L11.2437 21L21 11.2437L30.7562 21L42 21L21 3.64767e-07L0 21Z");this.context.save(),this.context.translate(this.centerX,this.centerY),this.context.scale(this.ratio,this.ratio),this.context.fillStyle="white",this.context.save(),this.context.translate(t,e),this.context.fill(n),this.context.restore(),this.context.save(),this.context.rotate(.5*Math.PI),this.context.translate(t,e),this.context.fill(n),this.context.restore(),this.context.save(),this.context.rotate(Math.PI),this.context.translate(t,e),this.context.fill(n),this.context.restore(),this.context.save(),this.context.rotate(-.5*Math.PI),this.context.translate(t,e),this.context.fill(n),this.context.restore(),this.context.restore()},n.prototype.drawLetters=function(){var t=24*this.ratio,e=74*this.ratio-t/2;this.context.save(),this.context.font="bold ".concat(t,"px sans-serif"),this.context.fillStyle="white",this.context.textAlign="center",this.context.textBaseline="middle",this.context.translate(this.centerX,this.centerY),this.context.fillText("W",0,-e),this.context.fillText("A",-e,0),this.context.fillText("S",0,e),this.context.fillText("D",e,0),this.context.restore()},n.prototype.destory=function(){e.prototype.destory.call(this),window.clearInterval(this.timerID)},n.MappingType=Ki,n.Up=8,n.Down=4,n.Left=2,n.Right=1,n.UpRight=n.Up|n.Right,n.UpLeft=n.Up|n.Left,n.DownLeft=n.Down|n.Left,n.DownRight=n.Down|n.Right,n}(Ni),zi=function(){function t(t,e,n,i,o,r,a,s){this.ctx=t,this.offsetX=e,this.offsetY=n,this.width=i,this.height=o,this.content=r,this.buttonStyle=a,this.onTouchedChange=s,this.draw(!1)}return t.prototype.isStartTouched=function(t,e){this.isTouchInPath(t,e)&&this.draw(!0)},t.prototype.isEndTouched=function(t,e){var n;this.isTouchInPath(t,e)&&(this.draw(!1),null===(n=this.onTouchedChange)||void 0===n||n.call(this))},t.prototype.isTouchInPath=function(t,e){return t>=this.offsetX&&t<=this.offsetX+this.width&&e>=this.offsetY&&e<=this.offsetY+this.height||t>=this.offsetX+this.width&&t<=this.offsetX&&e>=this.offsetY&&e<=this.offsetY+this.height||t>=this.offsetX&&t<=this.offsetX+this.width&&e>=this.offsetY+this.height&&e<=this.offsetY||t>=this.offsetX+this.width&&t<=this.offsetX&&e>=this.offsetY+this.height&&e<=this.offsetY},t.prototype.clear=function(){this.ctx.clearRect(this.offsetX,this.offsetY,this.width,this.height)},t.prototype.draw=function(t){this.clear(),this.drawRect(t),this.writeContent(t)},t.prototype.drawRect=function(t){this.ctx.beginPath(),this.ctx.fillStyle=t?"#ddd":this.buttonStyle.background,this.ctx.moveTo(this.offsetX,this.offsetY),this.ctx.lineTo(this.offsetX+this.width,this.offsetY),this.ctx.lineTo(this.offsetX+this.width,this.offsetY+this.height),this.ctx.lineTo(this.offsetX,this.offsetY+this.height),this.ctx.closePath(),this.ctx.fill()},t.prototype.writeContent=function(t){this.ctx.font="12px",this.ctx.fillStyle=t?"#000":this.buttonStyle.color,this.ctx.fillText(this.content,this.offsetX+this.width/2-2*this.content.length,this.offsetY+this.height/2+4)},t}(),Vi=["Switch","abc"],Wi=["(",")","+","!","@","#","$","%","^","&","*"],Gi=new Map([["KeyQ",81],["KeyW",87],["KeyE",69],["KeyR",82],["KeyT",84],["KeyY",89],["KeyU",85],["KeyI",73],["KeyO",79],["KeyP",80],["KeyA",65],["KeyS",83],["KeyD",68],["KeyF",70],["KeyG",71],["KeyH",72],["KeyJ",74],["KeyK",75],["KeyL",76],["KeyZ",90],["KeyX",88],["KeyC",67],["KeyV",86],["KeyB",66],["KeyN",78],["KeyM",77],["Tab",9],["Space",32],["Quote",222],["Comma",188],["Period",190],["CapsLock",20],["Enter",13],["ShiftLeft",16],["ShiftRight",16],["ControlLeft",17],["ControlRight",17],["Backspace",8],["ArrowLeft",37],["ArrowRight",39],["ArrowUp",38],["ArrowDown",40],["Backslash",220],["Slash",191],["Semicolon",186],["Minus",189],["Equal",187],["Digit0",48],["Digit1",49],["Digit2",50],["Digit3",51],["Digit4",52],["Digit5",53],["Digit6",54],["Digit7",55],["Digit8",56],["Digit9",57],[")",48],["!",49],["@",50],["#",51],["$",52],["&",55],["*",56],["(",57],["%",53],["^",54],["+",187]]),Zi=new Map([["KeyQ","q"],["KeyW","w"],["KeyE","e"],["KeyR","r"],["KeyT","t"],["KeyY","y"],["KeyU","u"],["KeyI","i"],["KeyO","o"],["KeyP","p"],["KeyA","a"],["KeyS","s"],["KeyD","d"],["KeyF","f"],["KeyG","g"],["KeyH","h"],["KeyJ","j"],["KeyK","k"],["KeyL","l"],["KeyZ","z"],["KeyX","x"],["KeyC","c"],["KeyV","v"],["KeyB","b"],["KeyN","n"],["KeyM","m"],["Tab","tab"],["Space"," "],["Quote","'"],["Comma",","],["Period","."],["CapsLock","caps"],["Enter","enter"],["ShiftLeft","shift"],["ShiftRight","shift"],["ControlLeft","ctrl"],["ControlRight","ctrl"],["Backspace","back"],["ArrowLeft",""],["ArrowRight",""],["ArrowUp",""],["ArrowDown",""],["Backslash","\\"],["Slash","/"],["Semicolon",";"],["Minus","-"],["Equal","="],["Digit0","0"],["Digit1","1"],["Digit2","2"],["Digit3","3"],["Digit4","4"],["Digit5","5"],["Digit6","6"],["Digit7","7"],["Digit8","8"],["Digit9","9"],[")",")"],["!","!"],["@","@"],["#","#"],["$","$"],["&","&"],["*","*"],["(","("],["%","%"],["^","^"],["+","+"],["Switch","&123"],["abc","abc"]]),Qi=new Map([["Backspace",2],["CapsLock",1.4],["ShiftLeft",2.43],["Enter",2],["Space",5.3],["Tab",1.4]]),Ji=new Map([["Space",4.6],["Backspace",2.22]]),qi=new Map([[0,["Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","Backspace"]],[1,["CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Quote","Enter"]],[2,["ShiftLeft","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","KeyK","KeyL","Comma","Period"]],[3,["ControlLeft","Switch","Space","ControlRight","ArrowLeft","ArrowUp","ArrowDown","ArrowRight"]]]),$i=new Map([[0,["!","@","#","&","$"]],[1,["(",")","Equal","*","Tab"]],[2,["Backslash","Semicolon","Quote","^","Slash"]],[3,["Space","abc"]]]),to=new Map([[0,["Digit1","Digit2","Digit3","Backspace"]],[1,["Digit4","Digit5","Digit6","Minus","%"]],[2,["Digit7","Digit8","Digit9","ArrowUp","+"]],[3,["Digit0","Period","ArrowLeft","ArrowDown","ArrowRight"]]]),eo=function(t){function e(e,n,i){void 0===e&&(e=[0,0]),void 0===n&&(n=[100,100]),void 0===i&&(i={background:"rgba(0, 0, 0, 0.3)",fontColor:"#000",ButtonBackground:"rgba(255, 255, 255, 0.6)"});var o=t.call(this,e,n)||this;return o.theme=i,o.buttons=[],o.keyboardType="letters",o.capsLock=!1,o.setupListener(),o}return i(e,t),Object.defineProperty(e.prototype,"GAP",{get:function(){return.04*this.canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasWidth",{get:function(){return this.canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasHeight",{get:function(){return this.canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buttonHeight",{get:function(){return(this.canvas.height-5*this.GAP)/4},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ctx",{get:function(){return this.canvas.getContext("2d")},enumerable:!1,configurable:!0}),e.getCanvasHeightMultiple=function(t,e){var n=e/t;return n>.7&&n<=.8?1-n:n>.8&&n<.9?.35:n>=.9?.3:.45},e.prototype.mount=function(n){t.prototype.mount.call(this,n);var i=n.clientWidth,o=n.clientHeight,r=1-e.getCanvasHeightMultiple(i,o);this.setPosition([0,100*r])},e.prototype.draw=function(){if(this.mountEl){var t=this.mountEl,n=t.clientWidth,i=t.clientHeight;this.canvas.width=n,this.canvas.height=i*e.getCanvasHeightMultiple(n,i),this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.fillBackground(this.ctx,this.theme.background),this.drawButton()}},e.prototype.fillBackground=function(t,e){t.fillStyle=e,t.fillRect(0,0,this.canvasWidth,this.canvasHeight)},e.prototype.drawButton=function(){"letters"===this.keyboardType?this.drawButtons():this.drawSpecialButtons()},e.prototype.drawButtons=function(){var t=this;this.buttons=[],qi.forEach((function(e,n){var i=(t.canvasWidth-(e.length+1)*t.GAP-e.reduce((function(e,n){return e+=t.getButtonWidth(n,1)}),0))/2;e.forEach((function(e){var o=t.getButtonWidth(e,1),r=new zi(t.ctx,i,n*t.buttonHeight+(n+1)*t.GAP,o,t.buttonHeight,t.getIdentityByCode(e),{color:"#000",background:t.theme.ButtonBackground},"Switch"===e?function(){t.keyboardType="numeric",t.draw()}:function(){t.onInterectChange(e)});t.buttons.push(r),i+=o+t.GAP}))}))},e.prototype.drawSpecialButtons=function(){var t=this;this.buttons=[],new Map([[$i,-1],[to,1]]).forEach((function(e,n){n.forEach((function(n,i){var o=t.canvasWidth/2+t.GAP*e;n.forEach((function(n){var r=t.getButtonWidth(n,2),a=new zi(t.ctx,o,i*t.buttonHeight+(i+1)*t.GAP,r*e,t.buttonHeight,t.getIdentityByCode(n),{color:"#000",background:t.theme.ButtonBackground},"abc"===n?function(){t.keyboardType="letters",t.draw()}:function(){t.onInterectChange(n)});t.buttons.push(a),o+=(r+t.GAP)*e}))}))}))},e.prototype.transformNormalKeyCode=function(t){return new Mn(this.getKeycodeOfCode(t),!1,!1,!1,!1,this.capsLock,!1,!0).dumps()},e.prototype.transformCombileKeyCode=function(t){return new Mn(this.getKeycodeOfCode(t),!1,!0,!1,!1,this.capsLock,!1,!0).dumps()},e.prototype.handleTouchStart=function(t){t.stopPropagation(),t.preventDefault();var e=t.target,n=Array.from(t.touches),i=e.getBoundingClientRect(),o=i.left,r=i.top,a=i.right,s=n[0],c=s.clientX,u=s.clientY,d=this.match?c-o:u-r,h=this.match?u-r:a-c;this.buttons.forEach((function(t){t.isStartTouched(d,h)}))},e.prototype.handleTouchEnd=function(t){t.stopPropagation(),t.preventDefault();var e=t.target,n=Array.from(t.changedTouches),i=e.getBoundingClientRect(),o=i.left,r=i.top,a=i.right,s=n[0],c=s.clientX,u=s.clientY,d=this.match?c-o:u-r,h=this.match?u-r:a-c;this.buttons.forEach((function(t){t.isEndTouched(d,h)}))},e.prototype.setupListener=function(){this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this))},e.prototype.removeListener=function(){this.canvas.removeEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this))},e.prototype.onInterectChange=function(t){var e,n;"CapsLock"===t&&(this.capsLock=!this.capsLock),Wi.includes(t)||Vi.includes(t)||null===(e=this.onInteract)||void 0===e||e.call(this,this.transformNormalKeyCode(t)),Wi.includes(t)&&(null===(n=this.onInteract)||void 0===n||n.call(this,this.transformCombileKeyCode(t)))},e.prototype.getIdentityByCode=function(t){var e=Zi.get(t);if(!e)throw new Error("Cannot find the correct key code: ".concat(t));return e},e.prototype.getKeycodeOfCode=function(t){var e=Gi.get(t);if(!e)throw new Error("Cannot find the correct keycode of code: ".concat(t));return e},e.prototype.getButtonWidth=function(t,e){var n=1===e?Qi.get(t):Ji.get(t);return n?n*this.buttonHeight:this.buttonHeight},e}(Ni),no=function(){function t(t,e){this.hostElement=t,this.onEvent=e,this.layouts=[]}return t.prototype.createLayout=function(e){var n=this;void 0===e&&(e=[]);var i=t.createPanel();this.hostElement.appendChild(i);var o=this.layouts.length;return this.layouts.push({id:o,panel:i,controls:[]}),e.forEach((function(t){return n.appendControl(o,t)})),o},t.prototype.appendControl=function(t,e){var n=this.layouts.find((function(e){return e.id===t}));if(!n)throw new Error("Layout not exist with id ".concat(t));n.controls=n.controls.concat(e),e.provideHandler(this.onEvent),e.mount(n.panel)},t.prototype.getLayout=function(t){return this.layouts.find((function(e){return e.id===t}))},t.prototype.removeLayout=function(t){this.layouts=this.layouts.filter((function(e){return e.id!==t}))},t.prototype.changeOrientation=function(t){this.layouts.forEach((function(e){return e.controls.forEach((function(e){return e.setOrientationMatch(t)}))}))},t.prototype.show=function(t){if(!this.layouts[t])throw new Error("Layout not exist with id ".concat(t));this.layouts[t].panel.style.display="block",this.layouts[t].controls.forEach((function(t){return t.draw()}))},t.prototype.hide=function(t){this.layouts[t].panel.style.display="none"},t.createPanel=function(){var t=document.createElement("div");return t.style.cssText="\n      pointer-events: none;\n      display: none;\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      top: 0px;\n      left: 0px;\n      transform-origin: top left;\n      z-index: 1;\n    ",t},t}();function io(t,e,n,i){void 0===i&&(i=.75);var o=t.getContext("2d");if(!o)throw new Error("getContext('2d') failed");var r=Math.hypot(e,n)/2,a=t.width*i/2/r;o.translate(t.width/2,t.height/2),o.translate(-e/2*a,-n/2*a),o.scale(a,a)}var oo=function(e){function n(n,i,o,r,a,s){void 0===n&&(n=[0,0]),void 0===i&&(i=[50,50]),void 0===o&&(o=1),void 0===r&&(r=!0),void 0===a&&(a="#F2063F"),void 0===s&&(s="");var c=e.call(this,n,i,o,r,new Sn(t.MouseButtonType.ButtonLeft,!0).dumps(),new Sn(t.MouseButtonType.ButtonLeft,!1).dumps(),void 0,void 0,void 0,s)||this;return c.themeColor=a,c}return i(n,e),n.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):(e.prototype.drawTray.call(this),this.context.save(),io(this.canvas,40,40),this.context.fillStyle=this.themeColor,this.context.fill(new Path2D("M20 19V3L10.1818 7.8L8 19H20Z")),this.context.fillStyle="white",this.context.fill(new Path2D("M20 4.8C17.5373 4.8 15.1754 5.80089 13.434 7.58249C11.6926 9.36408 10.7143 11.7804 10.7143 14.3V25.7C10.7143 28.2196 11.6926 30.6359 13.434 32.4175C15.1754 34.1991 17.5373 35.2 20 35.2C22.4627 35.2 24.8246 34.1991 26.566 32.4175C28.3074 30.6359 29.2857 28.2196 29.2857 25.7V14.3C29.2857 11.7804 28.3074 9.36408 26.566 7.58249C24.8246 5.80089 22.4627 4.8 20 4.8ZM20 1C23.4478 1 26.7544 2.40125 29.1924 4.89548C31.6304 7.38971 33 10.7726 33 14.3V25.7C33 29.2274 31.6304 32.6103 29.1924 35.1045C26.7544 37.5988 23.4478 39 20 39C16.5522 39 13.2456 37.5988 10.8076 35.1045C8.36964 32.6103 7 29.2274 7 25.7V14.3C7 10.7726 8.36964 7.38971 10.8076 4.89548C13.2456 2.40125 16.5522 1 20 1V1Z")),this.context.fill(new Path2D("M18 9H22V16H18V9Z")),this.context.restore())},n}(Xi),ro=function(e){function n(n,i,o,r,a,s){void 0===n&&(n=[0,0]),void 0===i&&(i=[50,50]),void 0===o&&(o=1),void 0===r&&(r=!0),void 0===a&&(a="#F2063F"),void 0===s&&(s="");var c=e.call(this,n,i,o,r,new Sn(t.MouseButtonType.ButtonRight,!0).dumps(),new Sn(t.MouseButtonType.ButtonRight,!1).dumps(),void 0,void 0,void 0,s)||this;return c.themeColor=a,c}return i(n,e),n.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):(e.prototype.drawTray.call(this),this.context.save(),io(this.canvas,40,40),this.context.fillStyle=this.themeColor,this.context.fill(new Path2D("M20 19V4H25.5L31 11.5V19H20Z")),this.context.fillStyle="white",this.context.fill(new Path2D("M20 4.8C17.5373 4.8 15.1754 5.80089 13.434 7.58249C11.6926 9.36408 10.7143 11.7804 10.7143 14.3V25.7C10.7143 28.2196 11.6926 30.6359 13.434 32.4175C15.1754 34.1991 17.5373 35.2 20 35.2C22.4627 35.2 24.8246 34.1991 26.566 32.4175C28.3074 30.6359 29.2857 28.2196 29.2857 25.7V14.3C29.2857 11.7804 28.3074 9.36408 26.566 7.58249C24.8246 5.80089 22.4627 4.8 20 4.8ZM20 1C23.4478 1 26.7544 2.40125 29.1924 4.89548C31.6304 7.38971 33 10.7726 33 14.3V25.7C33 29.2274 31.6304 32.6103 29.1924 35.1045C26.7544 37.5988 23.4478 39 20 39C16.5522 39 13.2456 37.5988 10.8076 35.1045C8.36964 32.6103 7 29.2274 7 25.7V14.3C7 10.7726 8.36964 7.38971 10.8076 4.89548C13.2456 2.40125 16.5522 1 20 1Z")),this.context.fill(new Path2D("M18 9H22V16H18V9Z")),this.context.restore())},n}(Xi),ao=function(t){function e(e,n,i,o,r,a){void 0===e&&(e=[0,0]),void 0===n&&(n=[50,50]),void 0===i&&(i=1),void 0===o&&(o=!0),void 0===r&&(r="#F2063F"),void 0===a&&(a="");var s=t.call(this,e,n,i,o,new On(1,!1).dumps(),void 0,void 0,void 0,void 0,a)||this;return s.themeColor=r,s}return i(e,t),e.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):(t.prototype.drawTray.call(this),this.context.save(),io(this.canvas,40,40),this.context.fillStyle=this.themeColor,this.context.fill(new Path2D("M20 21L25 15L22.2222 15L22.2222 9L17.7778 9L17.7778 15L15 15L20 21Z")),this.context.fillStyle="white",this.context.fill(new Path2D("M20 4.8C17.5373 4.8 15.1754 5.80089 13.434 7.58249C11.6926 9.36408 10.7143 11.7804 10.7143 14.3V25.7C10.7143 28.2196 11.6926 30.6359 13.434 32.4175C15.1754 34.1991 17.5373 35.2 20 35.2C22.4627 35.2 24.8246 34.1991 26.566 32.4175C28.3074 30.6359 29.2857 28.2196 29.2857 25.7V14.3C29.2857 11.7804 28.3074 9.36408 26.566 7.58249C24.8246 5.80089 22.4627 4.8 20 4.8ZM20 1C23.4478 1 26.7544 2.40125 29.1924 4.89548C31.6304 7.38971 33 10.7726 33 14.3V25.7C33 29.2274 31.6304 32.6103 29.1924 35.1045C26.7544 37.5988 23.4478 39 20 39C16.5522 39 13.2456 37.5988 10.8076 35.1045C8.36964 32.6103 7 29.2274 7 25.7V14.3C7 10.7726 8.36964 7.38971 10.8076 4.89548C13.2456 2.40125 16.5522 1 20 1Z")),this.context.restore())},e}(Xi),so=function(t){function e(e,n,i,o,r,a){void 0===e&&(e=[0,0]),void 0===n&&(n=[50,50]),void 0===i&&(i=1),void 0===o&&(o=!0),void 0===r&&(r="#F2063F"),void 0===a&&(a="");var s=t.call(this,e,n,i,o,new On(1,!0).dumps(),void 0,void 0,void 0,void 0,a)||this;return s.themeColor=r,s}return i(e,t),e.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):(t.prototype.drawTray.call(this),this.context.save(),io(this.canvas,40,40),this.context.fillStyle=this.themeColor,this.context.fill(new Path2D("M20 9L15 15L17.7778 15L17.7778 21L22.2222 21L22.2222 15L25 15L20 9Z")),this.context.fillStyle="white",this.context.fill(new Path2D("M20 4.8C17.5373 4.8 15.1754 5.80089 13.434 7.58249C11.6926 9.36408 10.7143 11.7804 10.7143 14.3V25.7C10.7143 28.2196 11.6926 30.6359 13.434 32.4175C15.1754 34.1991 17.5373 35.2 20 35.2C22.4627 35.2 24.8246 34.1991 26.566 32.4175C28.3074 30.6359 29.2857 28.2196 29.2857 25.7V14.3C29.2857 11.7804 28.3074 9.36408 26.566 7.58249C24.8246 5.80089 22.4627 4.8 20 4.8ZM20 1C23.4478 1 26.7544 2.40125 29.1924 4.89548C31.6304 7.38971 33 10.7726 33 14.3V25.7C33 29.2274 31.6304 32.6103 29.1924 35.1045C26.7544 37.5988 23.4478 39 20 39C16.5522 39 13.2456 37.5988 10.8076 35.1045C8.36964 32.6103 7 29.2274 7 25.7V14.3C7 10.7726 8.36964 7.38971 10.8076 4.89548C13.2456 2.40125 16.5522 1 20 1Z")),this.context.restore())},e}(Xi),co=function(e){function n(n,i,o,r,a,s){void 0===n&&(n=[0,0]),void 0===i&&(i=[50,50]),void 0===o&&(o=1),void 0===r&&(r=!0),void 0===a&&(a="#F2063F"),void 0===s&&(s="");var c=e.call(this,n,i,o,r,new Sn(t.MouseButtonType.ButtonMiddle,!0).dumps(),new Sn(t.MouseButtonType.ButtonMiddle,!1).dumps(),void 0,void 0,void 0,s)||this;return c.themeColor=a,c}return i(n,e),n.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):(e.prototype.drawTray.call(this),this.context.save(),io(this.canvas,40,40),this.context.fillStyle=this.themeColor,this.context.fill(new Path2D("M17 8H23V18H17V8Z")),this.context.fillStyle="white",this.context.fill(new Path2D("M20 4.8C17.5373 4.8 15.1754 5.80089 13.434 7.58249C11.6926 9.36408 10.7143 11.7804 10.7143 14.3V25.7C10.7143 28.2196 11.6926 30.6359 13.434 32.4175C15.1754 34.1991 17.5373 35.2 20 35.2C22.4627 35.2 24.8246 34.1991 26.566 32.4175C28.3074 30.6359 29.2857 28.2196 29.2857 25.7V14.3C29.2857 11.7804 28.3074 9.36408 26.566 7.58249C24.8246 5.80089 22.4627 4.8 20 4.8ZM20 1C23.4478 1 26.7544 2.40125 29.1924 4.89548C31.6304 7.38971 33 10.7726 33 14.3V25.7C33 29.2274 31.6304 32.6103 29.1924 35.1045C26.7544 37.5988 23.4478 39 20 39C16.5522 39 13.2456 37.5988 10.8076 35.1045C8.36964 32.6103 7 29.2274 7 25.7V14.3C7 10.7726 8.36964 7.38971 10.8076 4.89548C13.2456 2.40125 16.5522 1 20 1Z")),this.context.restore())},n}(Xi),uo=function(t){function e(e,n,i,o,r,a){void 0===e&&(e=[0,0]),void 0===n&&(n=[50,50]),void 0===i&&(i=1),void 0===o&&(o=!0),void 0===r&&(r="#F2063F"),void 0===a&&(a="");var s=t.call(this,e,n,i,o,new On(1,!0).dumps(),new On(1,!1).dumps(),100,a)||this;return s.themeColor=r,s}return i(e,t),e.prototype.draw=function(){this.clear(),this.img?this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height):(t.prototype.drawTray.call(this),this.context.save(),io(this.canvas,40,40),this.context.fillStyle="white",this.context.fill(new Path2D("M20 4.8C17.5373 4.8 15.1754 5.80089 13.434 7.58249C11.6926 9.36408 10.7143 11.7804 10.7143 14.3V25.7C10.7143 28.2196 11.6926 30.6359 13.434 32.4175C15.1754 34.1991 17.5373 35.2 20 35.2C22.4627 35.2 24.8246 34.1991 26.566 32.4175C28.3074 30.6359 29.2857 28.2196 29.2857 25.7V14.3C29.2857 11.7804 28.3074 9.36408 26.566 7.58249C24.8246 5.80089 22.4627 4.8 20 4.8ZM20 1C23.4478 1 26.7544 2.40125 29.1924 4.89548C31.6304 7.38971 33 10.7726 33 14.3V25.7C33 29.2274 31.6304 32.6103 29.1924 35.1045C26.7544 37.5988 23.4478 39 20 39C16.5522 39 13.2456 37.5988 10.8076 35.1045C8.36964 32.6103 7 29.2274 7 25.7V14.3C7 10.7726 8.36964 7.38971 10.8076 4.89548C13.2456 2.40125 16.5522 1 20 1Z")),this.context.fillStyle=this.themeColor,this.context.fill(new Path2D("M20 9L15 15L17.7778 15L17.7778 19L22.2222 19L22.2222 15L25 15L20 9Z")),this.context.fill(new Path2D("M20 31L25 25L22.2222 25L22.2222 21L17.7778 21L17.7778 25L15 25L20 31Z")),this.context.restore())},e}(Hi),ho=2*Math.PI,lo=function(t){function e(e,n,i,o,r,a){void 0===e&&(e=[0,0]),void 0===n&&(n=[254,254]),void 0===i&&(i=1),void 0===o&&(o=!0),void 0===r&&(r=[39,37,40,38]),void 0===a&&(a="");var s=t.call(this,e,n,i,o)||this;return s.keys=r,s.iconScaleRatio=0,s.radius=0,s.deathZoneRadius=2,s.pressed=!0,s.axis={x:0,y:0},s.keyState=0,s.handleDown=function(t){t.preventDefault(),s.pressed=!0,s.move(t.clientX,t.clientY),s.handleChange()},s.handleUp=function(t){t.preventDefault(),s.pressed=!1,s.axis.x=s.axis.y=0,s.handleChange()},s.handleMove=function(t){t.preventDefault(),s.pressed&&t.target===s.canvas&&(s.move(t.clientX,t.clientY),s.handleChange())},a&&(s.img=new Image,s.img.onerror=function(){return s.img=void 0},s.img.src=a),s.resize(),s.canvas.addEventListener("pointerdown",s.handleDown),s.canvas.addEventListener("pointermove",s.handleMove),s.canvas.addEventListener("pointerup",s.handleUp),s.canvas.addEventListener("pointercancel",s.handleUp),s.canvas.addEventListener("contextmenu",(function(t){return t.preventDefault()})),s}return i(e,t),e.prototype.resize=function(){this.radius=this.dimension[0]*this.dpr/2,this.iconScaleRatio=this.radius/100*2,this.deathZoneRadius=20*this.radius/100},e.prototype.move=function(t,e){var n=this.canvas.getBoundingClientRect(),i=n.left,o=n.top,r=n.right,a=(this.match?t-i:e-o)*this.dpr,s=(this.match?e-o:r-t)*this.dpr,c=a-this.centerX,u=s-this.centerY,d=Math.atan2(u,c),h=Math.min(this.radius,Math.hypot(c,u));a=h*Math.cos(d)+this.radius,s=h*Math.sin(d)+this.radius;var l=h<this.deathZoneRadius?0:this.radius/(this.radius-this.deathZoneRadius)*(h-this.deathZoneRadius);this.axis.x=parseFloat((l*Math.cos(d)/this.radius).toFixed(4)),this.axis.y=parseFloat((l*Math.sin(d)/this.radius).toFixed(4))},e.prototype.handleChange=function(){var t=this;if(this.axis.x+this.axis.y===0)return rn(4).forEach((function(e){return t.keyState>>e&1&&t.fireEvent(t.keys[e],!1)})),void(this.keyState=0);var n=180*Math.atan2(this.axis.y,this.axis.x)/Math.PI,i=0;(n=n<=0?360+n:n)>=0&&n<23||n>=338&&n<=360?i=e.Right:n>23&&n<=68?i=e.DownRight:n>68&&n<=113?i=e.Down:n>113&&n<=158?i=e.DownLeft:n>158&&n<=203?i=e.Left:n>203&&n<=248?i=e.UpLeft:n>248&&n<=293?i=e.Up:n>293&&n<=338&&(i=e.UpRight);var o=i^this.keyState;o>0&&rn(4).forEach((function(e){return o>>e&1&&t.fireEvent(t.keys[e],!(t.keyState>>e&1))})),this.keyState=i},e.prototype.fireEvent=function(t,e){var n;null===(n=this.onInteract)||void 0===n||n.call(this,new Mn(t,!1,!1,!1,!1,!1,!1,e).dumps())},e.prototype.setDimension=function(e){t.prototype.setDimension.call(this,e),this.resize(),this.draw()},e.prototype.draw=function(){if(this.clear(),this.img)this.context.drawImage(this.img,0,0,this.canvas.width,this.canvas.height);else{this.context.strokeStyle="rgba(255, 255, 255, 0.4)",this.context.fillStyle="rgba(9, 21, 40, 0.6)",this.context.lineWidth=2,this.context.beginPath(),this.context.arc(this.centerX,this.centerY,this.radius-1,0,ho),this.context.fill(),this.context.stroke(),this.context.save(),io(this.canvas,66,66,1),this.context.clip(new Path2D("M43.6897 4C43.6897 2.89543 42.7942 2 41.6897 2H24.3103C23.2058 2 22.3103 2.89543 22.3103 4V22.3103H4C2.89543 22.3103 2 23.2058 2 24.3103V41.6897C2 42.7942 2.89543 43.6897 4 43.6897H22.3103V62C22.3103 63.1046 23.2058 64 24.3103 64H41.6897C42.7942 64 43.6897 63.1046 43.6897 62V43.6897H62C63.1046 43.6897 64 42.7942 64 41.6897V24.3103C64 23.2058 63.1046 22.3103 62 22.3103H43.6897V4Z"),"evenodd"),this.context.fillStyle="rgba(255, 255, 255, 0.4)",this.context.fill(new Path2D("M22.3103 22.3103V24.3103H24.3103V22.3103H22.3103ZM22.3103 43.6897H24.3103V41.6897H22.3103V43.6897ZM43.6897 43.6897V41.6897H41.6897V43.6897H43.6897ZM43.6897 22.3103H41.6897V24.3103H43.6897V22.3103ZM41.6897 4H41.6897H45.6897C45.6897 1.79087 43.8988 0 41.6897 0V4ZM24.3103 4H41.6897V0H24.3103V4ZM24.3103 4V4V0C22.1012 0 20.3103 1.79086 20.3103 4H24.3103ZM24.3103 22.3103V4H20.3103V22.3103H24.3103ZM4 24.3103H22.3103V20.3103H4V24.3103ZM4 24.3103V24.3103V20.3103C1.79086 20.3103 0 22.1012 0 24.3103H4ZM4 41.6897V24.3103H0V41.6897H4ZM4 41.6897H4H0C0 43.8988 1.79086 45.6897 4 45.6897V41.6897ZM22.3103 41.6897H4V45.6897H22.3103V41.6897ZM24.3103 62V43.6897H20.3103V62H24.3103ZM24.3103 62H24.3103H20.3103C20.3103 64.2091 22.1012 66 24.3103 66V62ZM41.6897 62H24.3103V66H41.6897V62ZM41.6897 62V66C43.8988 66 45.6897 64.2091 45.6897 62H41.6897ZM41.6897 43.6897V62H45.6897V43.6897H41.6897ZM62 41.6897H43.6897V45.6897H62V41.6897ZM62 41.6897V45.6897C64.2091 45.6897 66 43.8988 66 41.6897H62ZM62 24.3103V41.6897H66V24.3103H62ZM62 24.3103H66C66 22.1012 64.2091 20.3103 62 20.3103V24.3103ZM43.6897 24.3103H62V20.3103H43.6897V24.3103ZM41.6897 4V22.3103H45.6897V4H41.6897Z")),this.context.restore();var t=-25,e=new Path2D("M5.4 0.560328L5.4 1.28291L5.4 2.45367L5.4 3.84396L5.4 5.27083L5.4 6.53306L5.4 7.42943C5.4 7.57577 5.36505 7.69468 5.29514 7.78614C5.22523 7.87761 5.13626 7.94011 5.02822 7.97365C4.92018 8.00719 4.80102 8.00871 4.67074 7.97822C4.54046 7.94773 4.41177 7.88066 4.28466 7.777C4.03046 7.55138 3.76354 7.31357 3.48391 7.06356C3.20428 6.81355 2.92148 6.55745 2.6355 6.29525L1.77755 5.52693C1.49156 5.26473 1.21511 5.01472 0.948195 4.77691C0.827447 4.66715 0.738474 4.53605 0.681278 4.38361C0.624081 4.23116 0.597072 4.07415 0.600249 3.91256C0.603427 3.75097 0.639969 3.59243 0.709876 3.43693C0.779783 3.28144 0.878288 3.14577 1.00539 3.02991C1.46296 2.60917 1.95867 2.17013 2.4925 1.7128C3.02634 1.25547 3.59831 0.776798 4.2084 0.276783C4.35457 0.160926 4.49915 0.0816562 4.64214 0.0389721C4.78513 -0.00371207 4.91224 -0.0113342 5.02345 0.0161056C5.13467 0.0435454 5.22523 0.104523 5.29514 0.199037C5.36505 0.293552 5.4 0.413983 5.4 0.560328V0.560328Z");this.context.save(),this.context.fillStyle="rgba(218, 221, 225, 1)",this.context.translate(this.centerX,this.centerY),this.context.scale(this.iconScaleRatio,this.iconScaleRatio),this.context.save(),this.context.translate(t,-4),this.context.fill(e),this.context.restore(),this.context.save(),this.context.rotate(.5*Math.PI),this.context.translate(t,-4),this.context.fill(e),this.context.restore(),this.context.save(),this.context.rotate(Math.PI),this.context.translate(t,-4),this.context.fill(e),this.context.restore(),this.context.save(),this.context.rotate(-.5*Math.PI),this.context.translate(t,-4),this.context.fill(e),this.context.restore(),this.context.restore()}},e.Up=8,e.Down=4,e.Left=2,e.Right=1,e.UpRight=e.Up|e.Right,e.UpLeft=e.Up|e.Left,e.DownLeft=e.Down|e.Left,e.DownRight=e.Down|e.Right,e}(Ni),po=function(){function t(){var t=this;this.latency=0,this.averageJitterBufferDelay=0,this.bytesReceivedPerMillisecond=0,this.headerBytesReceivedPerMillisecond=0,this.jitterBufferDelay=0,this.jitterBufferEmittedCount=0,this.jitterBufferTargetDelay=0,this.jitterBufferMinimumDelay=0,this.totalProcessingDelay=0,this.packetsLost=0,this.packetsReceived=0,this.framesReceived=0,this.framesDecoded=0,this.keyFramesDecoded=0,this.framesDropped=0,this.framesPerSecond=0,this.keyframesDecodedDetla=0,this.framesReceivedDetla=0,this.framesDroppedDetla=0,this.rtt=0,this.headerBytesReceived=0,this.bytesReceived=0,this.handleLatency=function(e){return t.latency=e}}return Object.defineProperty(t.prototype,"bitrate",{get:function(){return 8*(this.bytesReceivedPerMillisecond+this.headerBytesReceivedPerMillisecond)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"packetLossRate",{get:function(){return this.packetsReceived?Math.max(this.packetsLost/(this.packetsLost+this.packetsReceived),0):0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return!!this.statSub&&!!this.echoSub&&!!this.dispose},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasOffered",{get:function(){return!!this.connection},enumerable:!1,configurable:!0}),t.prototype.offer=function(t){this.connection=t,this.running&&this.scan()},t.prototype.scan=function(){var e,n=this;if(!this.connection)throw new Error("gather statistics before provide connection");var i=this.connection;null===(e=this.statSub)||void 0===e||e.unsubscribe(),this.echoSub&&(this.echoSub.unsubscribe(),this.connection.event.echo.off(this.handleLatency)),this.dispose=this.connection.event.echo.on(this.handleLatency).dispose,this.echoSub=Ne(t.gap).subscribe((function(){return"open"===i.dc.readyState&&i.echo()})),this.statSub=Ne(t.gap).pipe(Pe((function(){return xe(i.pc.getStats())})),Je((function(t){var e,i;n.rtt=1e3*(null!==(i=null===(e=u([],c(t.values()),!1).find((function(t){return"candidate-pair"===t.type})))||void 0===e?void 0:e.currentRoundTripTime)&&void 0!==i?i:0)})),Se((function(t){return u([],c(t.values()),!1).find((function(t){return"inbound-rtp"===t.type&&"video"===t.kind}))})),ze(),Se((function(t){var e,n,i,o,r,a,s,u,d,h,l,p,f,v,m,y,g,E=c(t,2),C=E[0],w=E[1];if(C&&w){var b=w.timestamp-C.timestamp,D=~~(1e3*(w.jitterBufferDelay-C.jitterBufferDelay)/(w.jitterBufferEmittedCount-C.jitterBufferEmittedCount));return{bytesReceivedPerMillisecond:~~((w.bytesReceived-C.bytesReceived)/b),headerBytesReceivedPerMillisecond:~~((w.headerBytesReceived-C.headerBytesReceived)/b),averageJitterBufferDelay:D,packetsLost:(w.packetsLost||0)-(C.packetsLost||0),packetsReceived:(w.packetsReceived||0)-(C.packetsReceived||0),framesReceived:null!==(e=w.framesReceived)&&void 0!==e?e:0,framesDecoded:null!==(n=w.framesDecoded)&&void 0!==n?n:0,keyFramesDecoded:null!==(i=w.keyFramesDecoded)&&void 0!==i?i:0,keyframesDecodedDetla:(null!==(o=w.keyFramesDecoded)&&void 0!==o?o:0)-(null!==(r=C.keyFramesDecoded)&&void 0!==r?r:0),framesReceivedDetla:(null!==(a=w.framesReceived)&&void 0!==a?a:0)-(null!==(s=C.framesReceived)&&void 0!==s?s:0),framesDroppedDetla:(null!==(u=w.framesReceived)&&void 0!==u?u:0)-(null!==(d=w.framesDecoded)&&void 0!==d?d:0),framesDropped:null!==(h=w.framesDropped)&&void 0!==h?h:0,framesPerSecond:null!==(l=w.framesPerSecond)&&void 0!==l?l:0,jitterBufferDelay:null!==(p=w.jitterBufferDelay)&&void 0!==p?p:0,jitterBufferEmittedCount:null!==(f=w.jitterBufferEmittedCount)&&void 0!==f?f:0,jitterBufferTargetDelay:null!==(v=w.jitterBufferTargetDelay)&&void 0!==v?v:0,jitterBufferMinimumDelay:null!==(m=w.jitterBufferMinimumDelay)&&void 0!==m?m:0,headerBytesReceived:null!==(y=w.headerBytesReceived)&&void 0!==y?y:0,bytesReceived:null!==(g=w.bytesReceived)&&void 0!==g?g:0}}return{bytesReceivedPerMillisecond:0,headerBytesReceivedPerMillisecond:0,averageJitterBufferDelay:0,packetsLost:0,packetsReceived:0,framesReceived:0,framesDecoded:0,keyFramesDecoded:0,framesDropped:0,framesPerSecond:0,keyframesDecodedDetla:0,framesReceivedDetla:0,framesDroppedDetla:0,jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferTargetDelay:0,jitterBufferMinimumDelay:0,totalProcessingDelay:0,headerBytesReceived:0,bytesReceived:0}}))).subscribe((function(t){var e=t.headerBytesReceivedPerMillisecond,i=t.bytesReceivedPerMillisecond,o=t.averageJitterBufferDelay,r=t.packetsLost,a=t.packetsReceived,s=t.framesReceived,c=t.framesDecoded,u=t.keyFramesDecoded,d=t.framesDropped,h=t.framesPerSecond,l=t.jitterBufferDelay,p=t.jitterBufferEmittedCount,f=t.jitterBufferTargetDelay,v=t.jitterBufferMinimumDelay,m=t.keyframesDecodedDetla,y=t.framesDroppedDetla,g=t.framesReceivedDetla,E=t.headerBytesReceived,C=t.bytesReceived;n.bytesReceivedPerMillisecond=i,n.headerBytesReceivedPerMillisecond=e,n.packetsLost=r,n.packetsReceived=a,n.framesReceived=s,n.framesDecoded=c,n.keyFramesDecoded=u,n.framesDropped=d,n.framesPerSecond=h,n.averageJitterBufferDelay=o,n.keyframesDecodedDetla=m,n.framesDroppedDetla=y,n.framesReceivedDetla=g,n.jitterBufferDelay=l,n.jitterBufferEmittedCount=p,n.jitterBufferMinimumDelay=v,n.jitterBufferTargetDelay=f,n.headerBytesReceived=E,n.bytesReceived=C}))},t.prototype.report=function(){var t=this,e=t.latency,n=t.packetLossRate,i=t.bitrate,o=t.averageJitterBufferDelay,r=t.framesReceived,a=t.framesDecoded,s=t.keyFramesDecoded,c=t.framesDropped;return{fps:t.framesPerSecond,latency:e,bitrate:i,packetLossRate:n,averageJitterBufferDelay:o,framesReceived:r,framesDecoded:a,keyFramesDecoded:s,framesDropped:c,packetsLost:t.packetsLost,packetsReceived:t.packetsReceived,jitterBufferDelay:t.jitterBufferDelay,jitterBufferEmittedCount:t.jitterBufferEmittedCount,jitterBufferMinimumDelay:t.jitterBufferMinimumDelay,jitterBufferTargetDelay:t.jitterBufferTargetDelay,totalProcessingDelay:t.totalProcessingDelay,rtt:t.rtt,keyframesDecodedDetla:t.keyframesDecodedDetla,framesDroppedDetla:t.framesDroppedDetla,framesReceivedDetla:t.framesReceivedDetla,headerBytesReceived:t.headerBytesReceived,bytesReceived:t.bytesReceived}},t.prototype.toggle=function(){this.running?this.stop():this.scan()},t.prototype.stop=function(){var t,e,n;this.bytesReceivedPerMillisecond=0,this.headerBytesReceivedPerMillisecond=0,this.averageJitterBufferDelay=0,this.latency=0,this.packetsLost=0,this.packetsReceived=0,this.framesReceived=0,this.framesDecoded=0,this.keyFramesDecoded=0,this.framesDropped=0,this.framesPerSecond=0,null===(t=this.statSub)||void 0===t||t.unsubscribe(),this.statSub=void 0,null===(e=this.echoSub)||void 0===e||e.unsubscribe(),this.echoSub=void 0,null===(n=this.dispose)||void 0===n||n.call(this),this.dispose=void 0},t.gap=1e3,t}(),fo=function(){function t(t){void 0===t&&(t=function(){}),this.encoder=new AudioEncoder({output:t,error:function(t){return on.warn(t)}}),this.encoder.configure({codec:"opus",numberOfChannels:1,sampleRate:48e3,bitrate:16e3})}return t.isSupport=function(){return!("undefined"==typeof AudioEncoder||"undefined"==typeof MediaStreamTrackProcessor)},t.prototype.start=function(){return r(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){return[2,navigator.mediaDevices.getUserMedia({audio:{sampleRate:48e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0},video:!1}).then((function(e){return t.feed(e.getAudioTracks()[0])}))]}))}))},t.prototype.feed=function(t){return r(this,void 0,void 0,(function(){var e,n,i,o;return a(this,(function(r){switch(r.label){case 0:this.stop(),this.currentTrack=t,e=new MediaStreamTrackProcessor({track:t}),n=e.readable.getReader(),r.label=1;case 1:return[4,n.read()];case 2:return(i=r.sent()).done?[3,3]:(o=i.value,this.encoder.encodeQueueSize>2||this.encoder.encode(o),o.close(),[3,1]);case 3:return[2]}}))}))},t.prototype.stop=function(){var t;null===(t=this.currentTrack)||void 0===t||t.stop()},t}(),vo=function(e){function n(i,o,r){var a=e.call(this)||this;a.player=i,a.runningState=o,a.onEvent=r,a.timerID=NaN,a.pattern="default",a.evCache=[],a.cursorPosition={x:0,y:0},a.offsetPosition={x:0,y:0},a.mode="direct",a.handleTouchStart=function(t){t.preventDefault(),a.ensureTimerClear(),a.timerID=window.setTimeout(a.handleLongTouch,300),a.evCache.push(t);var e={x:t.offsetX,y:t.offsetY};a.offsetPosition=e,"direct"===a.mode&&(a.cursorPosition=e,a.applyCursorStyle())},a.handleTouchMove=function(t){t.preventDefault(),a.ensureTimerClear(),"drag"!==a.pattern&&(a.pattern="move");var e={x:t.offsetX,y:t.offsetY};if("direct"===a.mode)return a.cursorPosition=n.constraintsBoundary(a.mask,e),void a.applyCursorStyle(t.movementX,t.movementY);a.cursorPosition=n.constraintsBoundary(a.mask,{x:a.cursorPosition.x+(e.x-a.offsetPosition.x)*a.runningState.pointerSpeed,y:a.cursorPosition.y+(e.y-a.offsetPosition.y)*a.runningState.pointerSpeed}),a.applyCursorStyle(),a.offsetPosition=e},a.handleLongTouch=function(){a.pattern="drag",a.onEvent(new Sn(t.MouseButtonType.ButtonLeft,!0))},a.handleTouchEnd=function(e){e.preventDefault(),a.ensureTimerClear(),on.info("[Trackpad] pointer end with pattern: ".concat(a.pattern)),"drag"===a.pattern?a.onEvent(new Sn(t.MouseButtonType.ButtonLeft,!1)):2===a.evCache.length&&(a.onEvent(new Sn(t.MouseButtonType.ButtonRight,!0)),setTimeout((function(){return a.onEvent(new Sn(t.MouseButtonType.ButtonRight,!1))}),33)),a.evCache.length=0,a.pattern="default"},a.handleClick=function(e){e.preventDefault(),a.onEvent(new Sn(t.MouseButtonType.ButtonLeft,!0)),setTimeout((function(){return a.onEvent(new Sn(t.MouseButtonType.ButtonLeft,!1))}),33)},a.root.id="trackpad",a.mask=document.createElement("div"),a.mask.style.cssText="\n      position: absolute;\n      width: 100%;\n      height: 100%;\n      overflow: hidden;\n      display: none;\n      touch-action: none;\n      user-select: none;\n      -webkit-user-select: none;\n    ",a.cursor=document.createElement("canvas"),a.cursor.style.cssText="\n      left: 0;\n      top: 0;\n      position: absolute;\n      transform: scale(1);\n      transform-origin: left top;\n      pointer-events: none;\n      user-select: none;\n      -webkit-user-select: none;\n    ",a.mask.appendChild(a.cursor),a.mask.addEventListener("pointermove",a.handleTouchMove),a.mask.addEventListener("pointerdown",a.handleTouchStart),a.mask.addEventListener("pointerup",a.handleTouchEnd),a.mask.addEventListener("pointercancel",a.handleTouchEnd),a.mask.addEventListener("click",a.handleClick),a.mask.addEventListener("resize",(function(){return a.currentCursor&&(a.cursor.style.transform="scale(".concat(a.player.aspectRatio,") translate(-").concat(a.currentCursor.x,"px, -").concat(a.currentCursor.y,"px)"))}));var s=function(){return a.player.video.focus()};return a.mask.addEventListener("touchstart",s,{passive:!0}),a.mask.addEventListener("mouseenter",s),a.mask.addEventListener("click",s),a.shadowRoot.appendChild(a.mask),a}return i(n,e),n.constraintsBoundary=function(t,e){var n=e.x,i=e.y;return{x:Math.min(Math.max(0,n),t.offsetWidth),y:Math.min(Math.max(0,i),t.offsetHeight)}},Object.defineProperty(n.prototype,"visible",{get:function(){return"none"!==this.mask.style.display},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"originOffsetLeft",{get:function(){return this.cursorPosition.x},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"originOffsetTop",{get:function(){return this.cursorPosition.y},enumerable:!1,configurable:!0}),n.prototype.applyCursorStyle=function(e,n){this.cursor.style.left=this.cursorPosition.x+"px",this.cursor.style.top=this.cursorPosition.y+"px";var i=this.runningState.mouseNormalizeType===t.EventType.MouseMoveStandardization,o=this.player.video,r=o.videoHeight,a=o.videoWidth,s=o.clientHeight,c=o.clientWidth,u=new xn(this.cursorPosition.x*(i?a:65535)/c,this.cursorPosition.y*(i?r:65535)/s,e?e*(i?a:65535)/c:0,n?n*(i?r:65535)/s:0,this.runningState.mouseMoveType,this.runningState.mouseNormalizeType);this.onEvent(u)},n.prototype.ensureTimerClear=function(){this.timerID&&(window.clearTimeout(this.timerID),this.timerID=NaN)},n.prototype.enable=function(){this.mask.style.display="block",this.currentCursor&&(this.cursor.style.transform="scale(".concat(this.player.aspectRatio,") translate(-").concat(this.currentCursor.x,"px, -").concat(this.currentCursor.y,"px)"))},n.prototype.disable=function(){this.mask.style.display="none"},n.prototype.setCursorStyle=function(t){var e=this;this.currentCursor=t;var n=this.cursor.getContext("2d");if(t.show){var i=new Image;i.src=t.base64,i.onload=function(){n.clearRect(0,0,e.cursor.width,e.cursor.height),e.cursor.style.width=(t.width||32)+"px",e.cursor.style.height=(t.height||32)+"px",e.cursor.width=t.width||32,e.cursor.height=t.height||32,n.drawImage(i,0,0)},this.cursor.style.transform="scale(".concat(this.player.aspectRatio,") translate(-").concat(t.x,"px, -").concat(t.y,"px)"),this.cursor.style.display="block"}else this.cursor.style.display="none"},n.prototype.destory=function(){this.mask.remove()},n}(ki),mo=function(){function t(t,e,n){void 0===n&&(n="#ff0000");var i,o=this;this.onEvent=e,this.timeStamp=0,this.handleComfirm=function(){var t;null===(t=o.onEvent)||void 0===t||t.call(o,new Rn(o.inputeEl.value).dumps()),o.inputeEl.value="",o.deactive()};var r=document.createElement("textarea");r.style.cssText="\n      flex: 1;\n      padding: 0;\n      border: none;\n      box-sizing: border-box;\n      outline: none;\n      resize: none;\n    ",r.addEventListener("blur",(function(){performance.now()-o.timeStamp<30&&o.inputeEl.focus()})),r.addEventListener("focus",(function(){o.timeStamp=performance.now()})),r.addEventListener("keydown",(function(t){var e;8!==t.keyCode||r.value||null===(e=o.onEvent)||void 0===e||e.call(o,new Mn(8,!1,!1,!1,!1,!1,!1,!0).dumps())})),r.addEventListener("keyup",(function(t){var e;8!==t.keyCode||r.value||null===(e=o.onEvent)||void 0===e||e.call(o,new Mn(8,!1,!1,!1,!1,!1,!1,!1).dumps())})),this.inputeEl=r;var a=document.createElement("div");a.innerText="OK",a.style.cssText="\n      width: 20%;\n      color: white;\n      border-radius: 10px;\n      background-color: ".concat(n,";\n      box-sizing: border-box;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n\t\t"),a.addEventListener("click",this.handleComfirm);var s=document.createElement("div");s.style.cssText="\n      position: absolute;\n      width: 100%;\n      height: 100%;\n      top: 0;\n      left: 0;\n      display: none;\n      padding: 1em;\n      background-color: white;\n      box-sizing: border-box;\n      overflow: hidden;\n    ",s.appendChild(r),s.appendChild(a),t.appendChild(s),this.operationBar=s,null===(i=window.visualViewport)||void 0===i||i.addEventListener("resize",(function(){o.operationBar.style.width="".concat(visualViewport.width,"px"),o.operationBar.style.height="".concat(visualViewport.height,"px")}))}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.inputeEl===document.activeElement},enumerable:!1,configurable:!0}),t.prototype.active=function(){this.operationBar.style.display="flex",this.inputeEl.focus()},t.prototype.deactive=function(){this.operationBar.style.display="none",this.inputeEl.blur()},t}(),yo=500,go=function(e){function n(t,i,o,r,a,s,c){void 0===a&&(a="touch"),void 0===s&&(s=200),void 0===c&&(c=150);var u=e.call(this)||this;return u.hostElement=t,u.videoElement=i,u.runningState=o,u.onEvent=r,u.mode=a,u.width=s,u.height=c,u.pointerEventCache=[],u.touchEventCache=[],u.isMovepressDown=!1,u.ratio=1.4,u.timeStamp=0,u.movementX=0,u.movementY=0,u.prevClientX=0,u.prevClientY=0,u.prevDiffX=-1,u.prevDiffY=-1,u.cursorPercentX=0,u.cursorPercentY=0,u.positionOfPercentX=0,u.positionOfPercentY=0,u.sizeSnapshot={width:0,height:0},u.root.id="magnifier",u.canvas=n.createCanvasContainer(),u.zoomCorner=u.createZoomCorner(),u.moveCorner=u.createMoveCorner(),u.cursorCanvas=document.createElement("canvas"),u.videoElement.addEventListener("loadedmetadata",u.captureStream.bind(u)),u.setupHandleZoomEvent(),u.shadowRoot.append(u.canvas,u.zoomCorner,u.moveCorner),u}return i(n,e),Object.defineProperty(n.prototype,"dpr",{get:function(){return window.devicePixelRatio||1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"widthPercent",{get:function(){return this.width/this.videoElement.clientWidth},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"heightPercent",{get:function(){return this.height/this.videoElement.clientHeight},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"notShowPartWidth",{get:function(){return this.widthPercent*this.videoElement.videoWidth-this.widthPercent*this.videoElement.videoWidth/this.ratio},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"notShowPartHeight",{get:function(){return this.heightPercent*this.videoElement.videoHeight-this.heightPercent*this.videoElement.videoHeight/this.ratio},enumerable:!1,configurable:!0}),n.createCanvasContainer=function(){var t=document.createElement("canvas");return t.style.cssText="\n      position: absolute;\n      left: 50px;\n      top: 50px;\n      display: none;\n      border: ".concat(1,"px solid #fff;\n      box-shadow: 2px 0px 6px 3px rgba(0, 0, 0, 0.8);\n      touch-action: none;\n      z-index: 2;\n    "),t},n.prototype.createZoomCorner=function(){var t=document.createElement("div");return t.style.cssText="\n      width: ".concat(8,"px;\n      height: 0;\n      border: ").concat(8,"px solid #fff;\n      border-right-color: transparent;\n      border-bottom-color: transparent;\n      border-top-color: transparent;\n      transform-origin: center;\n      transform: rotateZ(45deg);\n      position: absolute;\n      display: none;\n      left: ").concat(50+this.width-4,"px;\n      top: ").concat(50+this.height,"px;\n      touch-action: none;\n      z-index: 3;\n    "),t},n.prototype.createMoveCorner=function(){var t=document.createElement("div");return t.innerText="+",t.style.cssText="\n      width: 20px;\n      height: 20px;\n      position: absolute;\n      display: none;\n      touch-action: none;\n      z-index: 3;\n      font-weight: 600;\n      color: #fff;\n      font-size: 20px;\n      left: ".concat(50+this.width-4,"px;\n      top: ").concat(46,"px;\n      line-height: 5px;\n      user-select: none;\n      -webkit-user-select: none;\n    "),t},n.prototype.setupHandleZoomEvent=function(){var t=this;this.canvas.addEventListener("pointerdown",this.pointerdown.bind(this)),this.canvas.addEventListener("pointerup",this.pointerup.bind(this)),this.zoomCorner.addEventListener("pointerdown",this.downZoomCorner.bind(this)),this.zoomCorner.addEventListener("pointermove",this.moveZoomCorner.bind(this)),this.moveCorner.addEventListener("pointerdown",this.dragdown.bind(this)),this.moveCorner.addEventListener("pointerup",(function(){return t.isMovepressDown=!1})),document.addEventListener("pointermove",this.pointermove.bind(this))},n.prototype.dragdown=function(t){this.isMovepressDown=!0,this.timeStamp=t.timeStamp},n.prototype.downZoomCorner=function(t){this.sizeSnapshot={width:this.width,height:this.height},this.prevClientX=t.clientX,this.prevClientY=t.clientY},n.prototype.moveZoomCorner=function(t){t.preventDefault(),this.updateSize(this.runningState.isOrientationMatch?this.width+t.movementX:this.sizeSnapshot.width+t.clientY-this.prevClientY,this.runningState.isOrientationMatch?this.height+t.movementY:this.sizeSnapshot.height-(t.clientX-this.prevClientX))},n.prototype.pointerdown=function(t){this.pointerEventCache.push(t),this.touchEventCache.push(t),this.timeStamp=t.timeStamp,this.prevClientX=this.runningState.isOrientationMatch?t.clientX:t.clientY,this.prevClientY=this.runningState.isOrientationMatch?t.clientY:t.clientX},n.prototype.pointermove=function(t){if(2===this.pointerEventCache.length){var e=this.pointerEventCache.findIndex((function(e){return e.pointerId===t.pointerId}));this.pointerEventCache[e]=t;var n=Math.abs(this.pointerEventCache[0].clientX-this.pointerEventCache[1].clientX),i=Math.abs(this.pointerEventCache[0].clientY-this.pointerEventCache[1].clientY);this.prevDiffX>0&&this.prevDiffY>0&&(n>this.prevDiffX&&i>this.prevDiffY&&this.updateRatio(this.ratio+.1),n<this.prevDiffX&&i<this.prevDiffY&&this.updateRatio(this.ratio-.1<1?1:this.ratio-.1)),this.prevDiffX=n,this.prevDiffY=i}else if(1===this.pointerEventCache.length&&t.timeStamp-this.timeStamp>100){var o=(this.runningState.isOrientationMatch?t.clientX:t.clientY)-this.prevClientX,r=(this.runningState.isOrientationMatch?t.clientY:t.clientX)-this.prevClientY,a=this.videoElement,s=a.videoWidth,c=a.videoHeight,u=a.clientWidth,d=a.clientHeight,h=s-this.width/u*s/this.ratio,l=c-this.height/d*c/this.ratio,p=this.positionOfPercentX*s+this.notShowPartWidth/2-this.movementX/yo*s,f=this.positionOfPercentY*c+this.notShowPartHeight/2-this.movementY/yo*c;(p>=0&&p<=h||p<0&&o<0||p>h&&o>0)&&(this.movementX+=o),(f>=0&&f<=l||f<0&&r<0||f>l&&r>0)&&(this.movementY+=r),this.prevClientX=this.runningState.isOrientationMatch?t.clientX:t.clientY,this.prevClientY=this.runningState.isOrientationMatch?t.clientY:t.clientX}if(this.isMovepressDown&&t.timeStamp&&this.canvas.clientWidth<this.hostElement.clientWidth&&this.canvas.clientHeight<this.hostElement.clientHeight){var v=this.videoElement.getBoundingClientRect(),m=v.left,y=v.top,g=this.videoElement,E=(u=g.clientWidth,d=g.clientHeight,this.runningState.isOrientationMatch?t.clientX-m-this.width:t.clientY-y-this.width),C=this.runningState.isOrientationMatch?t.clientY-y:d-(t.clientX-m);this.moveTo(E<0?0:this.width+E>u?u-this.width:E,C<0?0:this.height+C>d?d-this.height:C)}},n.prototype.pointerup=function(t){this.removeEvent(this.pointerEventCache,t),this.pointerEventCache.length<2&&(this.prevDiffX=-1,this.prevDiffY=-1),1===this.touchEventCache.length&&"touch"===this.mode&&t.timeStamp-this.timeStamp<100&&this.handleTouch(this.touchEventCache[0]),this.touchEventCache.length=0},n.prototype.handleTouch=function(e){var n,i,o,r=this.videoElement,a=r.clientWidth,s=r.clientHeight,c=r.videoWidth,u=r.videoHeight,d=e.offsetX,h=e.offsetY,l=d/this.width,p=h/this.height,f=(this.getSuitableOffset(0,c,this.positionOfPercentX*c+this.notShowPartWidth/2-this.movementX/yo*c,this.width/a*c/this.ratio)/c+(this.widthPercent*c-this.notShowPartWidth)*l/c)*a,v=(this.getSuitableOffset(0,u,this.positionOfPercentY*u+this.notShowPartHeight/2-this.movementY/yo*u,this.height/s*u/this.ratio)/u+(this.heightPercent*u-this.notShowPartHeight)*p/u)*s,m=this.runningState.mouseNormalizeType===t.EventType.MouseMoveStandardization,y=new xn(f*(m?c:65535)/a,v*(m?u:65535)/s,0,0,this.runningState.mouseMoveType,this.runningState.mouseNormalizeType);"touch"===this.mode&&(null===(n=this.onEvent)||void 0===n||n.call(this,y),null===(i=this.onEvent)||void 0===i||i.call(this,new Sn(t.MouseButtonType.ButtonLeft,!0)),null===(o=this.onEvent)||void 0===o||o.call(this,new Sn(t.MouseButtonType.ButtonLeft,!1)))},n.prototype.removeEvent=function(t,e){var n=t.findIndex((function(t){return t.pointerId===e.pointerId}));t.splice(n,1)},n.prototype.getSuitableOffset=function(t,e,n,i){return n<=e-i&&n>=t?n:n<t?t:e-i},n.prototype.captureStream=function(){var t=this,e=function(){var n,i,o,r;if("none"!==t.canvas.style.display)try{var a=t.videoElement,s=a.clientWidth,c=a.clientHeight,u=a.videoWidth,d=a.videoHeight,h=t.canvas.getContext("2d"),l=t.getSuitableOffset(0,u,t.positionOfPercentX*u+t.notShowPartWidth/2-t.movementX/yo*u,t.width/s*u/t.ratio),p=t.getSuitableOffset(0,d,t.positionOfPercentY*d+t.notShowPartHeight/2-t.movementY/yo*d,t.height/c*d/t.ratio),f=t.widthPercent*u-t.notShowPartWidth,v=t.heightPercent*d-t.notShowPartHeight;t.canvas.width=t.width*t.dpr,t.canvas.height=t.height*t.dpr,t.canvas.style.width=t.width+"px",t.canvas.style.height=t.height+"px",h.drawImage(t.videoElement,l,p,f,v,0,0,t.width*t.dpr,t.height*t.dpr);var m=t.cursorPercentX*u,y=t.cursorPercentY*d;if(m>=l&&m<=l+f&&y>=p&&y<=p+v&&"trackpad"===t.mode){var g=(m-l)/f*t.width*t.dpr-(null!==(i=null===(n=t.cursor)||void 0===n?void 0:n.x)&&void 0!==i?i:0)*t.ratio,E=(y-p)/v*t.height*t.dpr-(null!==(r=null===(o=t.cursor)||void 0===o?void 0:o.y)&&void 0!==r?r:0)*t.ratio;t.cursorCanvas.width>0&&t.cursorCanvas.height>0&&h.drawImage(t.cursorCanvas,g,E)}}catch(t){on.error(t)}window.requestAnimationFrame(e)};this.videoElement.removeEventListener("loadedmetadata",this.captureStream.bind(this)),window.requestAnimationFrame(e)},n.prototype.setZoomCornerPosition=function(t,e){this.zoomCorner.style.left=t-4+"px",this.zoomCorner.style.top=e+"px"},n.prototype.setMoveCornerPosition=function(t,e){this.moveCorner.style.left=t-4+"px",this.moveCorner.style.top=e-4+"px"},n.prototype.moveTo=function(t,e){this.canvas.style.left="".concat(t,"px"),this.canvas.style.top="".concat(e,"px"),this.setZoomCornerPosition(t+this.width,e+this.height),this.setMoveCornerPosition(t+this.width,e),this.positionOfPercentX=(t+1)/this.videoElement.clientWidth,this.positionOfPercentY=(e+1)/this.videoElement.clientHeight},n.prototype.setCursorPosition=function(t,e){this.cursorPercentX=t/this.videoElement.clientWidth,this.cursorPercentY=e/this.videoElement.clientHeight},n.prototype.show=function(){this.canvas.style.display="block",this.zoomCorner.style.display="block",this.moveCorner.style.display="block"},n.prototype.hide=function(){this.canvas.style.display="none",this.zoomCorner.style.display="none",this.moveCorner.style.display="none"},n.prototype.updateRatio=function(t){t<1?on.warn("Ratio should grater than 1."):(this.ratio=t,this.cursor&&this.drawCursor(this.cursor))},n.prototype.updateSize=function(t,e){t>0&&e>0?(this.width=this.hostElement.clientWidth>=t?t:this.hostElement.clientWidth,this.height=this.hostElement.clientHeight>=e?e:this.hostElement.clientHeight,this.setZoomCornerPosition(this.canvas.offsetLeft+this.width,this.canvas.offsetTop+this.height),this.setMoveCornerPosition(this.canvas.offsetLeft+this.width,this.canvas.offsetTop)):on.warn("Magnifier size should greater than 0.")},n.prototype.drawCursor=function(t){this.cursor=t;var e=t.width*this.ratio||32*this.ratio,n=t.height*this.ratio||32*this.ratio;this.cursorCanvas.width=e*this.dpr,this.cursorCanvas.height=n*this.dpr,this.cursorCanvas.style.width=(t.width||32)+"px",this.cursorCanvas.style.height=(t.height||32)+"px";var i=this.cursorCanvas.getContext("2d"),o=new Image;o.src=t.base64,o.onload=function(){i.clearRect(0,0,e,n),i.drawImage(o,0,0,e,n)}},n}(ki);var Eo=function(){function t(t,e){var n=this;this.legends=t,this.dashboardState=e,this.dataUnit=new Map([]),this.timeStamps=[],this.dataMap=new Map([]),this.maxMap=new Map([]),this.medianMap=new Map([]),this.colorMap=new Map([]),this.legends.forEach((function(t){Reflect.ownKeys(t).forEach((function(e){n.dataUnit.set(e,t[e]),n.colorMap.set(e,function(){for(var t="#",e=0;e<3;e++)t+=("0"+Math.floor((1+Math.random())*Math.pow(16,2)/2).toString(16)).slice(-2);return t}())}))}))}return Object.defineProperty(t.prototype,"getAllLegends",{get:function(){return Reflect.ownKeys(this.legends.reduce((function(t,e){return t=o(o({},t),e)}),{}))},enumerable:!1,configurable:!0}),t.prototype.updateMedian=function(t,e){var n;if(void 0===this.medianMap.get(t))this.medianMap.set(t,e);else{var i=null!==(n=this.dataMap.get(t))&&void 0!==n?n:[],o=this.getMedianData(t);i.length<this.dashboardState.dataCount?this.medianMap.set(t,(o+e)/(i.length+1)):this.medianMap.set(t,(o-i[0]+e)/i.length)}},t.prototype.push=function(t,e){var n,i,o=this;if(this.getAllLegends.includes(t)){if(this.updateMedian(t,e),this.dataMap.has(t)){var r=null!==(n=this.dataMap.get(t))&&void 0!==n?n:[];this.dataMap.set(t,r.length<this.dashboardState.dataCount?r.concat(e):r.slice(1).concat(e))}else this.dataMap.set(t,[e]);var a=Math.max.apply(Math,u([],c(Reflect.ownKeys(null!==(i=this.legends.find((function(e){return Reflect.ownKeys(e).includes(t)})))&&void 0!==i?i:{}).map((function(t){var e;return null!==(e=o.dataMap.get(t))&&void 0!==e?e:[]})).flat()),!1));this.maxMap.set(t,Math.max(e,a))}},t.prototype.updateTimestamps=function(){var t=(new Date).valueOf();this.timeStamps=this.timeStamps.length<this.dashboardState.dataCount?this.timeStamps.concat(t):this.timeStamps.slice(1).concat(t)},t.prototype.getColor=function(t){var e=this.colorMap.get(t);if(!e)throw new Error("Cannot get correct color of key: ".concat(t,"."));return e},t.prototype.getMaxData=function(t){var e;return 4*(null!==(e=this.maxMap.get(t))&&void 0!==e?e:0)/3},t.prototype.getMedianData=function(t){var e;return null!==(e=this.medianMap.get(t))&&void 0!==e?e:0},t.prototype.getData=function(t,e){void 0===e&&(e=!1);var n=this.dataMap.get(t);if(!n)throw new Error("Cannot get correct data of key: ".concat(t,"."));return e?n:n.slice(n.length<=this.dashboardState.xCount?0:n.length-this.dashboardState.xCount)},t}(),Co=function(){function t(t,e,n,i,o){this.store=t,this.objectKeys=i,this.dashboardState=o,this.updateTimes=0,this.hasPointerdown=!1,this.cursorOffsetX=-1,this.cursorOffsetY=-1,this.board=document.createElement("div"),this.board.style.cssText="\n      position: relative;\n      background: transparent;\n      width: ".concat(e,"px;\n      height: ").concat(n,"px;\n    "),this.canvas=this.createCanvas(e,n),this.board.appendChild(this.canvas),this.setupMouseEvent(),this.clear()}return Object.defineProperty(t.prototype,"ctx",{get:function(){return this.canvas.getContext("2d")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stepX",{get:function(){return this.width/(this.dashboardState.xCount+this.dashboardState.paddingLeft+this.dashboardState.paddingRight)},enumerable:!1,configurable:!0}),t.prototype.createCanvas=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.style.cssText="\n      position: absolute;\n    ",n},t.prototype.setupMouseEvent=function(){var t=this;this.canvas.addEventListener("mouseleave",(function(){t.store.timeStamps.length>0&&(t.cursorOffsetX=-1,t.cursorOffsetY=-1,t.hasPointerdown=!1,t.draw())})),this.canvas.addEventListener("mousemove",(function(e){t.store.timeStamps.length>0&&(t.cursorOffsetX=e.offsetX,t.cursorOffsetY=e.offsetY,t.hasPointerdown=!1,t.draw())})),this.canvas.addEventListener("pointerdown",(function(e){t.store.timeStamps.length>0&&(t.cursorOffsetX=e.offsetX,t.cursorOffsetY=e.offsetY,t.hasPointerdown=!0,t.draw())}))},t.prototype.drawGuideline=function(){var t=this;if(this.cursorOffsetX>-1){var e=Math.round(this.cursorOffsetX/this.stepX);if(Reflect.ownKeys(this.objectKeys).forEach((function(n){var i=t.store.getData(n)[e-t.dashboardState.paddingLeft];t.ctx.beginPath(),t.ctx.strokeStyle=t.store.getColor(n),t.ctx.lineWidth=2,t.ctx.arc(e*t.stepX,t.height-(t.store.getMaxData(n)?i/t.store.getMaxData(n)*(t.dashboardState.yCount/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height):0)-t.dashboardState.paddingBottom/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height,4,0,2*Math.PI),t.ctx.stroke()})),this.cursorOffsetX>=this.stepX*this.dashboardState.paddingLeft&&this.cursorOffsetX<=this.width-this.dashboardState.paddingRight*this.stepX&&(this.ctx.beginPath(),this.ctx.setLineDash([2,2]),this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.moveTo(e*this.stepX,this.dashboardState.paddingTop/(this.dashboardState.yCount+this.dashboardState.paddingBottom+this.dashboardState.paddingTop)*this.height),this.ctx.lineTo(e*this.stepX,this.height-this.dashboardState.paddingBottom/(this.dashboardState.yCount+this.dashboardState.paddingBottom+this.dashboardState.paddingTop)*this.height),this.ctx.stroke(),this.store.timeStamps[e-this.dashboardState.paddingLeft])){var n=new Date(this.store.timeStamps[e-this.dashboardState.paddingLeft]);this.writeText(this.ctx,"".concat(n.getMinutes(),"m").concat(n.getSeconds(),"s"),this.dashboardState.themeColor,e*this.stepX-20,this.height-this.dashboardState.paddingBottom/(this.dashboardState.yCount+this.dashboardState.paddingBottom+this.dashboardState.paddingTop)*this.height+10)}this.drawBoardOnCursor()}},t.prototype.drawBoardOnCursor=function(){var t=this,e=10,n=Math.round(this.cursorOffsetX/this.stepX)-this.dashboardState.paddingLeft,i=Reflect.ownKeys(this.objectKeys),o=i.reduce((function(e,n){return e+t.getTextHeight(t.ctx,n)}),0),r=Math.max.apply(Math,u([],c(i.map((function(e){var i;return t.ctx.measureText("".concat(e,": ").concat(null!==(i=t.store.getData(e)[n])&&void 0!==i?i:"-").concat(t.store.dataUnit.get(e))).width}))),!1)),a=o+10*(i.length-1)+20,s=r+20+2*this.dashboardState.legendRadius+4;this.ctx.beginPath(),this.ctx.fillStyle=this.dashboardState.graphColor;var d=this.cursorOffsetX+s>this.width?this.cursorOffsetX-s:this.cursorOffsetX;this.ctx.fillRect(d,this.cursorOffsetY-a/2,s,a),i.forEach((function(i,o){var r;t.ctx.beginPath(),t.ctx.fillStyle=t.store.getColor(i),t.ctx.arc(d+e+t.dashboardState.legendRadius,t.cursorOffsetY-a/2+e+t.dashboardState.legendRadius+10*o*2,t.dashboardState.legendRadius,0,2*Math.PI),t.ctx.fill(),t.writeText(t.ctx,"".concat(i,": ").concat(null!==(r=t.store.getData(i)[n])&&void 0!==r?r:"-").concat(t.store.dataUnit.get(i)),"#fff",d+e+2*t.dashboardState.legendRadius+4,t.cursorOffsetY-a/2+e+t.dashboardState.legendRadius+10*o*2)}))},t.prototype.getTextHeight=function(t,e){var n=t.measureText(e);return n.actualBoundingBoxAscent+n.actualBoundingBoxDescent},t.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle=this.dashboardState.graphColor,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.setLineDash([])},t.prototype.drawXaxis=function(){this.ctx.beginPath(),this.ctx.strokeStyle=this.dashboardState.themeColor,this.ctx.moveTo(this.dashboardState.paddingLeft*this.stepX,this.height-this.dashboardState.paddingBottom/(this.dashboardState.yCount+this.dashboardState.paddingBottom+this.dashboardState.paddingTop)*this.height),this.ctx.lineTo(this.width-this.dashboardState.paddingRight*this.stepX,this.height-this.dashboardState.paddingBottom/(this.dashboardState.yCount+this.dashboardState.paddingBottom+this.dashboardState.paddingTop)*this.height),this.ctx.stroke()},t.prototype.writeText=function(t,e,n,i,o){t.beginPath(),t.fillStyle=n,t.font="bolder 10px Helvertica",t.textBaseline="middle",t.fillText(e,i,o)},t.prototype.drawAxisScales=function(){var t=this,e=this.height-this.dashboardState.paddingBottom/(this.dashboardState.yCount+this.dashboardState.paddingBottom+this.dashboardState.paddingTop)*this.height;Array.from({length:this.dashboardState.xCount}).map((function(t,e){return e})).forEach((function(n){if(n%t.dashboardState.xAxisGap==0&&(t.ctx.beginPath(),t.ctx.moveTo((t.dashboardState.paddingLeft+n)*t.stepX,e),t.ctx.lineTo((t.dashboardState.paddingLeft+n)*t.stepX,e-5),t.ctx.stroke(),t.store.timeStamps[n])){var i=new Date(t.store.timeStamps[n]);t.writeText(t.ctx,"".concat(i.getMinutes(),"m").concat(i.getSeconds(),"s"),t.dashboardState.themeColor,n*t.stepX+t.dashboardState.paddingLeft,t.height-t.dashboardState.paddingBottom/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height+10)}}))},t.prototype.drawLegends=function(){var t=this,e=0,n=this.dashboardState.paddingLeft*this.stepX,i=this.dashboardState.paddingTop/(this.dashboardState.paddingBottom+this.dashboardState.paddingTop+this.dashboardState.yCount)*this.height/3;Reflect.ownKeys(this.objectKeys).forEach((function(o){t.ctx.beginPath(),t.ctx.fillStyle=t.store.getColor(o);var r=t.ctx.measureText(o).width;n+r>t.width-t.dashboardState.paddingRight&&e>0?(t.ctx.arc(t.dashboardState.paddingLeft*t.stepX,i+20,t.dashboardState.legendRadius,0,2*Math.PI),t.ctx.fill(),t.writeText(t.ctx,o,"#fff",t.dashboardState.paddingLeft*t.stepX+2*t.dashboardState.legendRadius,i+20),n=t.dashboardState.paddingLeft*t.stepX+10+r+2*t.dashboardState.legendRadius,i+=20,e=0):(t.ctx.arc(n,i,t.dashboardState.legendRadius,0,2*Math.PI),t.ctx.fill(),t.writeText(t.ctx,o,"#fff",n+2*t.dashboardState.legendRadius,i),n=n+10+r+2*t.dashboardState.legendRadius,e+=1)}))},t.prototype.drawMedian=function(){},t.prototype.draw=function(){var t=this;this.clear(),this.hasPointerdown&&this.updateTimes>=this.dashboardState.xCount&&(this.cursorOffsetX-=this.stepX),Reflect.ownKeys(this.objectKeys).forEach((function(e){var n,i=t.store.getData(e);t.ctx.beginPath(),t.ctx.strokeStyle=t.store.getColor(e),t.ctx.lineWidth=1,t.ctx.moveTo(t.dashboardState.paddingLeft*t.stepX,t.height-(t.store.getMaxData(e)?i[0]/t.store.getMaxData(e)*(t.dashboardState.yCount/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height):0)-t.dashboardState.paddingBottom/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height),i.slice(1).forEach((function(n,i){t.ctx.lineTo((i+t.dashboardState.paddingLeft)*t.stepX,t.height-(t.store.getMaxData(e)?n/t.store.getMaxData(e)*(t.dashboardState.yCount/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height):0)-t.dashboardState.paddingBottom/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height)})),t.ctx.stroke(),t.writeText(t.ctx,"".concat(function(t){var e=Math.log10(Math.abs(t))/3|0;if(0==e)return t.toFixed(2);var n=["","k","M","G","T","P","E"][e];return(t/Math.pow(10,3*e)).toFixed(1)+n}(i[i.length-1])," ").concat(null!==(n=t.store.dataUnit.get(e))&&void 0!==n?n:""),t.store.getColor(e),(i.length-1+t.dashboardState.paddingLeft)*t.stepX+4,t.height-(t.store.getMaxData(e)?i[i.length-1]/t.store.getMaxData(e)*(t.dashboardState.yCount/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height):0)-t.dashboardState.paddingBottom/(t.dashboardState.yCount+t.dashboardState.paddingBottom+t.dashboardState.paddingTop)*t.height+2)})),this.drawLegends(),this.drawXaxis(),this.drawAxisScales(),this.drawGuideline(),this.drawMedian()},t.createBoard=function(e,n,i){return new t(e,300,200,n,i)},t}(),wo=function(){function t(e){var n,i,o,r,a,s,c,u,d,h,l;this.xCount=null!==(n=null==e?void 0:e.xCount)&&void 0!==n?n:t.defaultOption.xCount,this.yCount=null!==(i=null==e?void 0:e.yCount)&&void 0!==i?i:t.defaultOption.yCount,this.dataCount=null!==(o=null==e?void 0:e.dataCount)&&void 0!==o?o:t.defaultOption.dataCount,this.paddingLeft=null!==(r=null==e?void 0:e.paddingLeft)&&void 0!==r?r:t.defaultOption.paddingLeft,this.paddingRight=null!==(a=null==e?void 0:e.paddingRight)&&void 0!==a?a:t.defaultOption.paddingRight,this.paddingTop=null!==(s=null==e?void 0:e.paddingTop)&&void 0!==s?s:t.defaultOption.paddingTop,this.paddingBottom=null!==(c=null==e?void 0:e.paddingBottom)&&void 0!==c?c:t.defaultOption.paddingBottom,this.xAxisGap=null!==(u=null==e?void 0:e.xAxisGap)&&void 0!==u?u:t.defaultOption.xAxisGap,this.legendRadius=null!==(d=null==e?void 0:e.legendRadius)&&void 0!==d?d:t.defaultOption.legendRadius,this.themeColor=null!==(h=null==e?void 0:e.themeColor)&&void 0!==h?h:t.defaultOption.themeColor,this.graphColor=null!==(l=null==e?void 0:e.graphColor)&&void 0!==l?l:t.defaultOption.graphColor}return t.defaultOption={xCount:80,yCount:60,dataCount:1e4,paddingLeft:15,paddingRight:25,paddingTop:30,paddingBottom:15,xAxisGap:40,legendRadius:4,themeColor:"rgba(0, 255, 0, 1)",graphColor:"rgba(0, 0, 0, 0.3)"},t}(),bo=function(){function t(t,e,n){var i=this;this.hostElement=t,this.legends=e,this.displayBoards=[],this.container=document.createElement("div"),this.container.style.cssText="\n      position: absolute;\n      left: 0px;\n      top: 0px;\n      display: flex;\n      flex-wrap: wrap;\n      align-content: flex-start;\n      gap: 10px;\n      display: none;\n      width: 100%;\n      overflow: auto;\n    ",this.hostElement.appendChild(this.container),this.dataStore=new Eo(e,n),e.forEach((function(t){var e=Co.createBoard(i.dataStore,t,n);i.displayBoards.push(e),i.container.appendChild(e.board)}))}return t.prototype.show=function(){this.container.style.display="flex"},t.prototype.hide=function(){this.container.style.display="none"},t.prototype.insert=function(t){var e=this;Reflect.ownKeys(t).forEach((function(n){var i=t[n];if("number"!=typeof i)throw new Error("Insert ".concat(n," value should be number."));e.dataStore.push(n,i)})),this.dataStore.updateTimestamps(),this.displayBoards.forEach((function(t){t.draw(),t.updateTimes+=1}))},t.createDefaultDashboard=function(e,n){void 0===n&&(n=[]);var i=[{averageJitterBufferDelay:"ms",rtt:"ms",latency:"ms"},{packetsReceived:"",packetsLost:"",packetLossRate:"%"},{framesPerSecond:"",framesReceived:"",framesDecoded:"",framesDropped:"",keyFramesDecoded:""},{framesDroppedDetla:"",framesReceivedDetla:"",keyframesDecodedDetla:"",framesBuffer:""},{headerBytesReceived:"",bytesReceived:""},{bitrate:"kbps"}].concat(n);return new t(e||document.body,i,new wo)},t}(),Do=function(){function t(t,e,n,i){this.objectStores=n,this.objectStoreParams=i,this.dbRequest=void 0,this.db=void 0,window.indexedDB?(this.dbRequest=window.indexedDB.open(t,e),this.setupIDBOpenListener()):on.warn("[IndexedDB] Your browser doesn't support a stable version of IndexedDB.Such and such feature will not be available.")}return t.prototype.setupIDBOpenListener=function(){var t=this;this.dbRequest&&(this.dbRequest.onupgradeneeded=function(e){try{t.db=e.target.result,t.addObjectStores()}catch(t){on.error("[IndexedDB] ",t)}},this.dbRequest.onerror=function(t){on.error("[IndexedDB] You are not allow me to use IndexedDB. "+t)},this.dbRequest.onblocked=function(){on.error("[IndexedDB] Some site has loaded the database. You should close them before we continue.")},this.dbRequest.onsuccess=function(e){try{on.info("[IndexedDB] Datebase created successfully."),t.db=e.target.result,t.addObjectStores()}catch(t){on.error("[IndexedDB] ",t)}})},t.prototype.getObjectStore=function(t,e){var n;return void 0===e&&(e="readonly"),null===(n=this.db)||void 0===n?void 0:n.transaction([t],e).objectStore(t)},t.prototype.addObjectStores=function(t,e){var n,i=this,o=null===(n=this.dbRequest)||void 0===n?void 0:n.result;o&&(null!=t?t:this.objectStores).forEach((function(t){var n;if(o.objectStoreNames.contains(t.name)){var r=i.getObjectStore(t.name,"readwrite"),a=null==r?void 0:r.clear();a&&(a.onsuccess=function(){on.info("[IndexedDB] Clear ObjectStore ".concat(t.name," successfully."))},a.onerror=function(e){on.error("[IndexedDB] Something went wrong when clearing ObjectStore ".concat(t.name),e)})}else{var s=o.createObjectStore(t.name,null!==(n=null!=e?e:i.objectStoreParams)&&void 0!==n?n:{autoIncrement:!0});t.objectIndex.forEach((function(t){var e;s.createIndex(t.name,null!==(e=t.keyPath)&&void 0!==e?e:"id",t.options)}))}}))},t.prototype.add=function(t,e){var n=this;return new Promise((function(i){var o=n.getObjectStore(t,"readwrite"),r=null==o?void 0:o.add(e);r&&(r.onsuccess=function(){on.info("[IndexedDB] Sync data to IndexedDB successfully."),i(!0)},r.onerror=function(t){on.error("[IndexedDB] "+t),i(!1)})}))},t.prototype.readAllData=function(t){var e=this;return new Promise((function(n){var i=e.getObjectStore(t),o=null==i?void 0:i.openCursor(),r=[];o?o.onsuccess=function(t){try{var e=t.target.result;e?(r.push(e.value),e.continue()):n(r)}catch(t){on.error("[IndexedDB] ",t)}}:n(void 0)}))},t}(),To=function(){function t(){}return t.init=function(t,e,n){var i=this;void 0===n&&(n=100),this.maxCount=n,this.database?this.database.addObjectStores(t.map((function(t){return{name:t.storeName,objectIndex:t.objectStoreFields.map((function(e){var n;return{keyPath:null!==(n=t.keyPath)&&void 0!==n?n:"id",name:e}}))}})),{autoIncrement:!0}):this.database=new Do(window.encodeURIComponent(null!=e?e:window.location.href),1,t.map((function(t){return{name:t.storeName,objectIndex:t.objectStoreFields.map((function(e){var n;return{keyPath:null!==(n=t.keyPath)&&void 0!==n?n:"id",name:e}}))}})),{autoIncrement:!0}),t.forEach((function(t){i.resetDataMapData(t.storeName,t.objectStoreFields)}))},t.syncToDataBase=function(t){return r(this,void 0,void 0,(function(){var e,n;return a(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),(e=this.dataMap.get(t))?[4,this.database.add(t,e)]:[3,2];case 1:i.sent(),this.resetDataMapData(t,Object.keys(e)),i.label=2;case 2:return[3,4];case 3:return n=i.sent(),on.error(n),[3,4];case 4:return[2]}}))}))},t.resetDataMapData=function(t,e){this.dataMap.set(t,e.reduce((function(t,e){return t[e]=[],t}),{}))},t.addData=function(t,e,n){var i,r,a,s,c=this.dataBufferMaxCount.get(t),u=null==c?void 0:c[e],d=this.dataMap.get(t);d?d[e]?this.dataMap.set(t,o(o({},d),((i={})[e]=d[e].concat(n),i))):this.dataMap.set(t,o(o({},d),((r={})[e]=[n],r))):this.dataMap.set(t,((a={})[e]=[n],a)),void 0!==u&&(u+1)%this.maxCount==0&&this.syncToDataBase(t),this.dataBufferMaxCount.set(t,o(o({},c),((s={})[e]=void 0!==u?u+1:0,s)))},t.exportData=function(t){return r(this,void 0,void 0,(function(){var e,n,i,o,r,c,u,d,h,l,p,f;return a(this,(function(a){switch(a.label){case 0:e=this.metaData+"\n-- ray-streaming version: v".concat("2.19.8"," --\n"),a.label=1;case 1:a.trys.push([1,9,10,11]),n=s(Array.from(this.dataMap.keys())),i=n.next(),a.label=2;case 2:if(i.done)return[3,8];o=i.value,a.label=3;case 3:return a.trys.push([3,6,,7]),(r=this.dataMap.get(o))?(c=Object.values(r).map((function(t){return t.join("\n")})),[4,this.database.readAllData(o)]):[3,5];case 4:u=a.sent(),e+=(null!=u?u:[]).map((function(t){return Object.values(t)})).flat().flat().join("\n")+c.join("\n")+"\n\n",a.label=5;case 5:return[3,7];case 6:return d=a.sent(),on.error(d),[3,7];case 7:return i=n.next(),[3,2];case 8:return[3,11];case 9:return h=a.sent(),p={error:h},[3,11];case 10:try{i&&!i.done&&(f=n.return)&&f.call(n)}finally{if(p)throw p.error}return[7];case 11:return(l=document.createElement("a")).href="data:application/octet-stream;charset=utf-8;base64,".concat(window.btoa(e)),l.download="".concat(t),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),[2]}}))}))},t.dataMap=new Map([]),t.dataBufferMaxCount=new Map([]),t.metaData="",t.maxCount=100,t}(),xo=function(){function t(e,n,i){void 0===i&&(i=!1);var o=this;this.target=e,this.offsetCoordinate={x:0,y:0},this.handlePointerDown=function(t){o.offsetCoordinate={x:t.offsetX,y:t.offsetY}},this.handlePointerMove=function(e){if(o.offsetElement.hasPointerCapture(e.pointerId)){var n=t.constraintBoundary(o.target,o.offsetElement,{x:e.offsetX-o.offsetCoordinate.x,y:e.offsetY-o.offsetCoordinate.y}),i=n.left,r=n.top;o.target.style.left=i+"px",o.target.style.top=r+"px"}else o.offsetElement.setPointerCapture(e.pointerId)},this.handlePointerUp=function(e){if(o.enableSnapEdges){var n=t.snapEdges(o.target,o.offsetElement,{x:e.offsetX-o.offsetCoordinate.x,y:e.offsetY-o.offsetCoordinate.y}),i=n.left,r=n.top;o.target.style.left=i+"px",o.target.style.top=r+"px"}o.offsetElement.releasePointerCapture(e.pointerId)},this.enableSnapEdges=i,this.handleElement=n||e,this.offsetElement=e.offsetParent||document.body,t.ensureNotStatic(e),this.handleElement.addEventListener("pointerdown",this.handlePointerDown),this.offsetElement.addEventListener("pointermove",this.handlePointerMove),this.offsetElement.addEventListener("pointerup",this.handlePointerUp)}return t.ensureNotStatic=function(t,e){void 0===e&&(e=!1);var n=window.getComputedStyle(t,null).position;e?"static"===n&&(t.style.position="relative"):"static"!==n&&"relative"!==n||(t.style.position="absolute")},t.constraintBoundary=function(t,e,n){var i=t.offsetWidth,o=t.offsetHeight,r=e.offsetWidth,a=e.offsetHeight;return{left:Math.min(r-i,Math.max(0,n.x)),top:Math.min(a-o,Math.max(0,n.y))}},t.snapEdges=function(t,e,n){var i=n.x,o=n.y,r=t.offsetWidth,a=t.offsetHeight,s=e.offsetWidth,c=e.offsetHeight;return Math.min(o,c-o)>Math.min(i,s-i)?{left:i>s/2?s-r:0,top:Math.min(Math.max(o,0),c-a)}:{left:Math.min(Math.max(i,0),s-r),top:o>c/2?c-a:0}},t.prototype.destory=function(){this.handleElement.removeEventListener("pointerdown",this.handlePointerDown),this.offsetElement.removeEventListener("pointerup",this.handlePointerUp),this.offsetElement.removeEventListener("pointermove",this.handlePointerMove)},t}(),So=function(){function t(t){this.targetElement=t}return t.prototype.getTransformMatrix=function(t,e,n){var i=window.getComputedStyle(t,null).transform,o=new DOMMatrixReadOnly(i);return"matrix(".concat(o.a,", ").concat(o.b,", ").concat(o.c,", ").concat(o.d,", ").concat(o.e+e,", ").concat(o.f+n,")")},t}(),Oo=function(t){function e(e,n){var i=t.call(this,e)||this;return i.handleDragElement=n,i.dragOldestOffset={x:0,y:0},i.status="off",i.pointerElementHasChange=!1,i.dragHandlerPointerdown=function(){"on"===i.status&&(i.targetElement.addEventListener("pointermove",i.handlePointermove),i.targetElement.addEventListener("pointerup",i.releasePointer))},i.handlePointermove=function(t){i.targetElement.hasPointerCapture(t.pointerId)?t.target===i.targetElement&&(i.pointerElementHasChange||(i.dragOldestOffset={x:t.offsetX,y:t.offsetY},i.pointerElementHasChange=!0),i.targetElement.style.transform=i.getTransformMatrix(i.targetElement,t.offsetX-i.dragOldestOffset.x,t.offsetY-i.dragOldestOffset.y)):i.targetElement.setPointerCapture(t.pointerId)},i.releasePointer=function(t){i.targetElement.removeEventListener("pointermove",i.handlePointermove),i.targetElement.releasePointerCapture(t.pointerId),i.pointerElementHasChange=!1},i.handleDragElement&&(i.handleDragElement.style.touchAction="none"),i.setupEvent(),i}return i(e,t),e.prototype.setupEvent=function(){var t;null===(t=this.handleDragElement||this.targetElement)||void 0===t||t.addEventListener("pointerdown",this.dragHandlerPointerdown)},e.prototype.destroy=function(){var t;null===(t=this.handleDragElement||this.targetElement)||void 0===t||t.removeEventListener("pointerdown",this.dragHandlerPointerdown)},e.prototype.on=function(){this.status="on"},e.prototype.off=function(){this.status="off"},e}(So),Mo=30,Po=30,ko=function(t){function e(e,n){void 0===n&&(n={minWidth:0,minHeight:0});var i=t.call(this,e)||this;return i.minSize=n,i.status="off",i.activeArea={top:{startX:0,endX:0,startY:0,endY:0},left:{startX:0,endX:0,startY:0,endY:0},right:{startX:0,endX:0,startY:0,endY:0},bottom:{startX:0,endX:0,startY:0,endY:0},leftTop:{startX:0,endX:0,startY:0,endY:0},rightTop:{startX:0,endX:0,startY:0,endY:0},leftBottom:{startX:0,endX:0,startY:0,endY:0},rightBottom:{startX:0,endX:0,startY:0,endY:0}},i.pointerElementChange=!1,i.pointerdownDeltaOffset={x:0,y:0},i.previousDeltaSize={width:0,height:0},i.startMoving=!1,i.handlePointerdown=function(t){"on"===i.status&&(i.targetElement.addEventListener("pointerup",i.releasePointer),i.targetElement.addEventListener("pointermove",i.handlePointermove))},i.handlePointermove=function(t){var e=i.targetElement,n=e.offsetHeight,o=e.offsetWidth;if(i.targetElement.hasPointerCapture(t.pointerId)){if(t.target===i.targetElement){if(!i.pointerElementChange){var r=t.offsetX,a=t.offsetY,s=Object.entries(i.activeArea).find((function(t){var e=c(t,2);e[0];var n=e[1],i=n.startX,o=n.endX,s=n.startY,u=n.endY;return r<=o&&r>=i&&a>=s&&a<=u}));if(s)return i.currentPosition=s[0],i.pointerElementChange=!0,void(i.pointerdownDeltaOffset={x:t.offsetX,y:t.offsetY})}if(i.currentPosition){var u=0,d=0,h=0,l=0;switch(i.currentPosition){case"rightTop":i.startMoving||(i.pointerdownDeltaOffset={x:o-i.pointerdownDeltaOffset.x,y:t.offsetY}),u=Math.max(n-t.offsetY,i.minSize.minHeight),i.targetElement.style.width=Math.max(t.offsetX,i.minSize.minWidth)+i.pointerdownDeltaOffset.x+"px",i.targetElement.style.height=u+i.pointerdownDeltaOffset.y+"px",h=n-u,i.targetElement.style.transform=i.getTransformMatrix(i.targetElement,0,i.previousDeltaSize.height===h?0:h-i.pointerdownDeltaOffset.y);break;case"leftTop":i.startMoving||(i.pointerdownDeltaOffset={x:t.offsetX,y:t.offsetY}),d=Math.max(o-t.offsetX,i.minSize.minWidth),u=Math.max(n-t.offsetY,i.minSize.minHeight),i.targetElement.style.width=d+i.pointerdownDeltaOffset.x+"px",i.targetElement.style.height=u+i.pointerdownDeltaOffset.y+"px",l=o-d,h=n-u,i.targetElement.style.transform=i.getTransformMatrix(i.targetElement,l===i.previousDeltaSize.width?0:l-i.pointerdownDeltaOffset.x,h===i.previousDeltaSize.height?0:h-i.pointerdownDeltaOffset.y);break;case"leftBottom":i.startMoving||(i.pointerdownDeltaOffset={x:t.offsetX,y:n-t.offsetY}),d=Math.max(o-t.offsetX,i.minSize.minWidth),i.targetElement.style.width=d+i.pointerdownDeltaOffset.x+"px",i.targetElement.style.height=Math.max(t.offsetY,i.minSize.minHeight)+i.pointerdownDeltaOffset.y+"px",l=o-d,i.targetElement.style.transform=i.getTransformMatrix(i.targetElement,l===i.previousDeltaSize.width?0:l-i.pointerdownDeltaOffset.x,0);break;case"rightBottom":i.startMoving||(i.pointerdownDeltaOffset={x:o-t.offsetX,y:n-t.offsetY}),i.targetElement.style.width=Math.max(t.offsetX,i.minSize.minWidth)+i.pointerdownDeltaOffset.x+"px",i.targetElement.style.height=Math.max(t.offsetY,i.minSize.minHeight)+i.pointerdownDeltaOffset.y+"px";break;case"left":i.startMoving||(i.pointerdownDeltaOffset.x=t.offsetX),d=Math.max(o-t.offsetX,i.minSize.minWidth),i.targetElement.style.width=d+i.pointerdownDeltaOffset.x+"px",l=o-d,i.targetElement.style.transform=i.getTransformMatrix(i.targetElement,l===i.previousDeltaSize.width?0:l-i.pointerdownDeltaOffset.x,0);break;case"right":i.startMoving||(i.pointerdownDeltaOffset.x=o-t.offsetX),i.targetElement.style.width=Math.max(t.offsetX,i.minSize.minWidth)+i.pointerdownDeltaOffset.x+"px";break;case"bottom":i.startMoving||(i.pointerdownDeltaOffset.y=n-t.offsetY),i.targetElement.style.height=Math.max(t.offsetY,i.minSize.minHeight)+i.pointerdownDeltaOffset.y+"px";break;case"top":i.startMoving||(i.pointerdownDeltaOffset.y=t.offsetY),u=Math.max(n-t.offsetY,i.minSize.minHeight),i.targetElement.style.height=u+i.pointerdownDeltaOffset.y+"px",h=n-u,i.targetElement.style.transform=i.getTransformMatrix(i.targetElement,0,h===i.previousDeltaSize.height?0:h-i.pointerdownDeltaOffset.y)}i.startMoving=!0,i.previousDeltaSize={width:l,height:h}}}}else i.targetElement.setPointerCapture(t.pointerId)},i.releasePointer=function(t){i.targetElement.removeEventListener("pointermove",i.handlePointermove),i.targetElement.releasePointerCapture(t.pointerId),i.currentPosition=void 0,i.pointerElementChange=!1,i.startMoving=!1,i.calcPointerdownArea()},i.targetElement.style.touchAction="none",i.setupEvent(),i}return i(e,t),Object.defineProperty(e.prototype,"targetSize",{get:function(){return{offsetWidth:this.targetElement.offsetWidth,offsetHeight:this.targetElement.offsetHeight}},enumerable:!1,configurable:!0}),e.prototype.setupEvent=function(){this.targetElement.addEventListener("pointerdown",this.handlePointerdown)},e.prototype.calcPointerdownArea=function(){var t=this.targetSize,e=t.offsetWidth,n=t.offsetHeight;this.activeArea={top:{startX:e/2-Mo/2,endX:e/2+Mo/2,startY:0,endY:Po},left:{startX:0,endX:Mo,startY:n/2-Po/2,endY:n/2+Po/2},right:{startX:e-Mo,endX:e,startY:n/2-Po/2,endY:n/2+Po/2},bottom:{startX:e/2-Mo/2,endX:e/2+Mo/2,startY:n-Po,endY:n},leftTop:{startX:0,endX:Mo,startY:0,endY:Po},rightTop:{startX:e-Mo,endX:e,startY:0,endY:Po},leftBottom:{startX:0,endX:Mo,startY:n-Po,endY:n},rightBottom:{startX:e-Mo,endX:e,startY:n-Po,endY:n}}},e.prototype.destroy=function(){this.targetElement.removeEventListener("pointerdown",this.handlePointerdown)},e.prototype.on=function(){this.status="on",this.calcPointerdownArea()},e.prototype.off=function(){this.status="off"},e}(So),Ro=function(){function t(){return this}return t.prototype.createDraggable=function(t,e){return this.draggableInstance=new Oo(t,e),this},t.prototype.createResizable=function(t,e){return void 0===e&&(e={minWidth:0,minHeight:0}),this.resizableInstance=new ko(t,e),this},t.prototype.useDraggable=function(){var t,e;null===(t=this.resizableInstance)||void 0===t||t.off(),null===(e=this.draggableInstance)||void 0===e||e.on()},t.prototype.useResizable=function(){var t,e;null===(t=this.draggableInstance)||void 0===t||t.off(),null===(e=this.resizableInstance)||void 0===e||e.on()},t.prototype.releaseAll=function(){var t,e;null===(t=this.resizableInstance)||void 0===t||t.off(),null===(e=this.draggableInstance)||void 0===e||e.off()},t.prototype.destroy=function(){var t,e;null===(t=this.resizableInstance)||void 0===t||t.destroy(),null===(e=this.draggableInstance)||void 0===e||e.destroy()},t}();function _o(t,e){void 0===e&&(e="div");var n=document.createElement(e);return n.style.cssText=t,n}var Lo=function(){function t(){}return t.create=function(t){void 0===t&&(t="#ff0000");var e=_o("\n      width: 100%;\n      height: 100%;\n      position: absolute;\n      inset: 0px;\n      display: none;\n      background: rgba(0, 0, 0, 0.8);\n      user-select: none;\n      -webkit-user-select: none;\n    "),n=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      left: 0px;\n      top: 0px;\n      border-top: 3px solid ".concat(t,";\n      border-left: 3px solid ").concat(t,";\n    ")),i=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      right: 0px;\n      top: 0px;\n      border-top: 3px solid ".concat(t,";\n      border-right: 3px solid ").concat(t,";\n    ")),o=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      left: 0px;\n      bottom: 0px;\n      border-bottom: 3px solid ".concat(t,";\n      border-left: 3px solid ").concat(t,";\n    ")),r=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      right: 0px;\n      bottom: 0px;\n      border-bottom: 3px solid ".concat(t,";\n      border-right: 3px solid ").concat(t,";\n    ")),a=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      left: 0px;\n      top: 50%;\n      transform: translate(0px, -50%);\n      border-left: 3px solid ".concat(t,";\n    ")),s=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      right: 0px;\n      top: 50%;\n      transform: translate(0px, -50%);\n      border-right: 3px solid ".concat(t,";\n    ")),c=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      left: 50%;\n      top: 0px;\n      transform: translate(-50%, 0px);\n      border-top: 3px solid ".concat(t,";\n    ")),u=_o("\n      position: absolute;\n      width: 30px;\n      height: 30px;\n      left: 50%;\n      bottom: 0px;\n      transform: translate(-50%, 0px);\n      border-bottom: 3px solid ".concat(t,";\n    ")),d=_o("\n      width: 100px;\n      height: 100%;\n      margin: 0 auto;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n    "),h=_o("\n      width: 100%;\n      height: 30px;\n      color: #fff;\n      font-weight: 600;\n      font-size: 12px;\n      border-radius: 5px;\n      justify-content: center; \n      align-items: center; \n      display: flex;\n      pointer-events: auto;\n      curosr: pointer;\n      background: ".concat(t,";\n    "));h.innerHTML='\n      <svg width="14" height="14" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M27.8333 4.5H6.83333C6.21449 4.5 5.621 4.74583 5.18342 5.18342C4.74583 5.621 4.5 6.21449 4.5 6.83333V27.8333C4.5 28.4522 4.74583 29.0457 5.18342 29.4832C5.621 29.9208 6.21449 30.1667 6.83333 30.1667H27.8333C28.4522 30.1667 29.0457 29.9208 29.4832 29.4832C29.9208 29.0457 30.1667 28.4522 30.1667 27.8333V6.83333C30.1667 6.21449 29.9208 5.621 29.4832 5.18342C29.0457 4.74583 28.4522 4.5 27.8333 4.5ZM27.8333 13.8333H20.8333V20.8333H27.8333V27.8333H20.8333V20.8333H13.8333V27.8333H6.83333V20.8333H13.8333V13.8333H6.83333V6.83333H13.8333V13.8333H20.8333V6.83333H27.8333V13.8333Z" fill="white"/>\n      </svg>\n      \n    ';var l=_o("\n      color: #fff;\n      font-size: 12px;\n      text-align: center;\n      margin-top: 10px;\n      pointer-events: auto;\n      cursor: pointer;\n    ");return l.innerText="",d.append(h,l),e.append(a,s,c,u,o,r,i,n,d),{board:e,resetButton:l,opacityButton:h}},t}(),Ao=function(){function t(t,e,n){void 0===e&&(e="#ff0000");var i=this;this.hostElement=t,this.themeColor=e,this.onChange=n,this.isPressdown=!1,this.cursorOffsetInBall={offsetX:0,offsetY:0},this.percent=0,this.unclaspPointer=function(t){t.stopPropagation(),i.hidenBoard.releasePointerCapture(t.pointerId),i.isPressdown=!1},this.hidenBoard=_o("\n        width: 100%;\n        height: 100%;\n        position: relative;\n        touch-action: none;\n      "),this.progressBar=_o("\n        height: 3px;\n        width: 100%;\n        background: ".concat(e,";\n        position: absolute;\n        left: 50%;\n        top: 50%;\n        border-radius: 4px;\n        transform: translate(-50%, -50%);\n      ")),this.progressBall=_o("\n        width: 10px;\n        height: 10px;\n        position: absolute;\n        border-radius: 50%;\n        background: #fff;\n        top: 50%;\n        left: -6px;\n        transform: translateY(-50%);\n      ");var o=_o("\n      position: absolute;\n      background: transparent;\n      width: 20px;\n      height: 20px;\n      left: 50%;\n      top: 50%;\n      transform: translate(-50%, -50%);\n    ");this.progressBall.appendChild(o),this.progressBar.appendChild(this.progressBall),this.hidenBoard.appendChild(this.progressBar),this.hostElement.appendChild(this.hidenBoard),this.setupEventListener()}return Object.defineProperty(t.prototype,"progressBarWidthAndLeft",{get:function(){var t=this.progressBar.offsetLeft-this.progressBar.offsetWidth/2;return{left:t,right:t+this.progressBar.offsetWidth}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"progressBallWidth",{get:function(){return{width:this.progressBall.offsetWidth}},enumerable:!1,configurable:!0}),t.prototype.setupEventListener=function(){var t=this;this.hidenBoard.addEventListener("pointermove",(function(e){var n,i=t.progressBarWidthAndLeft,o=i.left,r=i.right,a=t.progressBallWidth.width;if(t.isPressdown){var s=e.offsetX-o-t.cursorOffsetInBall.offsetX<-a/2?-a/2:e.offsetX-o-t.cursorOffsetInBall.offsetX>r-o-a/2?r-o-a/2:e.offsetX-o-t.cursorOffsetInBall.offsetX;t.updateBallPosition(s),t.percent=(s+a/2)/(r-o),null===(n=t.onChange)||void 0===n||n.call(t,(s+a/2)/(r-o))}})),this.hidenBoard.addEventListener("pointerleave",this.unclaspPointer),this.hidenBoard.addEventListener("pointerup",this.unclaspPointer),this.hidenBoard.addEventListener("pointerdown",(function(e){e.stopPropagation(),t.hidenBoard.setPointerCapture(e.pointerId)})),this.progressBall.addEventListener("pointerdown",(function(e){t.isPressdown=!0,t.cursorOffsetInBall={offsetX:e.offsetX,offsetY:e.offsetY}})),new ResizeObserver((function(){t.setPercent(t.percent)})).observe(this.hostElement)},t.prototype.updateBallPosition=function(t){this.progressBall.style.left=t+"px";var e=this.progressBarWidthAndLeft,n=e.left,i=e.right;this.progressBar.style.background="linear-gradient(to right, ".concat(this.themeColor," ").concat(t/(i-n)*100,"%, #32353C ").concat(t/(i-n)*100,"% 100%)")},t.prototype.setPercent=function(t){var e=this;this.percent=t,setTimeout((function(){var n=e.progressBarWidthAndLeft,i=n.left,o=n.right,r=t*(o-i),a=e.progressBallWidth.width;e.progressBall.style.left=r-a/2+"px",e.updateBallPosition(r-a/2)}))},t}(),Bo=function(){function t(){this.eventMap=new Map([])}return t.prototype.on=function(t,e){var n,i=null!==(n=this.eventMap.get(t))&&void 0!==n?n:[];this.eventMap.set(t,i.concat(e))},t.prototype.once=function(t,e){var n=this,i=!1;this.on(t,(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];i||(e.apply(n,t),i=!0)}))},t.prototype.emit=function(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this.eventMap.has(t)&&(null===(e=this.eventMap.get(t))||void 0===e||e.forEach((function(t){return t.apply(void 0,u([],c(n),!1))})))},t.prototype.destroy=function(){this.eventMap.clear()},t}(),Ko=function(){function t(){this.emitter=new Bo}return t.prototype.emit=function(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];(e=this.emitter).emit.apply(e,u([t],c(n),!1))},t.prototype.on=function(t,e){this.emitter.on(t,e)},t.prototype.once=function(t,e){this.emitter.once(t,e)},t.prototype.destroy=function(){this.emitter.destroy()},t}(),Io=function(t){function e(e,n,i){var o=t.call(this)||this;o.hostElement=n,o.domElement=_o("\n      width: 100%;\n      height: 100%;\n    "),o.opacityBar=_o("\n      height: 100%;\n      display: none;\n      align-items: center;\n      background: #41454e;\n      flex-wrap: nowrap;\n      position: relative;\n      user-select: none;\n      -webkit-user-select: none;\n      justify-content: space-between;\n      padding: 0px 5%;\n    ");var r=_o("\n      font-size: 12px;\n      color: #fff;\n      font-weight: 400;\n      white-space: nowrap;\n    ","span");r.innerText="",o.percentSpan=_o("\n      font-size: 12px;\n      color: #fff;\n      font-weight: 400;\n      padding: 0 0 0 15px;\n      white-space: nowrap;\n    "),o.percentSpan.innerText="".concat(100*e,"%");var a=_o("\n      height: 100%;\n      width: 55%;\n    "),s=_o("\n      height: 22px;\n    ");s.innerHTML='\n      <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <rect x="5.81458" y="14.8892" width="12.8333" height="1.83333" rx="0.916667" transform="rotate(-45 5.81458 14.8892)" fill="white"/>\n        <rect x="7.11096" y="5.81445" width="12.8333" height="1.83333" rx="0.916667" transform="rotate(45 7.11096 5.81445)" fill="white"/>\n      </svg>\n    ',o.opacityBar.append(r,a,o.percentSpan,s),o.settingWrapper=_o("\n      height: 100%;\n      background: #41454e;\n      display: flex;\n      align-items: center;\n      justify-content: flex-start;\n      padding: 0px 2%;\n    ");var c=_o("\n      display: flex;\n      width: 8%;\n    ");return c.innerHTML='\n      <svg width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M4.4268 2.96507C4.33416 2.55819 4.42652 2.11451 4.75336 1.85507C5.64735 1.14543 6.64078 0.570949 7.70175 0.15006C8.09028 -0.00407176 8.52155 0.137919 8.82798 0.422189C9.16888 0.738427 9.55619 1.00275 9.97761 1.20537C10.6086 1.50874 11.2999 1.66599 12 1.66542C12.7001 1.66599 13.3914 1.50874 14.0224 1.20537C14.4438 1.00275 14.8311 0.738427 15.172 0.422189C15.4785 0.137919 15.9097 -0.00407173 16.2983 0.15006C17.3592 0.570949 18.3527 1.14543 19.2467 1.85507C19.5735 2.11451 19.6658 2.55818 19.5731 2.96505C19.4699 3.41838 19.4348 3.88591 19.4701 4.35212C19.523 5.04974 19.7324 5.72647 20.0827 6.33209C20.4322 6.93886 20.914 7.45903 21.4923 7.85391C21.8785 8.11759 22.301 8.32088 22.7453 8.45802C23.1448 8.58137 23.4835 8.88411 23.5442 9.29786C23.7098 10.4263 23.7097 11.5729 23.544 12.7013C23.4833 13.1142 23.1458 13.4167 22.747 13.5399C21.6617 13.8752 20.6962 14.604 20.0827 15.6654C19.7322 16.2712 19.5228 16.9481 19.4698 17.646C19.4345 18.1123 19.4696 18.5799 19.573 19.0334C19.6657 19.4404 19.5733 19.8842 19.2463 20.1437C18.171 20.9968 16.952 21.6544 15.6447 22.0844C15.2078 21.5374 14.6532 21.096 14.0222 20.7928C13.3913 20.4896 12.7001 20.3325 12 20.3333C11.2999 20.3327 10.6086 20.4899 9.97761 20.7933C9.55614 20.996 9.16881 21.2603 8.82788 21.5766C8.5215 21.8608 8.09033 22.0028 7.70183 21.8488C6.64102 21.4282 5.64768 20.8541 4.7537 20.1448C4.42667 19.8854 4.33428 19.4415 4.42704 19.0345C4.53038 18.5811 4.56553 18.1135 4.53017 17.6471C4.47725 16.9493 4.26779 16.2724 3.91734 15.6666C3.56768 15.06 3.0858 14.5401 2.50752 14.1454C2.12144 13.8819 1.69902 13.6788 1.25486 13.5417C0.855228 13.4184 0.516491 13.1157 0.455761 12.7019C0.290172 11.5737 0.290178 10.4272 0.455778 9.29898C0.516504 8.88526 0.855162 8.58254 1.25472 8.4592C1.69902 8.32205 2.12155 8.11876 2.5077 7.85508C3.08599 7.4602 3.56781 6.94003 3.91734 6.33325C4.26761 5.72764 4.47697 5.0509 4.52989 4.35329C4.56526 3.88699 4.53012 3.41883 4.4268 2.96507ZM13.75 14.0298C14.1513 13.8016 14.5034 13.4964 14.7862 13.1316C15.069 12.7668 15.2769 12.3496 15.3978 11.9042C15.5188 11.4587 15.5504 10.9937 15.4909 10.536C15.4314 10.0783 15.282 9.63684 15.0512 9.23711C14.8204 8.83737 14.5128 8.48723 14.1461 8.20685C13.7795 7.92647 13.361 7.72139 12.9147 7.60341C12.4685 7.48543 12.0033 7.45688 11.546 7.51941C11.0886 7.58194 10.6482 7.73431 10.25 7.96775C9.45269 8.43518 8.87261 9.19901 8.63638 10.0925C8.40014 10.9861 8.52692 11.9368 8.98905 12.7372C9.45117 13.5376 10.2111 14.1227 11.1031 14.3649C11.995 14.607 12.9466 14.4866 13.75 14.0298Z" fill="white"/>\n      </svg>\n    ',c.onclick=function(){o.emit("showResizeboard",!0)},s.onclick=function(){o.triggerOpacityBar()},o.settingWrapper.append(c),o.domElement.append(o.opacityBar,o.settingWrapper),o.slider=new Ao(a,i,(function(t){o.percentSpan.innerText="".concat((100*t).toFixed(0),"%"),o.emit("sliderChange",t)})),o.setPercent(e),new ResizeObserver((function(){(o.parentSize.offsetWidth<200||o.parentSize.offsetHeight<30)&&(o.percentSpan.style.transform="scale(0.6)",r.style.transform="scale(0.6)")})).observe(o.hostElement),o}return i(e,t),Object.defineProperty(e.prototype,"parentSize",{get:function(){var t=this.hostElement;return{offsetHeight:t.offsetHeight,offsetWidth:t.offsetWidth}},enumerable:!1,configurable:!0}),e.prototype.setPercent=function(t){this.slider.setPercent(t),this.percentSpan.innerText="".concat((100*t).toFixed(0),"%")},e.prototype.triggerOpacityBar=function(){"flex"===this.opacityBar.style.display?(this.opacityBar.style.display="none",this.settingWrapper.style.display="flex"):(this.opacityBar.style.display="flex",this.settingWrapper.style.display="none")},e}(Ko),Yo=new Map([[0,[{content:"q",keycode:81,key:"KeyQ"},{content:"w",keycode:87,key:"KeyW"},{content:"e",keycode:69,key:"KeyE"},{content:"r",keycode:82,key:"KeyR"},{content:"t",keycode:84,key:"KeyT"},{content:"y",keycode:89,key:"KeyY"},{content:"u",keycode:85,key:"KeyU"},{content:"i",keycode:73,key:"KeyI"},{content:"o",keycode:79,key:"KeyO"},{content:"p",keycode:80,key:"KeyP"}]],[1,[{content:"tab",keycode:9,key:"Tab"},{content:"a",keycode:65,key:"KeyA"},{content:"s",keycode:83,key:"KeyS"},{content:"d",keycode:68,key:"KeyD"},{content:"f",keycode:70,key:"KeyF"},{content:"g",keycode:71,key:"KeyG"},{content:"h",keycode:72,key:"KeyH"},{content:"j",keycode:74,key:"KeyJ"},{content:"k",keycode:75,key:"KeyK"},{content:"l",keycode:76,key:"KeyL"}]],[2,[{content:'\n          <svg width="18" height="15" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M16.9167 8.8335L9.00008 1.3335L1.08342 8.8335L6.08342 8.8335L6.08341 13.8335L11.9167 13.8335L11.9167 8.8335L16.9167 8.8335Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          </svg>        \n        ',keycode:null,key:null,switchUpperAndLower:!0},{content:"z",keycode:90,key:"KeyZ"},{content:"x",keycode:88,key:"KeyX"},{content:"c",keycode:67,key:"KeyC"},{content:"v",keycode:86,key:"KeyV"},{content:"b",keycode:66,key:"KeyB"},{content:"n",keycode:78,key:"KeyN"},{content:"m",keycode:77,key:"KeyM"},{content:'\n          <svg width="18" height="18" viewBox="0 0 31 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path fill-rule="evenodd" clip-rule="evenodd" d="M6.53853 0.941756C6.90379 0.355991 7.54531 0 8.23562 0H28.643C29.7476 0 30.643 0.895431 30.643 2V22C30.643 23.1046 29.7476 24 28.643 24H8.23563C7.54531 24 6.90379 23.644 6.53853 23.0582L0.302901 13.0582C-0.100977 12.4106 -0.100977 11.5894 0.302901 10.9418L6.53853 0.941756ZM13.393 17.2501C12.9788 16.8359 12.9788 16.1643 13.393 15.7501L17.1431 12L13.393 8.25C12.9788 7.83578 12.9788 7.16421 13.393 6.75C13.8072 6.33579 14.4788 6.33579 14.893 6.75L18.6431 10.5L22.393 6.75011C22.8072 6.33589 23.4788 6.33589 23.893 6.75011C24.3072 7.16432 24.3072 7.83589 23.893 8.2501L20.1431 12L23.893 15.75C24.3072 16.1642 24.3072 16.8358 23.893 17.25C23.4788 17.6642 22.8072 17.6642 22.393 17.25L18.6431 13.5L14.893 17.2501C14.4788 17.6643 13.8072 17.6643 13.393 17.2501Z" fill="white"/>\n          </svg>        \n        ',keycode:8,key:"Backspace"}]],[3,[{content:"!?#",keycode:null,key:null,functional:"symbols"},{content:'\n          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" t="1676976426327" class="icon" width="18" height="18" viewBox="0 0 1024 1024" version="1.1" p-id="2465" width="200" height="200"><path d="M512 0c282.773333 0 512 229.226667 512 512S794.773333 1024 512 1024 0 794.773333 0 512 229.226667 0 512 0z m169.749333 554.666667H342.250667c9.429333 217.792 89.813333 384 169.749333 384 79.914667 0 160.32-166.208 169.749333-384z m-424.917333 0l-169.386667 0.021333c15.658667 157.568 117.034667 289.92 256.853334 349.76-50.282667-85.738667-82.069333-210.346667-87.466667-349.76z m679.722667 0.021333h-169.386667c-5.397333 139.434667-37.184 264.021333-87.466667 349.738667 139.818667-59.797333 241.194667-192.170667 256.853334-349.738667zM344.32 119.573333l-4.736 2.048C202.176 182.378667 102.912 313.536 87.466667 469.333333h169.386666c5.397333-139.434667 37.184-264.042667 87.466667-349.76zM512 85.333333l-3.2 0.085334c-78.848 4.352-157.226667 169.045333-166.549333 383.914666h339.498666C672.32 251.562667 591.936 85.333333 512 85.333333z m167.701333 34.218667l3.136 5.44C731.306667 210.496 761.877333 332.8 767.146667 469.333333h169.386666c-15.637333-157.589333-117.034667-289.941333-256.853333-349.781333z" fill="#ffffff" p-id="2466"/></svg>\n        ',keycode:16,key:"Shift",changeLANG:"changeLANG"},{content:",",keycode:188,key:","},{content:'\n          <svg width="30" height="10" viewBox="0 0 30 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M3 0.5V6.5H27V0.5H30V8C30 8.39782 29.842 8.77936 29.5607 9.06066C29.2794 9.34196 28.8978 9.5 28.5 9.5H1.5C1.10218 9.5 0.720644 9.34196 0.43934 9.06066C0.158035 8.77936 0 8.39782 0 8V0.5H3Z" fill="white"/>\n          </svg>        \n        ',keycode:32,key:" ",basisWidth:.4},{content:".",keycode:190,key:"."},{content:"123",keycode:null,key:null,functional:"numbers"},{content:'\n          <svg width="18" height="18" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M25.375 0.976562H23.2656C23.1109 0.976562 22.9844 1.10312 22.9844 1.25781V19.4687H5.89844V16.9023C5.89844 16.6668 5.62422 16.5332 5.44141 16.6809L0.452737 20.6184C0.308596 20.7309 0.308596 20.9488 0.452737 21.0613L5.44141 24.9988C5.62774 25.1465 5.89844 25.0129 5.89844 24.7773V22.1406H23.4063C24.6473 22.1406 25.6563 21.1316 25.6563 19.8906V1.25781C25.6563 1.10312 25.5297 0.976562 25.375 0.976562Z" fill="white"/>\n          </svg>        \n        ',keycode:13,key:"Enter",basisWidth:.2}]]]),Uo=new Map([[0,8/528],[1,8/528],[2,8/528],[3,8/528]]),No=new Map([[0,[{content:"@",keycode:50,key:"@",shiftKey:!0},{content:"1",keycode:49,key:"1"},{content:"2",keycode:50,key:"2"},{content:"3",keycode:51,key:"3"},{content:'\n        <svg width="18" height="18" viewBox="0 0 31 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path fill-rule="evenodd" clip-rule="evenodd" d="M6.53853 0.941756C6.90379 0.355991 7.54531 0 8.23562 0H28.643C29.7476 0 30.643 0.895431 30.643 2V22C30.643 23.1046 29.7476 24 28.643 24H8.23563C7.54531 24 6.90379 23.644 6.53853 23.0582L0.302901 13.0582C-0.100977 12.4106 -0.100977 11.5894 0.302901 10.9418L6.53853 0.941756ZM13.393 17.2501C12.9788 16.8359 12.9788 16.1643 13.393 15.7501L17.1431 12L13.393 8.25C12.9788 7.83578 12.9788 7.16421 13.393 6.75C13.8072 6.33579 14.4788 6.33579 14.893 6.75L18.6431 10.5L22.393 6.75011C22.8072 6.33589 23.4788 6.33589 23.893 6.75011C24.3072 7.16432 24.3072 7.83589 23.893 8.2501L20.1431 12L23.893 15.75C24.3072 16.1642 24.3072 16.8358 23.893 17.25C23.4788 17.6642 22.8072 17.6642 22.393 17.25L18.6431 13.5L14.893 17.2501C14.4788 17.6643 13.8072 17.6643 13.393 17.2501Z" fill="white"/>\n        </svg>        \n      ',keycode:8,key:"Backspace"}]],[1,[{content:"/",keycode:191,key:"/"},{content:"4",keycode:52,key:"4"},{content:"5",keycode:53,key:"5"},{content:"6",keycode:54,key:"6"},{content:".",keycode:190,key:"."}]],[2,[{content:"!?#",keycode:null,key:null,functional:"symbols"},{content:"7",keycode:55,key:"7"},{content:"8",keycode:56,key:"8"},{content:"9",keycode:57,key:"9"},{content:":",keycode:186,key:":",shiftKey:!0}]],[3,[{content:"ABC",keycode:null,key:null,functional:"letters"},{content:",",keycode:188,key:","},{content:"0",keycode:48,key:"0"},{content:'\n        <svg width="30" height="10" viewBox="0 0 30 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M3 0.5V6.5H27V0.5H30V8C30 8.39782 29.842 8.77936 29.5607 9.06066C29.2794 9.34196 28.8978 9.5 28.5 9.5H1.5C1.10218 9.5 0.720644 9.34196 0.43934 9.06066C0.158035 8.77936 0 8.39782 0 8V0.5H3Z" fill="white"/>\n        </svg>        \n      ',keycode:32,key:" "},{content:'\n        <svg width="18" height="18" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M25.375 0.976562H23.2656C23.1109 0.976562 22.9844 1.10312 22.9844 1.25781V19.4687H5.89844V16.9023C5.89844 16.6668 5.62422 16.5332 5.44141 16.6809L0.452737 20.6184C0.308596 20.7309 0.308596 20.9488 0.452737 21.0613L5.44141 24.9988C5.62774 25.1465 5.89844 25.0129 5.89844 24.7773V22.1406H23.4063C24.6473 22.1406 25.6563 21.1316 25.6563 19.8906V1.25781C25.6563 1.10312 25.5297 0.976562 25.375 0.976562Z" fill="white"/>\n        </svg>        \n      ',keycode:13,key:"Enter"}]]]),Xo=new Map([[0,8/528],[1,8/528],[2,8/528],[3,8/528]]),Ho=new Map([[0,[{content:"!",keycode:49,key:"!",shiftKey:!0},{content:"@",keycode:50,key:"@",shiftKey:!0},{content:"#",keycode:51,key:"#",shiftKey:!0},{content:"$",keycode:52,key:"$",shiftKey:!0},{content:"%",keycode:53,key:"%",shiftKey:!0},{content:"^",keycode:54,key:"^",shiftKey:!0},{content:"&",keycode:55,key:"&",shiftKey:!0},{content:"*",keycode:56,key:"*",shiftKey:!0},{content:"(",keycode:57,key:"(",shiftKey:!0},{content:")",keycode:48,key:"(",shiftKey:!0}]],[1,[{content:"_",keycode:189,key:"_",shiftKey:!0},{content:"=",keycode:187,key:"="},{content:"-",keycode:189,key:"-"},{content:"+",keycode:187,key:"+",shiftKey:!0},{content:"[",keycode:219,key:"["},{content:"]",keycode:221,key:"]"},{content:"{",keycode:219,key:"}",shiftKey:!0},{content:"}",keycode:221,key:"}",shiftKey:!0},{content:"\\",keycode:220,key:"\\"},{content:"|",keycode:220,key:"|",shiftKey:!0}]],[2,[{content:"123",keycode:null,key:null,functional:"numbers"},{content:":",keycode:186,key:":",shiftKey:!0},{content:";",keycode:186,key:";"},{content:'"',keycode:222,key:'"',shiftKey:!0},{content:"'",keycode:222,key:"'"},{content:"<",keycode:188,key:"<",shiftKey:!0},{content:">",keycode:190,key:">",shiftKey:!0},{content:"/",keycode:191,key:"/"},{content:'\n        <svg width="18" height="18" viewBox="0 0 31 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path fill-rule="evenodd" clip-rule="evenodd" d="M6.53853 0.941756C6.90379 0.355991 7.54531 0 8.23562 0H28.643C29.7476 0 30.643 0.895431 30.643 2V22C30.643 23.1046 29.7476 24 28.643 24H8.23563C7.54531 24 6.90379 23.644 6.53853 23.0582L0.302901 13.0582C-0.100977 12.4106 -0.100977 11.5894 0.302901 10.9418L6.53853 0.941756ZM13.393 17.2501C12.9788 16.8359 12.9788 16.1643 13.393 15.7501L17.1431 12L13.393 8.25C12.9788 7.83578 12.9788 7.16421 13.393 6.75C13.8072 6.33579 14.4788 6.33579 14.893 6.75L18.6431 10.5L22.393 6.75011C22.8072 6.33589 23.4788 6.33589 23.893 6.75011C24.3072 7.16432 24.3072 7.83589 23.893 8.2501L20.1431 12L23.893 15.75C24.3072 16.1642 24.3072 16.8358 23.893 17.25C23.4788 17.6642 22.8072 17.6642 22.393 17.25L18.6431 13.5L14.893 17.2501C14.4788 17.6643 13.8072 17.6643 13.393 17.2501Z" fill="white"/>\n        </svg>        \n      ',keycode:8,key:"Backspace"}]],[3,[{content:"ABC",keycode:null,key:null,functional:"letters"},{content:"?",keycode:191,key:"?",shiftKey:!0},{content:",",keycode:188,key:","},{content:'\n        <svg width="30" height="10" viewBox="0 0 30 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M3 0.5V6.5H27V0.5H30V8C30 8.39782 29.842 8.77936 29.5607 9.06066C29.2794 9.34196 28.8978 9.5 28.5 9.5H1.5C1.10218 9.5 0.720644 9.34196 0.43934 9.06066C0.158035 8.77936 0 8.39782 0 8V0.5H3Z" fill="white"/>\n        </svg>        \n      ',keycode:32,key:" ",basisWidth:.4},{content:".",keycode:190,key:"."},{content:'\n        <svg width="18" height="18" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M25.375 0.976562H23.2656C23.1109 0.976562 22.9844 1.10312 22.9844 1.25781V19.4687H5.89844V16.9023C5.89844 16.6668 5.62422 16.5332 5.44141 16.6809L0.452737 20.6184C0.308596 20.7309 0.308596 20.9488 0.452737 21.0613L5.44141 24.9988C5.62774 25.1465 5.89844 25.0129 5.89844 24.7773V22.1406H23.4063C24.6473 22.1406 25.6563 21.1316 25.6563 19.8906V1.25781C25.6563 1.10312 25.5297 0.976562 25.375 0.976562Z" fill="white"/>\n        </svg>        \n      ',keycode:13,key:"Enter",basisWidth:.2}]]]),Fo=new Map([[0,8/528],[1,8/528],[2,8/528],[3,8/528]]),jo=10/348,zo=10/348,Vo=10/348,Wo=10/528,Go=28/64,Zo=function(){function t(t,e,n){void 0===n&&(n="#ff0000");var i=this;this.hostElement=t,this.onKeyChange=e,this.themeColor=n,this.type="letters",this.isUpper=!1,this.handlePointerdown=function(t){var e;t.preventDefault();var n,o,r,a,s,c=t.target;(c.dataset.keycode||c.dataset.key||c.dataset.functional||c.dataset.switchUpperAndLower)&&(c.setPointerCapture(t.pointerId),c.style.background="#aaa"),c.dataset.keycode&&(i.onKeyChange(+c.dataset.keycode,"1"===c.dataset.shiftKey,!0),null===(e=i.timer)||void 0===e||e.clear(),i.timer=(n=1e3,o=100,r=function(){return i.onKeyChange(+c.dataset.keycode,"1"===c.dataset.shiftKey,!0)},a=NaN,s=NaN,a=window.setTimeout((function(){s=window.setInterval((function(){r(),a=NaN}),o)}),n),{clear:function(){window.clearTimeout(a),window.clearInterval(s)}}))},this.handlePointerup=function(t){var e,n=t.target;(n.dataset.keycode||n.dataset.key||n.dataset.functional||n.dataset.switchUpperAndLower)&&(n.style.background="#41454E",n.releasePointerCapture(t.pointerId)),n.dataset.keycode&&(i.onKeyChange(+n.dataset.keycode,"1"===n.dataset.shiftKey,!1),null===(e=i.timer)||void 0===e||e.clear())},this.render=function(){switch(i.hostElement.innerHTML="",i.resizeObserver||(i.resizeObserver=new ResizeObserver((function(){i.render()})),i.resizeObserver.observe(i.hostElement)),i.type){case"letters":i.createKeyboardLayout(Yo,Uo);break;case"numbers":i.createKeyboardLayout(No,Xo);break;case"symbols":i.createKeyboardLayout(Ho,Fo)}},this.setupEvent()}return t.prototype.setupEvent=function(){this.hostElement.addEventListener("pointerdown",this.handlePointerdown),this.hostElement.addEventListener("pointerup",this.handlePointerup)},t.prototype.createRow=function(t,e){var n=this.hostElement,i=n.offsetWidth,o=n.offsetHeight,r=(.9425287356321839-Vo*(e-1))*o*(1/e);return{row:_o("\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      flex-wrap: nowrap;\n      column-gap: ".concat(Math.floor(Wo*i),"px;\n      height: ").concat(r,"px;\n    ")+t),rowHeight:r}},t.prototype.createKeyboardBoard=function(){var t=this.hostElement.offsetHeight;return _o("\n      width: 100%;\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      row-gap: ".concat(Math.round(Vo*t),"px;\n      padding-top: ").concat(Math.round(jo*t),"px;\n      padding-bottom: ").concat(Math.round(zo*t),"px;\n      user-select: none;\n      -webkit-user-select: none;\n      touch-action: none;\n    "))},t.prototype.createSingleKey=function(t,e,n,i){var o=_o("\n      color: #fff;\n      height: 100%;\n      background: ".concat(t.switchUpperAndLower&&this.isUpper?"#aaa":"#41454E",";\n      flex-grow: 1;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 2px;\n      touch-action: none;\n      ").concat(i,";\n    ")),r=_o("\n      font-size: 12px;\n      pointer-events: none;\n      min-width: 12px;\n      text-align: center;\n      white-space: nowrap;\n      transform-origin: center;\n      touch-action: none;\n      ".concat(n,";\n    "));return r.innerHTML=e,o.appendChild(r),o},t.prototype.setDataset=function(t,e){var n,i=this;t.keycode&&(e.dataset.keycode="".concat(t.keycode)),t.functional&&(e.dataset.functional=t.functional),t.switchUpperAndLower&&(e.dataset.switchUpperAndLower="1"),void 0!==t.shiftKey&&(e.dataset.shiftKey="1"),/^[a-z]$/.test(t.content)&&(e.dataset.shiftKey="".concat(+this.isUpper)),e.dataset.key=null!==(n=t.key)&&void 0!==n?n:"",t.functional&&(e.onclick=function(){switch(t.functional){case"letters":i.type="letters";break;case"numbers":i.type="numbers";break;case"symbols":i.type="symbols"}i.render()}),t.switchUpperAndLower&&(e.onclick=function(){i.isUpper=!i.isUpper,i.render()})},t.prototype.createKeyboardLayout=function(t,e){var n=this,i=this.hostElement,o=i.offsetHeight,r=i.offsetWidth,a=this.createKeyboardBoard();Array.from(t.keys()).forEach((function(i){var s=n.createRow("\n        padding: 0px ".concat(e.get(i)*r,"px;\n      "),t.size),c=s.row,u=s.rowHeight,d=t.get(i);d.forEach((function(t){var a=n.createSingleKey(t,n.isUpper&&!t.content.includes("<svg")&&1===t.content.length?t.content.toLocaleUpperCase():t.content,"\n            margin-top: ".concat(Vo*o,"px;\n            font-size: ").concat(t.content.includes("<svg")?12:Math.max(Math.floor(u*Go)-2,12),"px;\n            transform: scale(").concat(Math.min(u*Go)<14?.8:1,");\n          "),"\n            flex-basis: ".concat((1-Wo*(d.length-1)-2*e.get(i))*r/d.length,"px;\n          "));t.basisWidth&&(a.style.flexBasis=t.basisWidth*r+"px"),n.setDataset(t,a),c.appendChild(a)})),a.appendChild(c)})),this.hostElement.appendChild(a)},t.prototype.destroy=function(){var t;null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.resizeObserver=void 0},t}(),Qo=function(t){return.7*t+.3},Jo=function(t){function e(n,i){var r,a,s=this;(s=t.call(this)||this).onChange=n,s.options=i,s.options=o(o({},e.defaultOptions),s.options),s.container=s.createContainer();var c=s.settingBarWrapper();s.settingBar=new Io((null===(r=s.options)||void 0===r?void 0:r.opacity)||.9,c,null===(a=s.options)||void 0===a?void 0:a.themeColor),c.appendChild(s.settingBar.domElement),s.settingBar.on("sliderChange",(function(t){s.container.style.opacity="".concat(Qo(t))})),s.settingBar.on("showResizeboard",(function(t){t&&s.useResizable()}));var u=s.createDragElement().dragElement;s.interact=(new Ro).createDraggable(s.container,u).createResizable(s.container,{minWidth:210,minHeight:150}),s.interact.useDraggable();var d=Lo.create(s.options.themeColor),h=d.board,l=d.resetButton,p=d.opacityButton;s.resizeHandlerBoard=h,l.onclick=function(t){var e,n;t.stopPropagation(),s.container.style.width="".concat(null!==(e=s.options.defaultWidth)&&void 0!==e?e:300,"px"),s.container.style.height="".concat(null!==(n=s.options.defaultHeight)&&void 0!==n?n:200,"px"),s.container.style.opacity="".concat(Qo(s.options.opacity||.9)),s.settingBar.setPercent(.9),s.closeResizeBoard()},p.onclick=function(t){t.stopPropagation(),s.settingBar.triggerOpacityBar(),s.closeResizeBoard()},h.onclick=function(){s.closeResizeBoard()};var f=s.createButtonsWrapper();return s.keyboardBody=new Zo(f,(function(t,e,n){s.onChange(t,e,n)}),s.options.themeColor),s.container.append(u,c,f,s.resizeHandlerBoard),s.shadowRoot.appendChild(s.container),s}return i(e,t),e.prototype.createContainer=function(){var t,e,n=_o("\n      width: ".concat(null!==(t=this.options.defaultWidth)&&void 0!==t?t:300,"px;\n      height: ").concat(null!==(e=this.options.defaultHeight)&&void 0!==e?e:200,"px;\n      opacity: ").concat(Qo(this.options.opacity||.9),";\n      position: absolute;\n      display: none;\n      background: #202124;\n      flex-direction: column;\n      border-radius: 2px;\n    "));return this.placeToCenterBottom(n),n},e.prototype.placeToCenterBottom=function(t){t.style.left="50%",t.style.top="95%",t.style.transform="translate(-50%, -100%)"},e.prototype.settingBarWrapper=function(){return _o("\n      width: 100%;\n      height: 15%;\n    ")},e.prototype.createDragElement=function(){var t=_o("\n      position: absolute;\n      width: 20%;\n      height: 30px;\n      background: transparent;\n      left: 50%;\n      transform: translate(-50%);\n      top: 0px;\n    "),e=_o("\n      height: 5%;\n      width: 100%;\n      background: #C0C0C0;\n      margin-top: 5px;\n      border-radius: 4px;\n    ");return t.appendChild(e),{dragElement:t}},e.prototype.createButtonsWrapper=function(){return _o("\n      height: 85%;\n      width: 100%;\n    ")},e.prototype.closeResizeBoard=function(){this.resizeHandlerBoard.style.display="none",this.useDraggable(),this.keyboardBody.render()},e.prototype.useDraggable=function(){this.resizeHandlerBoard.style.display="none",this.interact.useDraggable()},e.prototype.useResizable=function(){this.resizeHandlerBoard.style.display="block",this.interact.useResizable()},e.prototype.cancelInteract=function(){this.interact.releaseAll()},e.prototype.show=function(){this.container.style.display="flex",this.placeToCenterBottom(this.container),this.keyboardBody.render()},e.prototype.hide=function(){this.container.style.display="none"},e.defaultOptions={themeColor:"#ff0000",opacity:.9},e}(ki);t.AudioChunk=Gn,t.BackwardScrollWheel=ao,t.BandwidthDetect=ni,t.BasicControl=Ni,t.Button=Xi,t.ClipboardData=Kn,t.ClipboardSyncManager=Si,t.Connection=Pi,t.DPad=lo,t.Dashboard=bo,t.DataBuffer=To,t.Draggable=xo,t.EncodeResolutionSettings=zn,t.EncodeSettings=Fn,t.EventData=Tn,t.FileFinish=ti,t.FileRequest=Jn,t.FileResponse=qn,t.FileTransfer=$n,t.FlexibleKeyboard=Jo,t.ForwardScrollWheel=so,t.GamepadInput=_n,t.GamepadUpdate=Ln,t.Helper=Ii,t.ImeManager=mo,t.JoyStick=ji,t.Keyboard=Mn,t.LeftMouseButton=oo,t.Logger=on,t.Magnifier=go,t.Microphone=fo,t.MiddleMouseButton=co,t.MobileKeys=Hn,t.MobileResolutionInfo=Wn,t.MobileResolutionScale=Vn,t.MobileScroll=Zn,t.MobileTouch=Un,t.MobileTouchNormalization=Nn,t.MouseButton=Sn,t.MouseMove=xn,t.OnScreenControls=no,t.Player=Ri,t.PlayerShell=_i,t.PointerManager=Ti,t.ResolutionSettings=jn,t.Resolutions=Qn,t.RightMouseButton=ro,t.Rivatuner=po,t.RunningState=Ui,t.Screenshot=An,t.ScrollWheel=uo,t.TextInput=Rn,t.Throttle=Hi,t.TouchSet=Pn,t.Trackpad=vo,t.UIInteraction=bn,t.UIInteractionBinary=Dn,t.UIInteractionResponse=kn,t.VirtualKeyboard=eo,t.WheelScroll=On,t.Widget=ki,t.isIOS=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},t.screenfull=gi,Object.defineProperty(t,"__esModule",{value:!0})}));
